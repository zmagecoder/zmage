if ("undefined" == typeof Int32Array)
	var Int32Array = Array;
if ("undefined" == typeof Common)
	var Common = {};
"undefined" == typeof Common.iStore && (Common.iStore = {});
Common.iStore.iStoreConfig = function() {
	this.col = null;
	this.dummy = this.inner_height = this.inner_width = this.extern_height = this.extern_width = this.border_weight = this.title_row = this.row = 0
};
Common.iStore.iStorePos = function() {
	this.height = this.width = this.y2 = this.x2 = this.y1 = this.x1 = 0
};
Common.iStore.iStoreGrid = function() {
	this.cy = this.cx = this.y = this.x = 0
};
Common.iStore.iStoreSize = function() {
	this.border_height = this.border_width = this.height = this.width = 0
};
Common.iStore.iStoreImageSize = function() {
	this.h = this.w = 0
};
var Config = null, Config = Array(300);
Config[0] = new Common.iStore.iStoreConfig;
Config[0].col = new Int32Array(3);
Config[0].col[0] = 196;
Config[0].col[1] = 710;
Config[0].col[2] = 294;
Config[0].row = 50;
Config[0].title_row = 1;
Config[0].border_weight = 1;
Config[0].extern_width = 5;
Config[0].extern_height = 5;
Config[0].inner_width = 5;
Config[0].inner_height = 5;
Config[100] = new Common.iStore.iStoreConfig;
Config[100].col = new Int32Array(1);
Config[100].col[0] = 640;
Config[100].row = 40;
Config[100].title_row = 2;
Config[100].border_weight = 0;
Config[100].extern_width = 0;
Config[100].extern_height = 5;
Config[100].inner_width = 10;
Config[100].inner_height = 5;
function csharp_grid_to_pos(a, b, c, d, e) {
	for (var f = new Common.iStore.iStorePos, h = 0, g = 0, h = 0; h < Config[a].col.length; h++)
		b == h && (f.x1 = g), b + d == h && (f.x2 = g - 1), g += Config[a].col[h];
	b >= Config[a].col.length && (f.x1 = g);
	b + d >= Config[a].col.length && (f.x2 = g - 1);
	f.y1 = c * Config[a].row;
	f.y2 = (c + e) * Config[a].row - 1;
	f.width = f.x2 + 1 - f.x1;
	f.height = f.y2 + 1 - f.y1;
	return f
}
function csharp_pos_to_grid(a, b, c, d) {
	for (var e = new Common.iStore.iStoreGrid, f = 0, h = 0, f = 0; f < Config[a].col.length; f++)
		if (h += Config[a].col[f], h > b) {
			e.x = f;
			break
		}
	b >= h && (e.x = 0 < d ? Config[a].col.length - 1 : Config[a].col.length);
	e.y = 0 >= c ? 0 : System.Math.Round$$Double(c / Config[a].row);
	return e
}
function csharp_get_max_grid_width(a) {
	return Config[a].col.length
}
function csharp_get_plugin_size(a, b, c, d, e) {
	a = Config[a];
	var f = new Common.iStore.iStoreSize;
	if (3 == d)
		f.border_width = b - 2 * (a.border_weight + a.extern_width), f.border_height = c
				- 2 * (a.border_weight + a.extern_height), f.width = b - 2
				* (a.border_weight + a.extern_width + a.inner_width), f.height = c
				- (a.row * a.title_row + 2 * a.inner_height);
	else
		switch (e) {
			case 0 :
				f.border_width = b - 2 * a.extern_width;
				f.border_height = c - 2 * a.extern_height;
				f.width = b - 2 * a.extern_width;
				f.height = c - 2 * a.extern_height;
				break;
			case 1 :
				f.border_width = b - 2
						* (a.border_weight + a.extern_width + a.inner_width);
				f.border_height = c - 2
						* (a.border_weight + a.extern_height + a.inner_height);
				f.width = b - 2
						* (a.border_weight + a.extern_width + a.inner_width);
				f.height = c - 2
						* (a.border_weight + a.extern_height + a.inner_height);
				break;
			default :
				f.border_width = b - 2 * (a.border_weight + a.extern_width), f.border_height = c
						- 2 * (a.border_weight + a.extern_height), f.width = b
						- 2
						* (a.border_weight + a.extern_width + a.inner_width), f.height = c
						- (a.row * a.title_row + 2 * a.inner_height)
		}
	return f
}
function csharp_size_image_calc(a, b, c, d, e, f, h) {
	var g = Array(10);
	a = csharp_get_plugin_size(a, b, c, d, e);
	var k = a.width, n = a.height;
	g[0] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = k;
		a.h = n;
		return a
	}();
	g[1] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[2] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[3] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[4] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[5] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[6] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[7] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[8] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	g[9] = function() {
		var a = new Common.iStore.iStoreImageSize;
		a.w = 0;
		a.h = 0;
		return a
	}();
	var m, l;
	switch (f) {
		case 1 :
			g[1] = function() {
				var a = new Common.iStore.iStoreImageSize;
				a.w = k;
				a.h = n;
				return a
			}();
			break;
		case 2 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 4) / 3);
					l = System.Math.Floor$$Double(n - 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 4 - 2 * m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 18) / 3), l = System.Math
							.Floor$$Double(n - 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 18 - 2 * m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}()
			}
			break;
		case 3 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double(0.4 * (n - 3));
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 2;
						a.h = n - l - 3;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 3;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double(0.4 * (n - 10)), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 2;
						a.h = n - l - 10;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 10;
						a.h = l;
						return a
					}()
			}
			break;
		case 4 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 3);
					l = System.Math.Floor$$Double((n - 4) / 3);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = n - 2;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 4 - 2 * l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 3), l = System.Math
							.Floor$$Double((n - 18) / 3), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = n - 2;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 18 - 2 * l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}()
			}
			break;
		case 5 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 6) / 5);
					l = System.Math.Floor$$Double(n - 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 6 - 4 * m;
						a.h = l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 34) / 5), l = System.Math
							.Floor$$Double(n - 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 34 - 4 * m;
						a.h = l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}()
			}
			break;
		case 6 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 5) / 5);
					l = System.Math.Floor$$Double((n - 3) / 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m + 1;
						a.h = n - 3 - l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 5 - 4 * m;
						a.h = n - 2;
						return a
					}();
					g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m;
						a.h = l;
						return a
					}();
					g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m;
						a.h = n - 3 - l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 26) / 5), l = System.Math
							.Floor$$Double((n - 10) / 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m + 8;
						a.h = n - 10 - l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 26 - 4 * m;
						a.h = n - 2;
						return a
					}(), g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m;
						a.h = l;
						return a
					}(), g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = 2 * m;
						a.h = n - 10 - l;
						return a
					}()
			}
			break;
		case 7 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double((n - 5) / 9);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 2;
						a.h = n - 3 * l - 5;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 3;
						a.h = l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 3;
						a.h = l;
						return a
					}();
					g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 3;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double((n - 26) / 9), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 2;
						a.h = n - 3 * l - 26;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 10;
						a.h = l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 10;
						a.h = l;
						return a
					}(), g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - m - 10;
						a.h = l;
						return a
					}()
			}
			break;
		case 8 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double((n - 5) / 4);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 5 - 3 * l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = n - 5 - 3 * l;
						return a
					}();
					g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = l;
						return a
					}();
					g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[8] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double((n - 26) / 4), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 26 - 3 * l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = n - 26 - 3 * l;
						return a
					}(), g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = l;
						return a
					}(), g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[8] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = l;
						return a
					}()
			}
			break;
		case 9 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 4) / 3);
					l = System.Math.Floor$$Double((n - 4) / 3);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 4 - 2 * m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 4 - 2 * l;
						return a
					}();
					g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 4 - 2 * m;
						a.h = n - 4 - 2 * l;
						return a
					}();
					g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 4 - 2 * l;
						return a
					}();
					g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[8] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 4 - 2 * m;
						a.h = l;
						return a
					}();
					g[9] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 18) / 3), l = System.Math
							.Floor$$Double((n - 18) / 3), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 18 - 2 * m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 18 - 2 * l;
						return a
					}(), g[5] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 18 - 2 * m;
						a.h = n - 18 - 2 * l;
						return a
					}(), g[6] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 18 - 2 * l;
						return a
					}(), g[7] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[8] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 18 - 2 * m;
						a.h = l;
						return a
					}(), g[9] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}()
			}
			break;
		case 10 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double(n - 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double(n - 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = l;
						return a
					}()
			}
			break;
		case 11 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 5) / 4);
					l = System.Math.Floor$$Double(n - 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 5 - 3 * m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 26) / 4), l = System.Math
							.Floor$$Double(n - 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 26 - 3 * m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}()
			}
			break;
		case 12 :
		case 13 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double((n - 3) / 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = n - 2;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 3 - l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double((n - 10) / 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = n - 2;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 10 - l;
						return a
					}()
			}
			break;
		case 14 :
			switch (h) {
				case 0 :
					m = System.Math.Floor$$Double((k - 3) / 2);
					l = System.Math.Floor$$Double((n - 3) / 2);
					g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}();
					g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = l;
						return a
					}();
					g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 3 - l;
						return a
					}();
					g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 3 - m;
						a.h = n - 3 - l;
						return a
					}();
					break;
				case 1 :
					m = System.Math.Floor$$Double((k - 10) / 2), l = System.Math
							.Floor$$Double((n - 10) / 2), g[1] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = l;
						return a
					}(), g[2] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = l;
						return a
					}(), g[3] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = m;
						a.h = n - 10 - l;
						return a
					}(), g[4] = function() {
						var a = new Common.iStore.iStoreImageSize;
						a.w = k - 10 - m;
						a.h = n - 10 - l;
						return a
					}()
			}
	}
	return g
};
var iStorePluginConstant = function() {
	this.SHOW_MODE_DISPLAY = 0;
	this.SHOW_MODE_EDIT = 1;
	this.SHOW_MODE_PREVIEW = 2;
	this.SHOW_MODE_STATIC = 3
}, PluginConstant = new iStorePluginConstant;
var iStorePlugin = function(a) { //add by wui a参数值为构造数据的基本信息 构造freeinit,a为基础数据信息
	var b = this, c = {//init基础参数
		icon : "<div></div>",
		tools_bar : $("<div></div>"),
		page_id : 0,
		plugin_type : -1,
		plugin_device : Constant.STORE_DEVICE_PC,
		containers : null,
		frame_config : Constant.ISTORE_FRAME_CONFIG_PC_STYLE0,
		show_mode : PluginConstant.SHOW_MODE_DISPLAY,
		grid_cx_min : 1,
		grid_cy_min : 1,
		grid_cx_max : -1,
		grid_cy_max : -1,
		grid_cx_init : 1,
		grid_cy_init : 1,
		tools_show_resize : !0,
		icon : null,
		content : null,
		on_get_right_size : null,
		on_get_parts_size : null,
		on_dropdown : null,
		on_show : null,
		on_setting : null,
		on_moved : null,
		on_sized : null,
		on_sizing : null,
		on_remove : null,
		can_layout : !1,//缺省值为false
		can_setting : !1//缺省为false
	};
	this.opts = $.extend({}, c, a);
	this.Link_type_info = null;
	this.plugin_type = this.opts.plugin_type;
	this.device = this.opts.plugin_device;//设备号
	this.frame_config = this.opts.frame_config;
	this.show_mode = this.opts.show_mode;
	this.layout_id = this.plugin_id = -1;
	this.grid_y = this.grid_x = 0;
	this.grid_cy = this.grid_cx = 1;
	this.is_new = !0;
	this.is_resizing = this.is_draging = !1;
	this.frame = $('<div type="plugin" ></div>').addClass("plugin_containers");
	this.body = $('<div style="width:100%;height:100%;"></div>');
	this.body.appendTo(this.frame);
	this.icon = null;
	this.frame_border1 = $('<div class="plugin_move_border1"></div>');
	this.frame_border2 = $('<div class="plugin_move_border2"></div>');
	this.frame_border3 = $('<div class="plugin_move_border3"></div>');
	this.frame_border4 = $('<div class="plugin_move_border4"></div>');
	this.frame_remove = $('<div class="plugin_remove icon_del_drag"></div>');
	this.frame_border1.hide();
	this.frame_border2.hide();
	this.frame_border3.hide();
	this.frame_border4.hide();
	this.frame_remove.hide();
	this.frame_border1.appendTo(this.frame);
	this.frame_border2.appendTo(this.frame);
	this.frame_border3.appendTo(this.frame);
	this.frame_border4.appendTo(this.frame);
	this.frame_remove.appendTo(this.frame);
	this.set_icon(this.opts.icon);
	this.set_content(this.opts.content);
	this.show_mode == PluginConstant.SHOW_MODE_EDIT && this.opts.can_layout
			&& ($(this.frame).draggable({
				cursor : "move",
				helper : "clone",
				addClasses : !1,
				zIndex : 100,
				opacity : 0.4,
				refreshPositions : !1,
				start : function(a, c) {
					null != b.frame
							&& b.frame.find(".plugin_touch").unbind("click",
									plugin_setting);
					if (null != b.opts.containers)
						b.opts.containers.on_move_start(b, a, c) //add by wuia,c为拖动对象
				},
				stop : function(a, c) {
					if (null != b.opts.containers)
						b.opts.containers.on_move_stop(b, a, c);
					setTimeout(function() {
								null != b.frame
										&& b.frame.find(".plugin_touch").bind(
												"click", b, plugin_setting)
							}, 100)
				},
				drag : function(a, c) {
					if (null != b.opts.containers)
						b.opts.containers.on_move_drag(b, a, c)
				}
			}), $('<div style="display:none;"></div>').addClass("plugin_touch")
					.appendTo(this.frame), this.opts.tools_show_resize
					&& $(this.frame).resizable({ //设置可移动
								autoHide : !0,
								helper : "plugin_resizable_helper",
								start : function(a, c) {
									if (null != b.opts.containers)
										b.opts.containers
												.on_size_start(b, a, c)
								},
								stop : function(a, c) {
									if (null != b.opts.containers)
										b.opts.containers.on_size_stop(b, a, c)
								},
								resize : function(a, c) {
									if (null != b.opts.containers)
										b.opts.containers.on_size_resize(b, a,
												c)
								}
							}), this.frame_remove.click(function() {
						b.on_remove()
					}));
	this.body.hide()
};
iStorePlugin.prototype = {
	add_touch : function() {
		this.opts.can_layout
				&& ($(this.frame)
						.draggable("option", "handle", ".plugin_touch"), $(this.frame)
						.draggable("option", "cancel", ".plugin_touch_cancel"));
		this.opts.can_setting
				&& this.frame.find(".plugin_touch").bind("click", this,
						plugin_setting)
	},
	remove : function() {
		this.frame.remove();
		this.frame = null
	},
	appendTo : function(a) {
		this.frame.appendTo(a)
	},
	move : function(a, b, c, d) {
		this.frame.css("position", "absolute");
		this.frame.css("left", a + "px");
		this.frame.css("top", b + "px");
		this.size(c, d)
	},
	size : function(a, b) {
		this.frame.width(a);
		this.frame.height(b);
		this.body.width(a);
		this.body.height(b);
		this.frame_border1.width(0);
		this.frame_border1.height(b + 4);
		this.frame_border2.width(a + 4);
		this.frame_border2.height(0);
		this.frame_border3.width(0);
		this.frame_border3.height(b + 4);
		this.frame_border4.width(a + 4);
		this.frame_border4.height(0)
	},
	show : function() {
		this.frame.show()
	},
	hide : function() {
		this.frame.hide()
	},
	get_body : function() {
		return this.frame
	},
	get_right_size : function(a, b, c, d) {
		if (null != this.opts.on_get_right_size)
			return this.opts.on_get_right_size(this, a, b, c, d);
		ret = {};
		ret.cx = c;
		ret.cy = d;
		return ret
	},
	get_parts_size : function(a) {
		if (null != this.opts.on_get_parts_size)
			return this.opts.on_get_parts_size(this, a);
		ret = {};
		ret.w = this.body.width();
		ret.h = this.body.height();
		return ret
	},
	set_content : function(a) {
		null != a
				&& (this.body.empty(), $(a).appendTo(this.body), this.show_mode == PluginConstant.SHOW_MODE_EDIT
						&& this.body.disableSelection())
	},
	set_icon : function(a) {
		null != this.icon && $(this.icon).remove();
		this.icon = $(a).appendTo(this.frame);
		this.icon.addClass("plugin_icon")
	},
	show_icon : function() {
		null != this.icon
				&& ($(this.icon).show(), $(this.frame).width($(this.icon)
						.width()), $(this.frame).height($(this.icon).height()), this.body
						.hide(), this.frame_border1.hide(), this.frame_border2
						.hide(), this.frame_border3.hide(), this.frame_border4
						.hide(), this.frame_remove.hide());
		$(this).children(".ui-icon").hide();
		this.opts.can_layout && this.opts.tools_show_resize
				&& $(this.frame).resizable("disable")
	},
	show_normal : function() { //设置拖动、边框等效果
		var a = this;
		null != this.icon && $(this.icon).hide();
		this.body.show();
		this.show_mode == PluginConstant.SHOW_MODE_EDIT
				&& (this.frame.hover(function() {
							a.opts.can_layout || a.opts.can_setting
									? (a.frame_border1.show(), a.frame_border2
											.show(), a.frame_border3.show(), a.frame_border4
											.show())
									: (a.frame_border1.hide(), a.frame_border2
											.hide(), a.frame_border3.hide(), a.frame_border4
											.hide());
							a.opts.can_layout
									? a.frame_remove.show()
									: a.frame_remove.hide();
							$(this).children(".ui-icon").show()
						}, function() {
							a.frame_border1.hide();
							a.frame_border2.hide();
							a.frame_border3.hide();
							a.frame_border4.hide();
							a.frame_remove.hide();
							$(this).children(".ui-icon").hide()
						}), this.opts.can_layout && this.opts.tools_show_resize
						&& $(this.frame).resizable("enable"))
	},
	on_show : function(a) {
		a ? this.get_data() : this.show_data()
	},
	on_dropdown : function(a, b, c) {
		if (this.opts.can_layout && null != this.opts.on_dropdown)
			this.opts.on_dropdown(this, a, b, c)
	},
	on_moved : function(a, b) {
		if (this.opts.can_layout && null != this.opts.on_moved)
			this.opts.on_moved(this, a, b)
	},
	on_sized : function(a, b) {
		if (this.opts.can_layout && null != this.opts.on_sized)
			this.opts.on_sized(this, a, b)
	},
	on_sizing : function(a, b) {
		if (this.opts.can_layout && null != this.opts.on_sizing)
			this.opts.on_sizing(this, a, b)
	},
	on_remove : function() {
		if (this.opts.can_layout && null != this.opts.on_remove)
			this.opts.on_remove(this)
	},
	on_setting : function() {
		if (this.opts.can_setting && null != this.opts.on_setting)
			this.opts.on_setting(this)
	},
	show_data : function() {
		if (null != this.data && null != this.opts.on_show)
			this.opts.on_show(this); //判断插件模板是否配置展示处理器
		this.show_mode == PluginConstant.SHOW_MODE_EDIT && this.add_touch()
	},
	get_data : function() {
		show_data()
	},
	get_store_link_type : function(a, b) {
		var c = this;
		OpenLoadingDialog();
		$.ajax({
			url : getActionPath("GetStoreLinkType", "Store"),
			dataType : "json",
			contentType : "application/json",
			type : "POST",
			data : stringify({
						device : c.device
					}),
			success : function(b) {
				CloseLoadingDialog();
				if (!0 == b.success) {
					c.Link_type_info = b.Link_type_info;
					c.Link_type_info.StoreSalesRuleData = [];
					c.Link_type_info.StoreSalesRuleData.push({
								Type : -1,
								Name : "\u5168\u90e8\u4fc3\u9500"
							});
					c.Link_type_info.StoreSalesRuleData[0].Rule = [];
					for (var e = 0; e < c.Link_type_info.StoreSalesRule.length; e++) {
						c.Link_type_info.StoreSalesRule[e].Displayinfo = get_sales_rule_displayinfo(c.Link_type_info.StoreSalesRule[e]);
						c.Link_type_info.StoreSalesRuleData[0].Rule
								.push(c.Link_type_info.StoreSalesRule[e]);
						for (var f = !1, h = c.Link_type_info.StoreSalesRule[e].Type, g = 0; g < c.Link_type_info.StoreSalesRuleData.length; g++)
							if (h == c.Link_type_info.StoreSalesRuleData[g].Type) {
								f = !0;
								c.Link_type_info.StoreSalesRuleData[g].Rule
										.push(c.Link_type_info.StoreSalesRule[e]);
								break
							}
						if (!f) {
							f = "";
							switch (h) {
								case Constant.SALESRULE_REDUCE :
									f = "\u76f4\u964d";
									break;
								case Constant.SALESRULE_FULL_REDUCE :
									f = "\u6ee1\u51cf";
									break;
								case Constant.SALESRULE_GROUP_BUY :
									f = "\u56e2\u8d2d";
									break;
								case Constant.SALESRULE_PACK_BUY :
									f = "\u7ec4\u5408\u8d2d\u4e70";
									break;
								case Constant.SALESRULE_SECKILLING :
									f = "\u79d2\u6740";
									break;
								case Constant.SALESRULE_DEFINE :
									f = "\u81ea\u5b9a\u4e49";
									break;
								case Constant.SALESRULE_DISCOUNT :
									f = "\u6298\u6263"
							}
							c.Link_type_info.StoreSalesRuleData.push({
										Type : h,
										Name : f
									});
							c.Link_type_info.StoreSalesRuleData[c.Link_type_info.StoreSalesRuleData.length
									- 1].Rule = [];
							c.Link_type_info.StoreSalesRuleData[c.Link_type_info.StoreSalesRuleData.length
									- 1].Rule
									.push(c.Link_type_info.StoreSalesRule[e])
						}
					}
				} else
					ShowActionError(b.error, "admin");
				null != a && a(b)
			},
			error : function(a, c, f) {
				ShowAjaxError(a, c, f);
				null != b && b(data)
			}
		})
	},
	init_link_type : function(a, b) {
		function c() {
			var b = a.find("#class1_select").find("option:selected").val();
			a.find("#class2_select").empty();
			a.find("#class3_select").empty();
			0 <= b
					? (g.nav_class2 = store_nav_data.store_nav.StoreNavClass1[b].StoreNavClass2, $("#plugin_edit_dialog_class2_tmpl")
							.tmpl(g).appendTo(a.find("#class2_select")))
					: $("#plugin_edit_dialog_class2_tmpl").tmpl(null)
							.appendTo(a.find("#class2_select"));
			$("#plugin_edit_dialog_class3_tmpl").tmpl(null).appendTo(a
					.find("#class3_select"))
		}
		function d() {
			var b = a.find("#class1_select").find("option:selected").val(), c = a
					.find("#class2_select").find("option:selected").val();
			a.find("#class3_select").empty();
			0 <= c
					? (g.nav_class3 = store_nav_data.store_nav.StoreNavClass1[b].StoreNavClass2[c].StoreNavClass3, $("#plugin_edit_dialog_class3_tmpl")
							.tmpl(g).appendTo(a.find("#class3_select")))
					: $("#plugin_edit_dialog_class3_tmpl").tmpl(null)
							.appendTo(a.find("#class3_select"))
		}
		function e() {
			var b = a.find("#link_param_sales_type").find("option:selected")
					.val();
			null != b
					&& 0 <= b
					&& b < h.Link_type_info.StoreSalesRuleData.length
					&& (a.find("#link_param_sales_show").empty(), $("#plugin_edit_dialog_store_sales_tmpl")
							.tmpl({
								Sales : h.Link_type_info.StoreSalesRuleData[b].Rule
							}).appendTo(a.find("#link_param_sales_show")))
		}
		function f() {
			var b = a.find("#tag_class").find("option:selected").val();
			a.find("#tag_item").empty();
			0 <= b
					? $("#plugin_edit_dialog_tag_item_tmpl")
							.tmpl(h.Link_type_info.TagClass[b]).appendTo(a
									.find("#tag_item"))
					: $("#plugin_edit_dialog_tag_item_tmpl").tmpl(null)
							.appendTo(a.find("#tag_item"))
		}
		var h = this;
		$("#plugin_edit_dialog_link_param_tmpl").tmpl(b).appendTo(a);
		var g = {};
		g.nav_class1 = store_nav_data.store_nav.StoreNavClass1;
		$("#plugin_edit_dialog_class1_tmpl").tmpl(g).appendTo(a
				.find("#class1_select"));
		$("#plugin_edit_dialog_class2_tmpl").tmpl(g).appendTo(a
				.find("#class2_select"));
		$("#plugin_edit_dialog_class3_tmpl").tmpl(g).appendTo(a
				.find("#class3_select"));
		a.find("#class1_select").change(function() {
					c()
				});
		a.find("#class2_select").change(function() {
					d()
				});
		if (b.LinkType == Constant.LINK_TYPE_CLASS)
			try {
				var k = $.parseJSON(b.LinkParam);
				if (0 < k.class1_id) {
					var n = a.find("#class1_select option[class_id="
							+ k.class1_id + "]").val();
					a.find("#class1_select").val(n);
					c()
				}
				if (0 < k.class2_id) {
					var m = a.find("#class2_select option[class_id="
							+ k.class2_id + "]").val();
					a.find("#class2_select").val(m);
					d()
				}
				if (0 < k.class3_id) {
					var l = a.find("#class3_select option[class_id="
							+ k.class3_id + "]").val();
					a.find("#class3_select").val(l)
				}
			} catch (t) {
			}
		$("#plugin_edit_dialog_store_news_tmpl").tmpl({
					News : h.Link_type_info.StoreNews
				}).appendTo(a.find("#link_param_news_show"));
		b.LinkType == Constant.LINK_TYPE_NEWS
				&& a.find("#link_param_news").val(b.LinkParam);
		k = h.Link_type_info.StorePage;
		$("#plugin_edit_dialog_store_page_tmpl").tmpl({
					Pages : k
				}).appendTo(a.find("#link_param_page_show"));
		b.LinkType == Constant.LINK_TYPE_PAGE
				&& a.find("#link_param_page").val(b.LinkParam);
		a.find("#link_param_sales_type_show").empty();
		$("#plugin_edit_dialog_store_sales_type_tmpl").tmpl({
					SalesType : h.Link_type_info.StoreSalesRuleData
				}).appendTo(a.find("#link_param_sales_type_show"));
		a.find("#link_param_sales_type").change(e);
		e();
		if (b.LinkType == Constant.LINK_TYPE_SALES)
			for (var p = 1; p < h.Link_type_info.StoreSalesRuleData.length; p++) {
				for (var r = !1, q = 0; q < h.Link_type_info.StoreSalesRuleData[p].Rule.length; q++)
					if (h.Link_type_info.StoreSalesRuleData[p].Rule[q].Id == b.LinkParam) {
						a.find("#link_param_sales_type").val(p);
						e();
						a.find("#link_param_sales").val(b.LinkParam);
						r = !0;
						break
					}
				if (r)
					break
			}
		a.find("#tag_class").change(function() {
					f()
				});
		$("#plugin_edit_dialog_tag_class_tmpl").tmpl(h.Link_type_info)
				.appendTo(a.find("#tag_class"));
		f();
		if (b.LinkType == Constant.LINK_TYPE_TAGITEM)
			try {
				for (var s = b.LinkParam, r = !1, p = 0; p < h.Link_type_info.TagClass.length; p++) {
					for (q = 0; q < h.Link_type_info.TagClass[p].TagItem.length; q++)
						h.Link_type_info.TagClass[p].TagItem[q].TagItemId == s
								&& (a.find("#tag_class").val(p), f(), a
										.find("#tag_item").val(s));
					if (r)
						break
				}
			} catch (u) {
			}
	},
	check_input_link_type : function(a, b) {
		var c = {
			result : !1,
			link_param : "",
			error_field : null,
			error_str : ""
		};
		switch (b) {
			case Constant.LINK_TYPE_NONE :
				break;
			case Constant.LINK_TYPE_NEWS :
				c.link_param = a.find("#link_param_news")
						.find("option:selected").val();
				break;
			case Constant.LINK_TYPE_URL :
				c.link_param = $.trim(a.find("#link_param_extern_url").val());
				c.link_param.length > Constant.INPUT_PLUGIN_LINK_PARAM_MAX
						? (c.error_field = a.find("#link_param_extern_url"), c.error_str = "\u5916\u90e8URL\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
								+ Constant.INPUT_PLUGIN_LINK_PARAM_MAX
								+ "\u5b57")
						: 0 >= c.link_param.length
								? (c.error_field = a
										.find("#link_param_extern_url"), c.error_str = "\u8bf7\u8f93\u5165\u5916\u90e8URL")
								: (a.find("#link_param_extern_url")
										.val(c.link_param), CheckInput.IsUrl($
										.trim(c.link_param))
										? c.link_param = "http://"
												+ c.link_param.substr(7)
										: c.link_param = "http://"
												+ c.link_param);
				break;
			case Constant.LINK_TYPE_SEARCH :
				c.link_param = $.trim(a.find("#link_param_search_key").val());
				c.link_param.length > Constant.INPUT_PLUGIN_LINK_SEARCH_KEY_MAX
						? (c.error_field = a.find("#link_param_search_key"), c.error_str = "\u641c\u7d22\u5173\u952e\u5b57\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
								+ Constant.INPUT_PLUGIN_LINK_SEARCH_KEY_MAX
								+ "\u5b57")
						: 0 >= c.link_param.length
								? (c.error_field = a
										.find("#link_param_search_key"), c.error_str = "\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57")
								: a.find("#link_param_search_key")
										.val(c.link_param);
				break;
			case Constant.LINK_TYPE_CLASS :
				var d = {};
				d.class1_id = a.find("#class1_select").find("option:selected")
						.attr("class_id");
				d.class2_id = a.find("#class2_select").find("option:selected")
						.attr("class_id");
				d.class3_id = a.find("#class3_select").find("option:selected")
						.attr("class_id");
				0 >= d.class1_id
						? (c.error_field = a.find("#class1_select"), c.error_str = "\u8bf7\u9009\u62e9\u5546\u54c1\u5206\u7c7b")
						: c.link_param = stringify(d);
				break;
			case Constant.LINK_TYPE_PAGE :
				c.link_param = a.find("#link_param_page")
						.find("option:selected").val();
				break;
			case Constant.LINK_TYPE_SALES :
				c.link_param = a.find("#link_param_sales")
						.find("option:selected").val();
				break;
			case Constant.LINK_TYPE_GOODS :
				break;
			case Constant.LINK_TYPE_TAGITEM :
				d = a.find("#tag_item").find("option:selected").val();
				0 < d
						? c.link_param = d
						: (c.error_field = a.find("#tag_item"), c.error_str = "\u8bf7\u9009\u62e9\u6807\u7b7e\u9879\u76ee");
				break;
			default :
				c.error_field = a, c.error_str = "\u975e\u6cd5\u7684\u9009\u9879"
		}
		c.result = null != c.error_field ? !1 : !0;
		return c
	},
	preview : function(a, b, c) {
		var d = this.body.width(), e = this.body.height();
		if (null == b || null == c)
			b = d, c = e;
		c = $.extend(!0, {}, this);
		c.show_mode = PluginConstant.SHOW_MODE_PREVIEW;
		null == a
				? ($("#plugin_preview_dialog").empty(), $("#plugin_preview_dialog_tmpl")
						.tmpl(null).appendTo("#plugin_preview_dialog"), $("#plugin_preview_dialog")
						.dialog({
									autoOpen : !1,
									resizable : !1,
									modal : !0,
									width : d + 5,
									height : e + 85,
									title : "\u9884\u89c8"
								}), $("#plugin_preview_dialog").dialog("open"))
				: $(a).empty();
		c.frame = $('<div class="plugin_containers"></div>');
		c.body = $("<div></div>");
		c.body.appendTo(c.frame);
		c.body.width(d);
		c.body.height(e);
		c.frame.width(d);
		c.frame.height(e);
		c.frame.css("position", "relative");
		c.frame.css("top", "0px");
		c.frame.css("left", "0px");
		null == a
				? (c.frame.appendTo($("#plugin_preview_dialog")
						.dialog("widget").find(".plugin_preview_content")), $("#plugin_preview_dialog")
						.dialog("widget").find("#button_close").click(
								function() {
									$("#plugin_preview_dialog").dialog("close")
								}))
				: c.frame.appendTo($(a));
		d != b
				&& (a = b / d, $.support.leadingWhitespace ? (c.frame.css(
						"transform", "scale(" + a + ")"), c.frame.css(
						"transform-origin", "top left"), c.frame.css(
						"-ms-transform", "scale(" + a + ")"), c.frame.css(
						"-ms-transform-origin", "top left"), c.frame.css(
						"-o-transform", "scale(" + a + ")"), c.frame.css(
						"-o-transform-origin", "top left"), c.frame.css(
						"-moz-transform", "scale(" + a + ")"), c.frame.css(
						"-moz-transform-origin", "top left"), c.frame.css(
						"-webkit-transform", "scale(" + a + ")"), c.frame.css(
						"-webkit-transform-origin", "top left")) : c.frame.css(
						"zoom", a));
		c.show_data()
	}
};
function plugin_setting(a) {
	if (!$(a.target).hasClass("plugin_touch_cancel")
			&& !$(a.target).parents().hasClass("plugin_touch_cancel"))
		a.data.on_setting()
};
var PluginAdvertising = function(a) {
	iStorePlugin.apply(this, [a]); //add by wui istoreplugin
	this.plugin_type = Constant.PLUGIN_TYPE_ADVERTISING;
	this.data = null;
	this.max_photo = 9;
	this.curr_photo = 0;
	this.no_check = !1;
	this.Link_type_info = null;
	this.advertising_types = [{}, {
				direction : "top",
				duration : 0.3,
				easing : "linear",
				delay : 5,
				startIndex : 1
			}, {
				duration : 0.3,
				easing : "linear",
				delay : 5,
				hideClickBar : !1,
				clickBarRadius : 10
			}, {
				hideBottomBar : !0
			}]
};
$.extend(PluginAdvertising.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.ad_change()
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising_id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success ? (a.data = b.Advertising, a
									.show_data()) : ShowActionError(b.error,
									"admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	ad_change : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#advertising_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 915,
								title : "\u7f16\u8f91\u5e7f\u544a\u56fe\u7247",
								close : function() {
									a.get_data()
								}
							});
					$("#advertising_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		var a = this, b = $("#advertising_edit_dialog");
		b.empty();
		$("#advertising_edit_dialog_tmpl").tmpl(this)
				.appendTo("#advertising_edit_dialog");
		b.find(".advertising_title_input").focus();
		b.find(".content_data_set").each(function() {
			var b = Number($(this).attr("index")), d = $(this);
			a.init_link_type(d.find("#link_param"), a.data.Advertising[b]);
			d.find("#link_type").change(function() {
				var a = $(this).find("option:selected").val(), b = $(this)
						.parents(".content");
				b.find(".link_param").hide();
				b.find("#link_param_" + a).show()
			})
		});
		a.check_input(!0) && a.canvas_preview();
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : a.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.dialog("close")
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find(".button_image").click(function() {
			if (a.check_input(!0)) {
				var b = a.get_parts_size(0), d = $(this)
						.parents(".content_data_set").attr("index"), e = $(this)
						.parents(".image_preview_box").find("img");
				(new ImageClipping(b.w, b.h, a.data.Advertising[d].photoId,
						Constant.IMAGE_QUALITY_BEST, function(b) {
							a.data.Advertising[d].PhotoId = b.id;
							a.data.Advertising[d].Url = b.path;
							e.attr("src", b.path);
							e.attr("photo_id", b.id);
							a.canvas_preview()
						})).open()
			}
		});
		0 < this.data.Advertising.length
				&& (this.data.Advertising.length > this.curr_photo ? this
						.select_photo(this.curr_photo) : this.select_photo(0));
		b.find(".plugin_set_tab li").mousedown(function() {
					if (a.check_input(!0)) {
						var c = b.find(".plugin_set_tab li").index($(this));
						a.select_photo(c)
					} else
						return !1
				});
		b.find(".plugin_set_tab").sortable({
			stop : function(c, d) {
				if (a.check_input(!0)
						&& (a.curr_photo = b.find(".plugin_set_tab li")
								.index(d.item), a.curr_photo != d.item
								.attr("order"))) {
					var e = [];
					b.find(".plugin_set_tab li").each(function() {
								e
										.push(a.data.Advertising[$(this)
												.attr("order")])
							});
					a.data.Advertising = e;
					a.curr_photo = b.find(".plugin_set_tab li").index(d.item);
					a.update_edit_dialog()
				}
			}
		});
		b.find(".advertising_add").click(function() {
					if (a.check_input(!0)
							&& a.data.Advertising.length < a.max_photo) {
						var b = {};
						b.Url = Config_Default_Image;
						b.Title = "";
						b.LinkType = 0;
						b.LinkParam = "";
						a.data.Advertising.push(b);
						a.curr_photo = a.data.Advertising.length - 1;
						a.update_edit_dialog()
					}
				});
		b.find(".advertising_del").click(function() {
			a.check_input(!0)
					&& (a.data.Advertising.length > a.curr_photo
							? 1 >= a.data.Advertising.length
									? alert("\u65e0\u6cd5\u5220\u9664\u56fe\u7247,\u8bf7\u4fdd\u7559\u81f3\u5c11\u4e00\u5f20\u56fe\u7247")
									: (a.data.Advertising.splice(a.curr_photo,
											1), a.curr_photo >= a.data.Advertising.length
											&& (a.curr_photo = a.data.Advertising.length
													- 1), a
											.update_edit_dialog())
							: alert("\u8bf7\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u56fe\u7247"))
		});
		b.find("input[name=advertising_style]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#direction_set").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#interval_set").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find(".advertising_title_input").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find(".link_param").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	select_photo : function(a) {
		this.curr_photo = a;
		var b = $("#advertising_edit_dialog");
		b.find(".plugin_set_tab li").removeClass("checked");
		b.find(".plugin_set_tab li").eq(a).addClass("checked");
		b.find(".plugin_set_tab_content .content_data_set").hide();
		b.find(".plugin_set_tab_content .content_data_set").eq(a).show()
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#advertising_edit_dialog"), d = null, e = null, f = "";
		c.find(".plugin_set_content_img-show").focus();
		this.data.Style = c.find("input[name=advertising_style]:checked").val();
		(null == d || a)
				&& c.find(".plugin_set_tab_content .content_data_set").each(
						function() {
							var a = Number($(this).attr("index")), g = $(this), k = b
									.get_preview_position(0, c
													.find(".image_preview")
													.width(), c
													.find(".image_preview")
													.height());
							c.find(".image_preview_img").width(k.w);
							c.find(".image_preview_img").height(k.h);
							c.find(".image_preview_img").css("margin-left",
									k.x + "px");
							c.find(".image_preview_img").css("margin-top",
									k.y + "px");
							var k = $(this).find(".advertising_title_input"), n = $
									.trim(k.val());
							n.length > Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
									? (d = k, e = a, f = "ALT\u6807\u7b7e\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
											+ Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
											+ "\u5b57")
									: (k.val(n), b.data.Advertising[a].Title = n);
							k = Number($(this).find("#link_type")
									.find("option:selected").val());
							g = b.check_input_link_type(g, k);
							g.result
									? (b.data.Advertising[a].LinkType = k, b.data.Advertising[a].LinkParam = g.link_param)
									: (d = g.error_field, e = a, f = g.error_str)
						});
		this.data.Direction = c.find("#direction_set").val();
		this.data.Interval = c.find("#interval_set").val();
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(f);
		null != e && this.select_photo(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b, c) {
		a = 0 == a ? {
			w : this.frame.width(),
			h : this.frame.height()
		} : this.get_parts_size(a);
		a = a.w / a.h;
		var d = {};
		a > b / c
				? (d.w = b, d.h = b / a, d.x = 0, d.y = (c - d.h) / 2)
				: (d.w = b * a, d.h = c, d.x = (b - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#advertising_edit_dialog")
				.find(".plugin_set_content_img-show"), b = this
				.get_preview_position(0, a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginImage = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_IMAGE;
	this.curr_photo = 0;
	this.no_check = !1;
	this.data = this.Link_type_info = null
};
$.extend(PluginImage.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.image_change()
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising_id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success ? (a.data = b.Advertising, a
									.show_data()) : ShowActionError(b.error,
									"admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	get_photo_num : function(a) {
		var b = 0;
		switch (a) {
			case 1 :
				b = 1;
				break;
			case 2 :
				b = 3;
				break;
			case 3 :
				b = 3;
				break;
			case 4 :
				b = 4;
				break;
			case 5 :
				b = 5;
				break;
			case 6 :
				b = 6;
				break;
			case 7 :
				b = 7;
				break;
			case 8 :
				b = 8;
				break;
			case 9 :
				b = 9;
				break;
			case 10 :
				b = 2;
				break;
			case 11 :
				b = 4;
				break;
			case 12 :
				b = 3;
				break;
			case 13 :
				b = 3;
				break;
			case 14 :
				b = 4
		}
		return b
	},
	image_change : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#image_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 915,
								title : "\u7f16\u8f91\u56fe\u7247",
								close : function() {
									a.get_data()
								}
							});
					$("#image_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		var a = this, b = $("#image_edit_dialog");
		b.empty();
		a.photo_num = a.get_photo_num(a.data.Type);
		$("#image_edit_dialog_tmpl").tmpl(this).appendTo("#image_edit_dialog");
		b.find(".title_set").focus();
		b.find(".content_data_set").each(function() {
			var b = Number($(this).attr("index")), d = $(this);
			a.init_link_type(d.find("#link_param"), a.data.Advertising[b]);
			d.find("#link_type").change(function() {
				var a = $(this).find("option:selected").val(), b = $(this)
						.parents(".content");
				b.find(".link_param").hide();
				b.find("#link_param_" + a).show()
			})
		});
		a.check_input(!0) && a.canvas_preview();
		0 < this.data.Advertising.length
				&& (this.data.Advertising.length > this.curr_photo ? this
						.select_photo(this.curr_photo) : this.select_photo(0));
		b.find(".plugin_set_tab li").mousedown(function() {
					if (a.check_input(!0)) {
						var c = b.find(".plugin_set_tab li").index($(this));
						a.select_photo(c)
					} else
						return !1
				});
		b.find(".plugin_set_tab").sortable({
			stop : function(c, d) {
				if (a.check_input(!0)
						&& (a.curr_photo = b.find(".plugin_set_tab li")
								.index(d.item), a.curr_photo != d.item
								.attr("order"))) {
					var e = [];
					b.find(".plugin_set_tab li").each(function() {
								e
										.push(a.data.Advertising[$(this)
												.attr("order")])
							});
					a.data.Advertising = e;
					a.curr_photo = b.find(".plugin_set_tab li").index(d.item);
					a.update_edit_dialog()
				}
			}
		});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : a.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.dialog("close")
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find(".button_image").click(function() {
			if (a.check_input(!0)) {
				var b = Number($(this).parents(".content_data_set")
						.attr("index")), d = a.get_parts_size(b + 1), e = $(this)
						.parents(".image_preview_box").find("img");
				(new ImageClipping(d.w, d.h, a.data.Advertising[b].PhotoId,
						Constant.IMAGE_QUALITY_BEST, function(d) {
							a.data.Advertising[b].PhotoId = d.id;
							a.data.Advertising[b].Url = d.path;
							e.attr("src", d.path);
							e.attr("photo_id", d.id);
							a.canvas_preview()
						})).open()
			}
		});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=gap_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#type_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find(".image_title_input").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find(".link_param").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	select_photo : function(a) {
		this.curr_photo = a;
		var b = $("#image_edit_dialog"), c = b
				.find(".plugin_set_content_img-show");
		b.find(".plugin_set_tab li").removeClass("checked");
		b.find(".plugin_set_tab li").eq(a).addClass("checked");
		b.find(".plugin_set_tab_content .content_data_set").hide();
		b.find(".plugin_set_tab_content .content_data_set").eq(a).show();
		c.find(".plugin_image_select").remove();
		$('<div class="plugin_image_select"></div>').appendTo(c.find(".li"
				+ (a + 1)));
		b = c.find(".plugin_image_select");
		b.width(c.find(".li" + (a + 1)).width());
		b.height(c.find(".li" + (a + 1)).height());
		b.css("top", "-1px");
		b.css("left", "-1px");
		c.find("img").removeClass("image_current");
		c.find("#image" + a).addClass("image_current")
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#image_edit_dialog"), d = null, e = null, f = "";
		c.find(".plugin_set_content_img-show").focus();
		var h = c.find("input[name=title_show_set]:checked").val();
		1 == h ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var h = c.find("input[name=title_show_set]:checked").val(), g = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == h ? 3 : 2 * Number(h) + Number(g);
		this.data.Style = Number(c.find("input[name=gap_set]:checked").val());
		g = Number(c.find("#type_set").find("option:selected").val());
		h = this.get_photo_num(g);
		if (0 >= h)
			return d = c.find("#type_set"), e = 0, f = "\u65e0\u6548\u7684\u56fe\u7247\u98ce\u683c", !1;
		this.data.Type = g;
		this.photo_num = h;
		if (this.data.Advertising.length < h) {
			for (g = this.data.Advertising.length; g < h; g++) {
				var k = {};
				k.Url = Config_Default_Image;
				k.Title = "";
				k.LinkType = 0;
				k.LinkParam = "";
				this.data.Advertising.push(k)
			}
			b.update_edit_dialog()
		}
		if (null == d || a)
			h = c.find("input[name=title_set]"), g = $.trim(h.val()), g.length > Constant.INPUT_PLUGIN_TITLE_MAX
					? (d = h, e = 0, f = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
							+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
					: (h.val(g), this.data.Title = g);
		(null == d || a)
				&& c.find(".plugin_set_tab_content .content_data_set").each(
						function() {
							var a = Number($(this).attr("index")), c = $(this), g = b
									.get_preview_position(a + 1, c
													.find(".image_preview")
													.width(), c
													.find(".image_preview")
													.height());
							c.find(".image_preview_img").width(g.w);
							c.find(".image_preview_img").height(g.h);
							c.find(".image_preview_img").css("margin-left",
									g.x + "px");
							c.find(".image_preview_img").css("margin-top",
									g.y + "px");
							var g = $(this).find(".image_title_input"), h = $
									.trim(g.val());
							h.length > Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
									? (d = g, e = a, f = "ALT\u6807\u7b7e\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
											+ Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
											+ "\u5b57")
									: (g.val(h), b.data.Advertising[a].Title = h);
							g = Number($(this).find("#link_type")
									.find("option:selected").val());
							c = b.check_input_link_type(c, g);
							c.result
									? (b.data.Advertising[a].LinkType = g, b.data.Advertising[a].LinkParam = c.link_param)
									: (d = c.error_field, e = a, f = c.error_str)
						});
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(f);
		null != e && this.select_photo(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b, c) {
		a = 0 == a ? {
			w : this.frame.width(),
			h : this.frame.height()
		} : this.get_parts_size(a);
		a = a.w / a.h;
		var d = {};
		a > b / c
				? (d.w = b, d.h = b / a, d.x = 0, d.y = (c - d.h) / 2)
				: (d.w = b * a, d.h = c, d.x = (b - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		function a(a) {
			return b.check_input() ? (b.select_photo(a), !0) : !1
		}
		var b = this, c = $("#image_edit_dialog")
				.find(".plugin_set_content_img-show"), d = this
				.get_preview_position(0, c.width(), c.height());
		c.empty();
		var e = $("<div></div>");
		e.width(d.w);
		e.height(d.h);
		e.css("margin-left", d.x + "px");
		e.css("margin-top", d.y + "px");
		e.appendTo(c);
		this.preview(e, d.w, d.h);
		c.find("#image0").mousedown(function() {
					a(0)
				});
		c.find("#image1").mousedown(function() {
					a(1)
				});
		c.find("#image2").mousedown(function() {
					a(2)
				});
		c.find("#image3").mousedown(function() {
					a(3)
				});
		c.find("#image4").mousedown(function() {
					a(4)
				});
		c.find("#image5").mousedown(function() {
					a(5)
				});
		c.find("#image6").mousedown(function() {
					a(6)
				});
		c.find("#image7").mousedown(function() {
					a(7)
				});
		c.find("#image8").mousedown(function() {
					a(8)
				});
		c.find("#image9").mousedown(function() {
					a(9)
				})
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 != a.success
									&& ShowActionError(a.error, "admin");
							b.get_data()
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginNews = function(a) {
	iStorePlugin.apply(this, [a]);
	this.curr_news = -1;
	this.data = this.editing_news = this.Link_type_info = this.news_editor = null
};
$.extend(PluginNews.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_news_group()
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetNewsGroup", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								news_group_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.News_group, a.show_data())
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	get_news : function(a) {
		if (null != this.data.News)
			for (var b = 0; b < this.data.News.length; b++)
				if (this.data.News[b].Id == a)
					return this.data.News[b];
		return null
	},
	edit_news : function(a) {
		var b = this, c = b.data.News[a];
		if (null != c) {
			var d = null;
			null == c.Description && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("GetNews", "Store"),
						dataType : "json",
						contentType : "application/json",
						async : !1,
						type : "POST",
						data : stringify({
									news_id : c.Id
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success ? c = a.news : d = a.error
						},
						error : function(a, b, c) {
							d = ErrorCode.DEFAULT
						}
					}));
			null == d ? b.create_news_edit_dialog(c, !1, function(c) {
						b.data.News[a] = c;
						b.update_edit_dialog()
					}) : alert(ErrorCode.ErrorString[d])
		} else
			alert("\u53d1\u751f\u9519\u8bef,\u8bf7\u7a0d\u5019\u91cd\u8bd5")
	},
	add_news : function() {
		var a = this, b = {};
		b.GroupId = this.data.Id;
		b.Id = 0;
		b.Title = "";
		b.Photo = "";
		b.LinkType = Constant.LINK_TYPE_NONE;
		b.LinkParam = "";
		b.Abstract = "";
		b.Description = "<p>\u5728\u6b64\u5904\u6dfb\u52a0\u4f60\u7684\u65b0\u95fb\u5185\u5bb9</p>";
		b.Order = 0;
		null != b
				? this.create_news_edit_dialog(b, !0, function(b) {
							a.data.News.splice(0, 0, b);
							a.curr_news = a.data.News.length - 1;
							a.update_edit_dialog()
						})
				: alert("\u53d1\u751f\u9519\u8bef,\u8bf7\u7a0d\u5019\u91cd\u8bd5")
	},
	create_news_edit_dialog : function(a, b, c) {
		function d(a) {
			KindEditor.remove("#news_edit_dialog_description_content");
			f.news_editor = null;
			f.news_editor = KindEditor.create("#" + g + "_description_content",
					{
						filterMode : !1,
						wellFormatMode : !1,
						allowFileManager : !0,
						fileManagerJson : getActionPath("KindFileManager",
								"AdminOperation"),
						minWidth : 538,
						width : 538,
						height : 350,
						resizeType : 0,
						items : "source | fullscreen | undo redo | cut copy paste plainpaste wordpaste | image multiimage flash media insertfile table hr anchor link unlink | justifyleft justifycenter justifyright justifyfull selectall | formatblock fontname fontsize | forecolor hilitecolor bold italic underline strikethrough lineheight removeformat"
								.split(" "),
						afterBlur : function() {
						}
					});
			f.news_editor.html(a)
		}
		function e() {
			var a = $(this).find("option:selected").val(), b = $(this)
					.parents(".content");
			b.find(".link_param").hide();
			b.find("#link_param_" + a).show()
		}
		var f = this;
		a.LinkType == Constant.LINK_TYPE_NEWS
				&& (a.LinkType = Constant.LINK_TYPE_NONE);
		var h = $("#news_edit_dialog").dialog({
			autoOpen : !1,
			resizable : !1,
			modal : !0,
			width : 560,
			title : b ? "\u6dfb\u52a0\u65b0\u95fb" : "\u7f16\u8f91\u65b0\u95fb",
			close : function() {
				KindEditor.remove("#news_edit_dialog_description_content");
				f.news_editor = null
			}
		});
		f.editing_news = $.extend({}, a);
		var g = h.attr("id");
		h.empty();
		$("#news_edit_dialog_tmpl").tmpl(a).appendTo(h);
		this.plugin_type == Constant.PLUGIN_TYPE_NEWS_GRAPHIC
				&& h.find(".news_image_preview").show();
		f.init_link_type(h.find("#link_param"), f.editing_news);
		h.find("#link_type").change(e);
		e();
		h.find("#news_description").html(f.editing_news.Description);
		h.find("#news_description").attr("id", g + "_description_content");
		d(a.Description);
		h.find("#button_image").click(function() {
			var b, c;
			f.device == Constant.STORE_DEVICE_PC
					? c = b = 99
					: (b = 180, c = 150);
			(new ImageClipping(b, c, a.PhotoId, Constant.IMAGE_QUALITY_BEST,
					function(b) {
						a.PhotoId = b.id;
						a.Photo = b.path;
						h.find("#news_photo").attr("src", b.path);
						h.find("#news_photo").attr("photo_id", b.id);
						b = f.news_editor.html();
						d(b)
					}, function() {
						var a = f.news_editor.html();
						d(a)
					})).open()
		});
		h.find("#button_image_del").click(function() {
					a.PhotoId = 0;
					a.Photo = null;
					h.find("#news_photo").attr("src", "blank.png");
					h.find("#news_photo").attr("photo_id", 0)
				});
		h.find("#button_save").click(function() {
			f.check_news_input()
					&& (null != c && c(f.editing_news), h.dialog("close"))
		});
		h.find("#button_cancel").click(function() {
					h.dialog("close")
				});
		d(a.Description);
		h.find("#news_title").blur(function() {
				});
		h.find("#news_abstract").blur(function() {
				});
		h.find(".link_param").blur(function() {
				});
		h.dialog("open")
	},
	check_news_input : function() {
		if (this.no_check)
			return !1;
		var a = this, b = $("#news_edit_dialog"), c = null, d = "", e = $(b)
				.find("#news_photo").attr("src");
		a.editing_news.Photo = "blank.png" == e ? null : e;
		a.editing_news.PhotoId = $(b).find("#news_photo").attr("photo_id");
		if (null == c) {
			var f = b.find("input[name=news_title]"), e = $.trim(f.val());
			e.length > Constant.INPUT_PLUGIN_NEWS_TITLE_MAX
					? (c = f, d = "\u65b0\u95fb\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
							+ Constant.INPUT_PLUGIN_NEWS_TITLE_MAX + "\u5b57")
					: 0 >= e.length
							? (c = f, d = "\u5fc5\u987b\u8f93\u5165\u65b0\u95fb\u6807\u9898")
							: (f.val(e), a.editing_news.Title = e)
		}
		null == c
				&& (f = b.find("#news_abstract"), e = $.trim(f.val()), e.length > Constant.INPUT_PLUGIN_NEWS_ABSTRACT_MAX
						? (c = f, d = "\u65b0\u95fb\u6458\u8981\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
								+ Constant.INPUT_PLUGIN_NEWS_ABSTRACT_MAX
								+ "\u5b57")
						: (f.val(e), a.editing_news.Abstract = e));
		null == c
				&& (e = null != a.news_editor ? a.news_editor.html() : "", e.length > Constant.INPUT_PLUGIN_NEWS_CONTENT_MAX
						? (c = $(".plugin_set_content"), d = "\u65b0\u95fb\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7"
								+ Constant.INPUT_PLUGIN_NEWS_CONTENT_MAX
								+ "\u5b57")
						: a.editing_news.Description = e);
		null == c
				&& (e = Number(b.find("#link_type").find("option:selected")
						.val()), b = a.check_input_link_type(b, e), b.result
						? (a.editing_news.LinkType = e, a.editing_news.LinkParam = b.link_param)
						: (c = b.error_field, error_photo = index, d = b.error_str));
		return null != c ? (this.no_check = !0, alert(d), setTimeout(
				function() {
					c.focus();
					a.no_check = !1
				}, 100), !1) : !0
	},
	edit_news_group : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#news_group_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 915,
								title : "\u7f16\u8f91\u65b0\u95fb",
								close : function() {
									a.get_data()
								}
							});
					$("#news_group_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		var a = this, b = $("#news_group_edit_dialog");
		b.empty();
		$("#news_group_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("#news_group_content").attr("id", "dialog_news_group_content");
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditNewsGroup", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									news_group : a.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.dialog("close")
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find(".news_list_content").sortable({
			stop : function(c, d) {
				a.curr_news = b.find(".news_list_content .news_list_item")
						.index(d.item);
				if (a.curr_news != d.item.attr("order")) {
					var e = [];
					b.find(".news_list_content .news_list_item").each(
							function() {
								e.push(a.data.News[$(this).attr("order")])
							});
					a.data.News = e;
					a.update_edit_dialog()
				}
			}
		});
		b.find(".news_list").click(function() {
			a.check_input(!0) && a.canvas_preview();
			a.curr_news = $(".news_list").index($(this));
			0 <= a.curr_news && a.curr_news < a.data.News.length
					&& a.edit_news(a.curr_news)
		});
		b.find(".news_list_item").hover(function() {
					$(this).find(".del_news").show()
				}, function() {
					$(this).find(".del_news").hide()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=style_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=roll_set]").click(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find("#direction_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find("#interval_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find(".news_add").click(function() {
					a.check_input(!0) && (a.add_news(), a.canvas_preview())
				});
		b.find(".del_news").click(function() {
			a.check_input(!0)
					&& (a.canvas_preview(), a.curr_news = $(".news_list_item")
							.index($(this).parents(".news_list_item")), 0 <= a.curr_news
							&& a.curr_news < a.data.News.length
							&& ShowConfirmDialog(
									"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u65b0\u95fb\u5417?",
									function() {
										0 <= a.curr_news
												&& a.curr_news < a.data.News.length
												&& (a.data.News.splice(
														a.curr_news, 1), setTimeout(
														function() {
															a
																	.update_edit_dialog()
														}, 100))
									}))
		})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#news_group_edit_dialog"), d = null, e = "", f = c
				.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("input[name=style_set]:checked").val());
		f = c.find("input[name=title_set]");
		h = $.trim(f.val());
		h.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = f, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (f.val(h), this.data.Title = h);
		this.data.Roll = c.find("input[name=roll_set]").is(":checked");
		this.data.Direction = c.find("#direction_set").val();
		this.data.Interval = c.find("#interval_set").val();
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#news_group_edit_dialog")
				.find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditNewsGroup", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									news_group : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 != a.success
									&& ShowActionError(a.error, "admin");
							b.get_data()
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginNewsText = function(a) {
	PluginNews.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NEWS_TEXT;
	this.data = null
};
$.extend(PluginNewsText.prototype, PluginNews.prototype, {});
var PluginNewsGraphic = function(a) {
	PluginNews.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NEWS_GRAPHIC;
	this.data = null
};
$.extend(PluginNewsGraphic.prototype, PluginNews.prototype, {});
var PluginShowcase = function(a) {
	iStorePlugin.apply(this, [a]);
	this.search_goods = this.Link_type_info = this.backup_data = this.data = null;
	this.curr_label = 0;
	this.moving_search_goods = this.moving_label_goods = null
};
$.extend(PluginShowcase.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		this.edit_showcase();
		if (null != this.opts.on_setting)
			this.opts.on_setting(this)
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetShowcase", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								showcase_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.showcase, a.show_data(!1))
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	do_edit_showcase : function(a, b, c) {
		var d = this;
		a = $.extend(!0, {}, a);
		if (null != a.Labels)
			for (var e = 0; e < a.Labels.length; e++)
				a.Labels[e].Goods = null;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("EditShowcase", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								showcase : a
							}),
					success : function(a) {
						CloseLoadingDialog();
						null != b && b(a);
						!0 != a.success && ShowActionError(a.error, "admin");
						d.get_data()
					},
					error : function(a, b, e) {
						null != c && c(a, b, e);
						ShowAjaxError(a, b, e);
						d.get_data()
					}
				})
	},
	edit_showcase : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#showcase_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 930,
								title : "\u7f16\u8f91\u6a71\u7a97",
								close : function() {
									a.data = $.extend(!0, {}, a.backup_data)
								}
							});
					$("#showcase_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		function a(a, b) {
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("SearchSalesGoods", "Goods"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									rule_type : a,
									rule_id : b
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? (d.search_goods = a.simple_goods, d
											.set_search_goods_operation())
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		}
		function b() {
			var b = e.find("#rule_type_select").find("option:selected").val(), f = e
					.find("#rule_type_select").find("option:selected")
					.attr("rule_type");
			null != b
					&& (0 <= b
							&& b < d.Link_type_info.StoreSalesRuleData.length
							? (e.find("#rule_id_show").empty(), $("#showcase_dialog_store_sales_tmpl")
									.tmpl({
										Sales : d.Link_type_info.StoreSalesRuleData[b].Rule
									}).appendTo(e.find("#rule_id_show")), e
									.find("#rule_id_select").change(c), a(f, -1))
							: (e.find("#rule_id_show").empty(), $("#showcase_dialog_store_sales_tmpl")
									.tmpl(null).appendTo(e
											.find("#rule_id_show")), e
									.find("#goods_search_result").empty()))
		}
		function c() {
			var b = e.find("#rule_id_select").find("option:selected").val();
			a(-1, b)
		}
		var d = this, e = $("#showcase_edit_dialog");
		e.empty();
		$("#showcase_edit_dialog_tmpl").tmpl(this).appendTo(e);
		e.find("input[name=title_set]").focus();
		this.backup_data = $.extend(!0, {}, this.data);
		var f = {};
		f.nav_class1 = store_nav_data.store_nav.StoreNavClass1;
		$("#showcase_edit_dialog_class1_tmpl").tmpl(f).appendTo(e
				.find("#class1_select"));
		$("#showcase_edit_dialog_class2_tmpl").tmpl(f).appendTo(e
				.find("#class2_select"));
		$("#showcase_edit_dialog_class3_tmpl").tmpl(f).appendTo(e
				.find("#class3_select"));
		e.find("#class1_select").change(function() {
			var a = e.find("#class1_select").find("option:selected").val();
			e.find("#class2_select").empty();
			e.find("#class3_select").empty();
			0 <= a
					? (f.nav_class2 = store_nav_data.store_nav.StoreNavClass1[a].StoreNavClass2, $("#showcase_edit_dialog_class2_tmpl")
							.tmpl(f).appendTo(e.find("#class2_select")))
					: $("#showcase_edit_dialog_class2_tmpl").tmpl(null)
							.appendTo(e.find("#class2_select"));
			$("#showcase_edit_dialog_class3_tmpl").tmpl(null).appendTo(e
					.find("#class3_select"))
		});
		e.find("#class2_select").change(function() {
			var a = e.find("#class1_select").find("option:selected").val(), b = e
					.find("#class2_select").find("option:selected").val();
			e.find("#class3_select").empty();
			0 <= b
					? (f.nav_class3 = store_nav_data.store_nav.StoreNavClass1[a].StoreNavClass2[b].StoreNavClass3, $("#showcase_edit_dialog_class3_tmpl")
							.tmpl(f).appendTo(e.find("#class3_select")))
					: $("#showcase_edit_dialog_class3_tmpl").tmpl(null)
							.appendTo(e.find("#class3_select"))
		});
		e.find("#showcase_label_sel").change(function() {
					var a = e.find("#showcase_label_sel").val();
					d.curr_label = a;
					d.update_edit_dialog()
				});
		this.set_search_goods_operation();
		this.set_label_goods_operation();
		d.check_input(!0);
		e.find("#goods_search").click(function() {
			e.find("#goods_search_result").empty();
			var a = e.find("#class1_select").find("option:selected")
					.attr("class_id"), b = e.find("#class2_select")
					.find("option:selected").attr("class_id"), c = e
					.find("#class3_select").find("option:selected")
					.attr("class_id"), f = {};
			f.Status = Constant.OPEN;
			f.Key = $.trim(e.find("input[name=search_key]").val());
			f.First = 0;
			f.Max = Constant.SHOWCASE_SEARCH_GOODS_MAX;
			f.StoreId = 0;
			f.Order = 0;
			f.PriceFrom = null;
			f.PriceTo = null;
			f.Class1Id = 0 <= a ? a : null;
			f.Class2Id = 0 <= b ? b : null;
			f.Class3Id = 0 <= c ? c : null;
			f.StockOnly = !1;
			f.IsGetTag = !1;
			f.IsGetClass = !1;
			f.IsGetDynamic = !1;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("SearchGoods", "Goods"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									option : f
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? (d.search_goods = a.simple_goods, d
											.set_search_goods_operation())
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		});
		e.find("#rule_type_show").empty();
		$("#showcase_dialog_store_sales_type_tmpl").tmpl({
					SalesType : d.Link_type_info.StoreSalesRuleData
				}).appendTo(e.find("#rule_type_show"));
		e.find("#rule_type_select").change(b);
		b();
		e.find("#button_save").click(function() {
					d.check_input(!1) && d.do_edit_showcase(d.data, function() {
								d.backup_data = $.extend(!0, {}, d.data);
								e.dialog("close")
							}, null)
				});
		e.find("#button_cancel").click(function() {
					e.dialog("close")
				});
		e.find("#button_preview").click(function() {
					d.check_input(!0) && d.preview()
				});
		e.find("input[name=title_show_set]").change(function() {
					d.check_input(!0)
				});
		e.find("input[name=border_show_set]").change(function() {
					d.check_input(!0)
				});
		e.find("#goods_style_set").change(function() {
					d.check_input(!0)
				});
		e.find("input[name=roll_set]").click(function() {
			d.check_input(!0)
					&& (e.find("input[name=roll_set]").is(":checked") ? (e
							.find("#direction_set").removeAttr("disabled"), e
							.find("#interval_set").removeAttr("disabled")) : (e
							.find("#direction_set").attr("disabled", !0), e
							.find("#interval_set").attr("disabled", !0)))
		})
	},
	set_search_goods_operation : function() {
		var a = this, b = $("#showcase_edit_dialog");
		b.find("#goods_search_result").empty();
		null != this.search_goods
				&& $("#showcase_edit_dialog_goods_tmpl")
						.tmpl(this.search_goods).appendTo(b
								.find("#goods_search_result"));
		b.find("#goods_search_result").sortable({
			appendTo : $(".showcase_set_content_bg"),
			helper : function(a, b) {
				var e = b.children(), f = b.clone();
				f.children().each(function(a) {
							$(this).width(e.eq(a).width())
						});
				return f
			},
			delay : 100,
			start : function(b, d) {
				a.moving_search_goods = null;
				for (var e = 0; e < a.search_goods.length; e++)
					if (a.search_goods[e].GoodsId == $(d.item).attr("goods_id")) {
						a.moving_search_goods = a.search_goods[e];
						break
					}
			}
		}).disableSelection()
	},
	set_label_goods_operation : function() {
		var a = this, b = $("#showcase_edit_dialog");
		b.find("#label_goods_result").empty();
		if (this.curr_label < this.data.Labels.length
				&& null != this.data.Labels[this.curr_label].Goods)
			for (var c = 0; c < this.data.Labels[this.curr_label].Goods.length; c++)
				$("#showcase_edit_dialog_goods_tmpl")
						.tmpl(this.data.Labels[this.curr_label].Goods[c])
						.appendTo(b.find("#label_goods_result"));
		b.find("#label_goods_result").sortable({
			delay : 100,
			stop : function(c, e) {
				for (var f = b.find("#label_goods_result")
						.find(".showcase_goods_item").index(e.item), h = $(e.item)
						.attr("goods_id"), g = 0; g < a.data.Labels[a.curr_label].Id.length; g++)
					if (a.data.Labels[a.curr_label].Id[g] == h) {
						h = a.data.Labels[a.curr_label].Goods[g];
						a.data.Labels[a.curr_label].Id.splice(g, 1);
						a.data.Labels[a.curr_label].Id.splice(f, 0, h.GoodsId);
						a.data.Labels[a.curr_label].Goods.splice(g, 1);
						a.data.Labels[a.curr_label].Goods.splice(f, 0, h);
						break
					}
			}
		}).droppable({
			accept : "#goods_search_result .showcase_goods_item",
			hoverClass : "showcase_set_goods_add_hover",
			drop : function(b, c) {
				var f = !1;
				if (null != a.moving_search_goods)
					for (var h = a.data.Labels[a.curr_label].Goods, g = 0; g < h.length; g++)
						if (h[g].GoodsId == a.moving_search_goods.GoodsId) {
							f = !0;
							break
						}
				f
						|| (a.data.Labels[a.curr_label].Id
								.push(a.moving_search_goods.GoodsId), a.data.Labels[a.curr_label].Goods
								.push(a.moving_search_goods));
				a.moving_search_goods = null;
				a.set_label_goods_operation()
			}
		}).disableSelection();
		b.find("#label_goods_result").find(".showcase_goods_item").hover(
				function() {
					$(this).find(".del_goods").show()
				}, function() {
					$(this).find(".del_goods").hide()
				});
		b.find("#label_goods_result").find(".del_goods").click(function() {
			for (var b = $(this).parents(".showcase_goods_item")
					.attr("goods_id"), c = 0; c < a.data.Labels[a.curr_label].Goods.length; c++)
				if (a.data.Labels[a.curr_label].Id[c] == b) {
					a.data.Labels[a.curr_label].Id.splice(c, 1);
					a.data.Labels[a.curr_label].Goods.splice(c, 1);
					break
				}
			a.set_label_goods_operation()
		})
	},
	add_label : function(a) {
		a = $.trim(a);
		if ("" != a)
			if (a.length > Constant.INPUT_PLUGIN_SHOWCASE_LABEL_NAME_MAX)
				alert("\u6807\u7b7e\u540d\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_SHOWCASE_LABEL_NAME_MAX
						+ "\u5b57");
			else {
				var b = {};
				b.Name = a;
				b.Id = [];
				b.Goods = [];
				a = $.extend({}, this.data, !0);
				a.Labels.push(b);
				this.do_edit_showcase(a, null, null)
			}
	},
	change_label_name : function(a, b) {
		b = $.trim(b);
		if (null != this.get_label_info(a)) {
			if ("" == b)
				return alert("\u8bf7\u8f93\u5165\u6807\u7b7e\u540d"), !1;
			if (b.length > Constant.INPUT_PLUGIN_SHOWCASE_LABEL_NAME_MAX)
				return alert("\u6807\u7b7e\u540d\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_SHOWCASE_LABEL_NAME_MAX
						+ "\u5b57"), !1;
			var c = $.extend({}, this.data, !0);
			c.Labels[a].Name = b;
			this.do_edit_showcase(c, null, null);
			return !0
		}
		return !1
	},
	move_label : function(a, b) {
		var c = this.get_label_info(a);
		if (null != c && a + 1 != b) {
			var d = $.extend({}, this.data, !0);
			d.Labels.splice(a, 1);
			b > d.length && (b = d.length + 1);
			d.Labels.splice(b - 1, 0, c);
			this.do_edit_showcase(d, null, null)
		}
	},
	delete_label : function(a) {
		var b = this;
		if (null != b.get_label_info(a))
			if (1 >= this.data.Labels.length) {
				var c = $("#showcase_label_remove_error1_dialog");
				c.dialog({
							autoOpen : !1,
							resizable : !1,
							modal : !0,
							width : 300,
							height : 160,
							title : "\u9519\u8bef"
						});
				c.empty();
				$("#showcase_label_remove_error1_dialog_tmpl").tmpl(this)
						.appendTo(c);
				c.dialog("open");
				c.find("#button_ok").click(function() {
							c.dialog("close")
						})
			} else
				ShowConfirmDialog(
						"\u786e\u5b9e\u8981\u5220\u9664\u8fd9\u4e2a\u6807\u7b7e\u5417?<br>\u70b9\u51fb\u786e\u5b9a\u5c06\u5220\u9664\u8be5\u6807\u7b7e\u4ee5\u53ca\u5176\u4e2d\u7684\u6240\u6709\u5185\u5bb9!",
						function() {
							var c = $.extend({}, b.data, !0);
							c.Labels.splice(a, 1);
							b.do_edit_showcase(c, null, null)
						})
	},
	add_search_key : function(a) {
		if (null != a && "" != $.trim(a))
			if (a = $.trim(a), a.length > Constant.INPUT_PLUGIN_TITLE_SEARCHKEY_MAX)
				alert("\u641c\u7d22\u5173\u952e\u5b57\u6700\u591a\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_SEARCHKEY_MAX + "\u5b57");
			else {
				var b = $.trim(this.data.SearchKey);
				null == b && (b = "");
				for (var b = b.split("\t"), c = 0; c < b.length; c++)
					if (b[c] = $.trim(b[c]), b[c] == a) {
						alert("\u641c\u7d22\u5173\u952e\u5b57\u91cd\u590d,\u8bf7\u66f4\u6362\u4e3a\u5176\u4ed6\u5173\u952e\u5b57");
						return
					}
				b.push(a);
				this.data.SearchKey = b.join("\t");
				a = $.extend({}, this.data, !0);
				a.Labels = null;
				this.do_edit_showcase(a, null, null)
			}
	},
	del_search_key : function(a) {
		var b = $.trim(this.data.SearchKey);
		null == b && (b = "");
		b = b.split("\t");
		if (0 <= a && a < b.length) {
			for (var c = 0; c < b.length; c++)
				b[c] = $.trim(b[c]);
			b.splice(a, 1);
			this.data.SearchKey = b.join("\t");
			a = $.extend({}, this.data, !0);
			a.Labels = null;
			this.do_edit_showcase(a, null, null)
		}
	},
	edit_search_key : function(a, b) {
		var c = $.trim(this.data.SearchKey);
		null == c && (c = "");
		c = c.split("\t");
		if (null != b && "" != $.trim(b))
			if (b = $.trim(b), b.length > Constant.INPUT_PLUGIN_TITLE_SEARCHKEY_MAX)
				alert("\u641c\u7d22\u5173\u952e\u5b57\u6700\u591a\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_SEARCHKEY_MAX + "\u5b57");
			else {
				for (var d = 0; d < c.length; d++)
					if (c[d] = $.trim(c[d]), c[d] == b && d != a) {
						alert("\u641c\u7d22\u5173\u952e\u5b57\u91cd\u590d,\u8bf7\u66f4\u6362\u4e3a\u5176\u4ed6\u5173\u952e\u5b57");
						return
					}
				c[a] = b;
				this.data.SearchKey = c.join("\t");
				c = $.extend({}, this.data, !0);
				c.Labels = null;
				this.do_edit_showcase(c, null, null)
			}
	},
	move_search_key : function(a, b) {
		var c = $.trim(this.data.SearchKey);
		null == c && (c = "");
		c = c.split("\t");
		if (a != b && 0 <= a && a < c.length && 0 <= b && b < c.length) {
			var d = $.extend({}, this.data, !0), e = c[a];
			c.splice(a, 1);
			c.splice(b, 0, e);
			d.SearchKey = c.join("\t");
			d.Labels = null;
			this.do_edit_showcase(d, null, null)
		}
	},
	move_showcase_goods : function(a, b, c) {
		if (null != this.data && null != this.data.Labels
				&& a < this.data.Labels.length)
			for (var d = 0; d < this.data.Labels[a].Id.length; d++)
				if (b == this.data.Labels[a].Id[d] && d + 1 != c) {
					var e = $.extend({}, this.data, !0);
					b = e.Labels[a].Id[d];
					e.Labels[a].Id.splice(d, 1);
					c > e.Labels[a].Id.length
							&& (c = e.Labels[a].Id.length + 1);
					e.Labels[a].Id.splice(c - 1, 0, b);
					this.do_edit_showcase(e, null, null);
					break
				}
	},
	get_label_info : function(a) {
		return null != this.data && null != this.data.Labels
				&& a < this.data.Labels.length ? this.data.Labels[a] : null
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#showcase_edit_dialog"), d = null, e = "", f = c
				.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("#goods_style_set").val());
		this.data.GoodsStyle = c.find("input[name=goods_border_set]:checked")
				.val();
		f = c.find("input[name=title_set]");
		h = $.trim(f.val());
		h.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = f, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (f.val(h), this.data.Title = h);
		this.data.Roll = c.find("input[name=roll_set]").is(":checked");
		this.data.Direction = c.find("#direction_set").val();
		this.data.Interval = c.find("#interval_set").val();
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	change_title : function(a) {
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var b = $.extend({}, this.data);
			b.Title = a;
			b.Labels = null;
			this.do_edit_showcase(b, null, null)
		}
	}
});
var PluginShowcase1 = function(a) {
	PluginShowcase.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_SHOWCASE1
};
$.extend(PluginShowcase1.prototype, PluginShowcase.prototype, {});
var PluginShowcase2 = function(a) {
	PluginShowcase.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_SHOWCASE2
};
$.extend(PluginShowcase2.prototype, PluginShowcase.prototype, {});
var PluginShowcase3 = function(a) {
	a.grid_cx_max = 1;
	PluginShowcase.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_SHOWCASE3
};
$.extend(PluginShowcase3.prototype, PluginShowcase.prototype, {});
var PluginNavAll = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NAV_ALL;
	this.data = null;
	this.no_check = !1;
	this.nav_data = "undefined" != typeof store_nav_data
			&& null != store_nav_data ? store_nav_data.store_nav : null
};
$.extend(PluginNavAll.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_nav()
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreNavigation", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								nav_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.Nav, a.show_data())
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	edit_nav : function() {
		var a = this;
		$("#nav_all_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5bfc\u822a\u83dc\u5355",
					close : function() {
						a.get_data()
					}
				});
		$("#nav_all_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#nav_all_edit_dialog");
		b.empty();
		$("#nav_all_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (b.dialog("close"), a.get_data())
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=style_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#nav_all_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("input[name=style_set]:checked").val());
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#nav_all_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success ? b.get_data() : ShowActionError(
									a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		}
	}
});
var PluginNavV = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NAV_V;
	this.data = null;
	this.no_check = !1;
	this.nav_data = "undefined" != typeof store_nav_data
			&& null != store_nav_data ? store_nav_data.store_nav : null;
	this.class2_index = this.class1_index = this.class1_id = -1
};
$.extend(PluginNavV.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_nav()
	},
	show_data : function() {
		null != this.data
				&& this
						.set_class_index(this.data.ClassLevel,
								this.data.ClassId);
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreNavigation", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								nav_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.Nav, a.show_data())
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	edit_nav : function() {
		var a = this;
		$("#nav_v_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5bfc\u822a\u83dc\u5355",
					close : function() {
						a.get_data()
					}
				});
		$("#nav_v_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	get_class1_id : function(a) {
		if (null != this.nav_data) {
			for (var b = -1, c = 0; c < this.nav_data.StoreNavClass1.length; c++) {
				for (var d = 0; d < this.nav_data.StoreNavClass1[c].StoreNavClass2.length; d++)
					if (this.nav_data.StoreNavClass1[c].StoreNavClass2[d].ID == a) {
						b = this.nav_data.StoreNavClass1[c].ID;
						break
					}
				if (0 < b)
					break
			}
			return b
		}
		return -1
	},
	get_class1_index : function(a) {
		if (null != this.nav_data) {
			for (var b = -1, c = 0; c < this.nav_data.StoreNavClass1.length; c++)
				if (this.nav_data.StoreNavClass1[c].ID == a) {
					b = c;
					break
				}
			return b
		}
		return -1
	},
	get_class2_index : function(a) {
		if (null != this.nav_data) {
			for (var b = -1, c = 0; c < this.nav_data.StoreNavClass1.length; c++) {
				for (var d = 0; d < this.nav_data.StoreNavClass1[c].StoreNavClass2.length; d++)
					if (this.nav_data.StoreNavClass1[c].StoreNavClass2[d].ID == a) {
						b = d;
						break
					}
				if (0 < b)
					break
			}
			return b
		}
		return -1
	},
	set_class_index : function(a, b) {
		switch (a) {
			case 1 :
				this.class1_id = b;
				this.class1_index = this.get_class1_index(b);
				this.class2_index = -1;
				break;
			case 2 :
				this.class1_id = this.get_class1_id(b);
				this.class1_index = this.get_class1_index(this.class1_id);
				this.class2_index = this.get_class2_index(b);
				break;
			default :
				this.class2_index = this.class1_index = this.class1_id = -1
		}
	},
	update_edit_dialog : function() {
		function a() {
			var a = d.find("#class1_select").find("option:selected").val();
			d.find("#class2_select").empty();
			0 <= a
					? (e.nav_class2 = b.nav_data.StoreNavClass1[a].StoreNavClass2, $("#nav_v_edit_dialog_class2_tmpl")
							.tmpl(e).appendTo(d.find("#class2_select")))
					: $("#nav_v_edit_dialog_class2_tmpl").tmpl(null).appendTo(d
							.find("#class2_select"))
		}
		var b = this, c = $("#nav_v_edit_dialog");
		c.empty();
		$("#nav_v_edit_dialog_tmpl").tmpl(this).appendTo(c);
		c.find("#class1_select").focus();
		var d = $(c).find(".plugin_set_content_img-attr"), e = {};
		e.nav_class1 = b.nav_data.StoreNavClass1;
		$("#nav_v_edit_dialog_class1_tmpl").tmpl(e).appendTo(d
				.find("#class1_select"));
		$("#nav_v_edit_dialog_class2_tmpl").tmpl(e).appendTo(d
				.find("#class2_select"));
		b.canvas_preview();
		d.find("#class1_select").change(function() {
					a();
					b.check_input(!0) && b.canvas_preview()
				});
		d.find("#class2_select").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		try {
			switch (this.data.ClassLevel) {
				case 1 :
					var f = d.find("#class1_select option[class_id="
							+ this.data.ClassId + "]").val();
					d.find("#class1_select").val(f);
					a();
					break;
				case 2 :
					var h = this.get_class1_id(this.data.ClassId);
					if (null != h) {
						f = d.find("#class1_select option[class_id=" + h + "]")
								.val();
						d.find("#class1_select").val(f);
						a();
						var g = d.find("#class2_select option[class_id="
								+ this.data.ClassId + "]").val();
						d.find("#class2_select").val(g)
					} else
						d.find("#class1_select").val(-1), d
								.find("#class2_select").val(-1);
					break;
				default :
					d.find("#class1_select").val(-1), d.find("#class2_select")
							.val(-1)
			}
		} catch (k) {
		}
		c.find("input[name=title_set]").blur(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("#button_save").click(function() {
			b.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : b.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? (c.dialog("close"), b.get_data())
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					}))
		});
		c.find("#button_cancel").click(function() {
					c.dialog("close")
				});
		c.find("#button_preview").click(function() {
					b.check_input(!1) && b.preview()
				});
		c.find("input[name=title_show_set]").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("input[name=border_show_set]").change(function() {
					b.check_input(!0) && b.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#nav_v_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		f = c.find("input[name=title_set]");
		h = $.trim(f.val());
		h.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = f, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (f.val(h), this.data.Title = h);
		f = c.find("#class1_select").find("option:selected").attr("class_id");
		c = c.find("#class2_select").find("option:selected").attr("class_id");
		0 >= f
				? a
						? (this.data.ClassLevel = 0, this.data.ClassId = -1)
						: (d = $(this).find("#class1_select"), e = "\u8bf7\u9009\u62e9\u5546\u54c1\u5206\u7c7b")
				: 0 >= c
						? (this.data.ClassLevel = 1, this.data.ClassId = f)
						: (this.data.ClassLevel = 2, this.data.ClassId = c);
		this.set_class_index(this.data.ClassLevel, this.data.ClassId);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#nav_v_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success ? b.get_data() : ShowActionError(
									a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		}
	}
});
var PluginNavH = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NAV_H;
	this.data = null;
	this.no_check = !1;
	this.nav_data = "undefined" != typeof store_nav_data
			&& null != store_nav_data ? store_nav_data.store_nav : null
};
$.extend(PluginNavH.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_nav()
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreNavigation", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								nav_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.Nav, a.show_data())
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	edit_nav : function() {
		var a = this;
		$("#nav_h_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5bfc\u822a\u83dc\u5355",
					close : function() {
						a.get_data()
					}
				});
		$("#nav_h_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#nav_h_edit_dialog");
		b.empty();
		$("#nav_h_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("input[name=title_set]").focus();
		a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (b.dialog("close"), a.get_data())
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=style_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#nav_h_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("input[name=style_set]:checked").val());
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#nav_h_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success ? b.get_data() : ShowActionError(
									a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		}
	}
});
var PluginNavTag = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NAV_TAG;
	this.data = null;
	this.no_check = !1
};
$.extend(PluginNavTag.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_tag()
	},
	show_data : function() {
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreNavigation", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								nav_id : this.plugin_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success
								? (a.data = b.Nav, a.show_data())//sguo 标签导航缺省请求返回处理
								: ShowActionError(b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	edit_tag : function() {
		var a = this;
		$("#nav_tag_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u6807\u7b7e\u5bfc\u822a",
					close : function() {
						a.get_data()
					}
				});
		$("#nav_tag_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
			url : getActionPath("GetTagClass", "Goods"),
			dataType : "json",
			contentType : "application/json",
			type : "POST",
			success : function(b) {
				CloseLoadingDialog();
				if (!0 == b.success) {
					var c = $("#nav_tag_edit_dialog");
					c.empty();
					a.tag_class = b.Tag_class.Tag_class_info;
					$("#nav_tag_edit_dialog_tmpl").tmpl(a).appendTo(c);
					a.check_input(!1) && a.canvas_preview();
					c.find("input[name=title_set]").blur(function() {
								a.check_input(!0) && a.canvas_preview()
							});
					a.set_tag_operation();
					c.find("#button_save").click(function() {
						a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
							url : getActionPath("EditStoreNavigation", "Store"),
							dataType : "json",
							contentType : "application/json",
							type : "POST",
							data : stringify({
										nav_info : a.data
									}),
							success : function(b) {
								CloseLoadingDialog();
								!0 == b.success ? (c.dialog("close"), a
										.get_data()) : ShowActionError(b.error,
										"admin")
							},
							error : function(a, b, c) {
								ShowAjaxError(a, b, c)
							}
						}))
					});
					c.find("#button_cancel").click(function() {
								c.dialog("close")
							});
					c.find("#button_preview").click(function() {
								a.check_input(!1) && a.preview()
							});
					c.find("input[name=title_show_set]").change(function() {
								a.check_input(!0) && a.canvas_preview()
							});
					c.find("input[name=border_show_set]").change(function() {
								a.check_input(!0) && a.canvas_preview()
							});
					c.find("input[name=style_set]").click(function() {
								a.check_input(!0) && a.canvas_preview()
							})
				} else
					ShowActionError(b.error, "admin")
			},
			error : function(a, c, d) {
				ShowAjaxError(a, c, d)
			}
		})
	},
	set_tag_operation : function() {
		var a = this, b = $("#nav_tag_edit_dialog"), c = $(b)
				.find(".plugin_set_content_img-attr");
		b.find("#tag_select_result").empty();
		null != a.data.Content.TagClass
				&& $("#nav_tag_dialog_tag_tmpl").tmpl(a.data.Content)
						.appendTo(b.find("#tag_select_result"));
		a.canvas_preview();
		b.find("#tag_search_result").sortable({
			appendTo : c,
			helper : function(a, b) {
				var c = b.children(), h = b.clone();
				h.children().each(function(a) {
							$(this).width(c.eq(a).width())
						});
				return h
			},
			delay : 100,
			start : function(b, c) {
				a.moving_search_tag = null;
				for (var f = 0; f < a.tag_class.length; f++)
					if (a.tag_class[f].TagClassId == $(c.item)
							.attr("tag_class_id")) {
						a.moving_search_tag = a.tag_class[f];
						break
					}
			}
		}).disableSelection();
		b.find("#tag_select_result").sortable({
			delay : 100,
			stop : function(c, e) {
				for (var f = b.find("#tag_select_result").find(".tag_item")
						.index(e.item), h = $(e.item).attr("tag_class_id"), g = 0; g < a.data.Content.TagClass.length; g++)
					if (a.data.Content.TagClass[g].TagClassId == h) {
						h = a.data.Content.TagClass[g];
						a.data.Content.TagClass.splice(g, 1);
						a.data.Content.TagClass.splice(f, 0, h);
						break
					}
				a.canvas_preview()
			}
		}).droppable({
			accept : "#tag_search_result .tag_item",
			drop : function(b, c) {
				var f = !1;
				if (null != a.moving_search_tag)
					for (var h = a.data.Content.TagClass, g = 0; g < h.length; g++)
						if (h[g].TagClassId == a.moving_search_tag.TagClassId) {
							f = !0;
							break
						}
				f || a.data.Content.TagClass.push(a.moving_search_tag);
				a.moving_search_tag = null;
				a.set_tag_operation()
			}
		}).disableSelection();
		b.find("#tag_select_result").find(".Classify_IconClose").click(
				function() {
					for (var b = $(this).parents(".tag_item")
							.attr("tag_class_id"), c = 0; c < a.data.Content.TagClass.length; c++)
						if (a.data.Content.TagClass[c].TagClassId == b) {
							a.data.Content.TagClass.splice(c, 1);
							break
						}
					a.set_tag_operation()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#nav_tag_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("input[name=style_set]:checked").val());
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#nav_tag_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreNavigation", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									nav_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success ? b.get_data() : ShowActionError(
									a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					})
		}
	}
});
var PluginFree = function(a) { //add bu wui a的参数信息
	iStorePlugin.apply(this, [a]); //重新init构造函数
	this.plugin_type = Constant.PLUGIN_TYPE_FREE;
	this.data = this.editor = null;
	this.no_check = !1
};
$.extend(PluginFree.prototype, iStorePlugin.prototype, { //对象继承
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_free()
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success
									? (a.data = b.free, a.show_data())
									: ShowActionError(b.error, "admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_free : function() {
		var a = this;
		$("#free_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u81ea\u7531\u53d1\u6325",
					close : function() {
						KindEditor.remove("#dialog_free_content");
						a.editor = null;
						a.get_data()
					}
				});
		$("#free_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#free_edit_dialog");
		b.empty();
		$("#free_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("#free_content").attr("id", "dialog_free_content");
		this.editor = KindEditor.create("#dialog_free_content", {
			filterMode : !1,
			wellFormatMode : !1,
			allowFileManager : !0,
			fileManagerJson : getActionPath("KindFileManager", "AdminOperation"),
			minWidth : 508,
			width : "508px",
			height : "324px",
			resizeType : 0,
			items : "source | fullscreen | undo redo | cut copy paste plainpaste wordpaste | image multiimage flash media insertfile table hr anchor link unlink | justifyleft justifycenter justifyright justifyfull selectall | formatblock fontname fontsize | forecolor hilitecolor bold italic underline strikethrough lineheight removeformat"
					.split(" "),
			afterBlur : function() {
				a.canvas_preview()
			}
		});
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_info : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (a.get_data(), b.dialog("close"))
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#free_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = 0;
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			c = null != this.editor ? this.editor.html() : "", c.length > Constant.INPUT_PLUGIN_FREE_CONTENT_MAX
					? (d = $(".plugin_set_content"), e = "\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7"
							+ Constant.INPUT_PLUGIN_FREE_CONTENT_MAX + "\u5b57")
					: this.data.Content = c;
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#free_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginMessage = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_MESSAGE;
	this.data = null;
	this.no_check = !1
};
$.extend(PluginMessage.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_message()
	},
	show_data : function() {
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetPluginStoreMessage", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success ? (a.data = b.message, a
									.show_data()) : ShowActionError(b.error,
									"admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_message : function() {
		var a = this;
		$("#message_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5546\u57ce\u7559\u8a00",
					close : function() {
						a.get_data()
					}
				});
		$("#message_edit_dialog").dialog("open");//打开弹出层
		this.update_edit_dialog();//显示修改内容
	},
	update_edit_dialog : function() {
		var a = this, b = $("#message_edit_dialog");
		b.empty();
		var url = ctx+"/shop/admin/cmsPlugin!queryPlugins.do?ajax=yes&c=1";
		b.load(url,{},function(data){
			//初始化页面参数
			if (a.data.ShowTitle == 2 || a.data.ShowTitle == 3){
				b.find("input[name='title_show_set'][value='1']").attr("checked","checked");
				b.find("input[name='border_show_set']").each(function(){
					$(this).attr("disabled","disabled");
				});
			}
			
			if (a.data.ShowTitle != 2 && a.data.ShowTitle != 3){
				b.find("input[name='title_set']").attr("disabled","disabled");
			}
			
			if (a.data.ShowTitle != 2 && a.data.ShowTitle != 3){
				b.find("input[name='title_show_set'][value='0']").attr("checked","checked");
			}
			
			if (a.data.ShowTitle == 1 || a.data.ShowTitle == 3){
				b.find("input[name='border_show_set'][value='1']").attr("checked","checked");
			}

			if (a.data.ShowTitle != 1 && a.data.ShowTitle != 3){
				b.find("input[name='border_show_set'][value='0']").attr("checked","checked");
			}
			
			if (a.data.IsWrapper == "1"){
				b.find("input[name='is_wrapper'][value='1']").attr("checked","checked");
			}else {
				b.find("input[name='is_wrapper'][value='0']").attr("checked","checked");
			}
			
			b.find("#button_save").click(function() {
				var selectWidget = $("input[type='radio'][name='widget_id']:checked");
				if(!selectWidget){
					alert("请选择一个插件");
					return ;
				}
				var wigdet_id = selectWidget.attr("value");
				if(!wigdet_id){
					alert("请选择一个插件");
					return ;
				}
				var widget_image = selectWidget.attr("widget_image");
				a.data["Widget_id"]=wigdet_id;
				a.data["Widget_image"] = widget_image;
				var showTitle = $("input[type=radio][name=title_show_set]:checked").val();
				var style = $("input[type=radio][name=border_show_set]:checked").val();
				//showTitle
				//3有标题有边框 1没票题有边框 0都没有
				var st = 3;
				if(1 == showTitle){
					st=3;
				}else if(0==showTitle && 1==style){
					st=1;
				}else{
					st=0;
				}
				a.data["ShowTitle"] = st;
				//是否包裹内容
				var isWrapper = $("input[type=radio][name=is_wrapper]:checked").val();
				a.data["IsWrapper"] = isWrapper;
				a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
							url : getActionPath("EditPluginStoreMessage", "Store"),
							dataType : "json",
							contentType : "application/json",
							type : "POST",
							data : stringify({
										message : a.data
									}),
							success : function(c) {
								CloseLoadingDialog();
								!0 == c.success
										? (a.get_data(), b.dialog("close"))
										: ShowActionError(c.error, "admin")
							},
							error : function(a, b, e) {
								ShowAjaxError(a, b, e)
							}
						}))
			});
			
			b.find("#button_cancel").click(function() {
				b.dialog("close")
			});
			b.find("input[name=title_show_set]").change(function() {
				a.check_input(!0)
			});
			b.find("input[name=border_show_set]").change(function() {
				a.check_input(!0)
			});
		});
		/**
		$("#message_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditPluginStoreMessage", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									message : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (a.get_data(), b.dialog("close"))
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=input_type_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
		*/	
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#message_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		//this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		//this.data.InputType = Number(c
		//		.find("input[name=input_type_set]:checked").val());
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f)/*, this.data.Title = f*/);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#message_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditPluginStoreMessage", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									message : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginCarousel = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_CAROUSEL;
	this.data = null;
	this.max_photo = 10;
	this.curr_photo = 0;
	this.no_check = !1
};
$.extend(PluginCarousel.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.ad_change()
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising_id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success ? (a.data = b.Advertising, a
									.show_data()) : ShowActionError(b.error,
									"admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	ad_change : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#carousel_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 915,
								title : "\u7f16\u8f91\u5e7f\u544a\u56fe\u7247",
								close : function() {
									a.get_data()
								}
							});
					$("#carousel_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		var a = this, b = $("#carousel_edit_dialog");
		b.empty();
		$("#carousel_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find(".carousel_title_input").focus();
		b.find(".content_data_set").each(function() {
			var b = Number($(this).attr("index")), d = $(this);
			a.init_link_type(d.find("#link_param"), a.data.Advertising[b]);
			d.find("#link_type").change(function() {
				var a = $(this).find("option:selected").val(), b = $(this)
						.parents(".content");
				b.find(".link_param").hide();
				b.find("#link_param_" + a).show()
			})
		});
		a.check_input(!0) && a.canvas_preview();
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : a.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.dialog("close")
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find(".button_image").click(function() {
			if (a.check_input(!0)) {
				var b = Number($(this).parents(".content_data_set")
						.attr("index")), d = $(this)
						.parents(".image_preview_box").find("img"), e = a
						.get_parts_size(b + 1);
				(new ImageClipping(e.w, e.h, a.data.Advertising[b].PhotoId,
						Constant.IMAGE_QUALITY_BEST, function(e) {
							a.data.Advertising[b].PhotoId = e.id;
							a.data.Advertising[b].Url = e.path;
							d.attr("src", e.path);
							d.attr("photo_id", e.id);
							a.canvas_preview()
						})).open()
			}
		});
		0 < this.data.Advertising.length
				&& (this.data.Advertising.length > this.curr_photo ? this
						.select_photo(this.curr_photo) : this.select_photo(0));
		b.find(".plugin_set_tab li").mousedown(function() {
					if (a.check_input(!0)) {
						var c = b.find(".plugin_set_tab li").index($(this));
						a.select_photo(c)
					} else
						return !1
				});
		b.find(".plugin_set_tab").sortable({
			stop : function(c, d) {
				if (a.check_input(!0)
						&& (a.curr_photo = b.find(".plugin_set_tab li")
								.index(d.item), a.curr_photo != d.item
								.attr("order"))) {
					var e = [];
					b.find(".plugin_set_tab li").each(function() {
								e
										.push(a.data.Advertising[$(this)
												.attr("order")])
							});
					a.data.Advertising = e;
					a.curr_photo = b.find(".plugin_set_tab li").index(d.item);
					a.update_edit_dialog()
				}
			}
		});
		b.find(".advertising_add").click(function() {
					if (a.check_input(!0)
							&& a.data.Advertising.length < a.max_photo) {
						var b = {};
						b.Url = Config_Default_Image;
						b.Title = "";
						b.LinkType = 0;
						b.LinkParam = "";
						a.data.Advertising.push(b);
						a.curr_photo = a.data.Advertising.length - 1;
						a.update_edit_dialog()
					}
				});
		b.find(".advertising_del").click(function() {
			a.check_input(!0)
					&& (a.data.Advertising.length > a.curr_photo
							? 1 >= a.data.Advertising.length
									? alert("\u65e0\u6cd5\u5220\u9664\u56fe\u7247,\u8bf7\u4fdd\u7559\u81f3\u5c11\u4e00\u5f20\u56fe\u7247")
									: (a.data.Advertising.splice(a.curr_photo,
											1), a.curr_photo >= a.data.Advertising.length
											&& (a.curr_photo = a.data.Advertising.length
													- 1), a
											.update_edit_dialog())
							: alert("\u8bf7\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u56fe\u7247"))
		});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=show_text_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=gap_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=show_text_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#show_number_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find("#direction_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find("#interval_set").change(function() {
					a.check_input(!0)
							&& (a.update_edit_dialog(), a.canvas_preview())
				});
		b.find(".carousel_title_input").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find(".link_param").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	select_photo : function(a) {
		this.curr_photo = a;
		var b = $("#carousel_edit_dialog");
		b.find(".plugin_set_tab li").removeClass("checked");
		b.find(".plugin_set_tab li").eq(a).addClass("checked");
		b.find(".plugin_set_tab_content .content_data_set").hide();
		b.find(".plugin_set_tab_content .content_data_set").eq(a).show()
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#carousel_edit_dialog"), d = null, e = null, f = "";
		c.find(".plugin_set_content_img-show").focus();
		var h = c.find("input[name=title_show_set]:checked").val();
		1 == h ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var h = c.find("input[name=title_show_set]:checked").val(), g = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == h ? 3 : 2 * Number(h) + Number(g);
		this.data.Style = 0;
		h = c.find("input[name=title_set]");
		g = $.trim(h.val());
		g.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = h, e = 0, f = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (h.val(g), this.data.Title = g);
		h = {};
		h.ShowText = c.find("input[name=show_text_set]:checked").val();
		h.Gap = c.find("input[name=gap_set]:checked").val();
		h.ShowNumber = c.find("#show_number_set").val();
		h.Direction = c.find("#direction_set").val();
		h.Interval = c.find("#interval_set").val();
		this.data.Setting = h;
		(null == d || a)
				&& c.find(".plugin_set_tab_content .content_data_set").each(
						function() {
							var a = Number($(this).attr("index")), g = $(this), h = b
									.get_preview_position(a + 1, c
													.find(".image_preview")
													.width(), c
													.find(".image_preview")
													.height());
							c.find(".image_preview_img").width(h.w);
							c.find(".image_preview_img").height(h.h);
							c.find(".image_preview_img").css("margin-left",
									h.x + "px");
							c.find(".image_preview_img").css("margin-top",
									h.y + "px");
							var h = $(this).find(".carousel_title_input"), l = $
									.trim(h.val());
							l.length > Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
									? (d = h, e = a, f = "\u56fe\u7247\u6587\u5b57\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
											+ Constant.INPUT_PLUGIN_PHOTO_TITLE_MAX
											+ "\u5b57")
									: (h.val(l), b.data.Advertising[a].Title = l);
							h = Number($(this).find("#link_type")
									.find("option:selected").val());
							g = b.check_input_link_type(g, h);
							g.result
									? (b.data.Advertising[a].LinkType = h, b.data.Advertising[a].LinkParam = g.link_param)
									: (d = g.error_field, e = a, f = g.error_str)
						});
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(f);
		null != e && this.select_photo(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b, c) {
		a = 0 == a ? {
			w : this.frame.width(),
			h : this.frame.height()
		} : this.get_parts_size(a);
		a = a.w / a.h;
		var d = {};
		a > b / c
				? (d.w = b, d.h = b / a, d.x = 0, d.y = (c - d.h) / 2)
				: (d.w = b * a, d.h = c, d.x = (b - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#carousel_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(0, a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditAdvertising", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									advertising : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginHeader = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_HEADER;
	this.data = null;
	this.no_check = !1
};
$.extend(PluginHeader.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_header()
	},
	show_data : function() {
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetPluginHeader", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success
									? (a.data = b.header, a.show_data())
									: ShowActionError(b.error, "admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_header : function() {
		var a = this;
		$("#header_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5934\u90e8",
					close : function() {
						a.get_data()
					}
				});
		$("#header_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#header_edit_dialog");
		b.empty();
		$("#header_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditPluginHeader", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									header : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (a.get_data(), b.dialog("close"))
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=style_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find(".button_image").click(function() {
			if (a.check_input(!0)) {
				var b;
				b = 2 == a.data.Style ? {
					w : 220,
					h : 60
				} : a.get_parts_size(0);
				var d = $(this).parents(".image_preview_box").find("img");
				(new ImageClipping(b.w, b.h, a.data.PhotoId,
						Constant.IMAGE_QUALITY_BEST, function(b) {
							a.data.PhotoId = b.Id;
							a.data.PhotoUrl = b.Path;
							d.attr("src", b.Path);
							d.attr("photo_id", b.Id);
							a.canvas_preview()
						})).open()
			}
		})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#header_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = Number(c.find("input[name=style_set]:checked").val());
		0 == this.data.Style || 1 == this.data.Style ? c
				.find(".image_preview_box").hide() : c
				.find(".image_preview_box").show();
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#header_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditPluginHeader", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									header : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginButton = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_BUTTON;
	this.data = null;
	this.max_photo = 20;
	this.curr_photo = 0;
	this.no_check = !1;
	this.Link_type_info = null
};
$.extend(PluginButton.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_button()
	},
	show_data : function() {
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetPluginButton", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success
									? (a.data = b.button, a.show_data())
									: ShowActionError(b.error, "admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_button : function() {
		var a = this;
		this.get_store_link_type(function() {
					$("#button_edit_dialog").dialog({
								autoOpen : !1,
								resizable : !1,
								modal : !0,
								width : 915,
								title : "\u7f16\u8f91\u6309\u94ae\u5bfc\u822a",
								close : function() {
									a.get_data()
								}
							});
					$("#button_edit_dialog").dialog("open");
					a.update_edit_dialog()
				}, null)
	},
	update_edit_dialog : function() {
		function a(a, b) {
			c.find("#style_set").empty();
			$("#button_edit_type" + a + "_style_tmpl").tmpl({
						style : b
					}).appendTo(c.find("#style_set"));
			switch (Number(a)) {
				case Constant.PLUGIN_BUTTON_TYPE_ICON :
				case Constant.PLUGIN_BUTTON_TYPE_ICON_TEXT :
					c.find(".button_icon").show();
					break;
				default :
					c.find(".button_icon").hide()
			}
		}
		var b = this, c = $("#button_edit_dialog");
		c.empty();
		$("#button_edit_dialog_tmpl").tmpl(this).appendTo(c);
		c.find("input[name=title_set]").focus();
		c.find(".content_data_set").each(function() {
			var a = Number($(this).attr("index")), c = $(this);
			b.init_link_type(c.find("#link_param"), b.data.ButtonData[a]);
			c.find("#link_type").change(function() {
				var a = $(this).find("option:selected").val(), b = $(this)
						.parents(".content");
				b.find(".link_param").hide();
				b.find("#link_param_" + a).show()
			})
		});
		c.find("input[name=title_set]").blur(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("#button_save").click(function() {
			b.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditPluginButton", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									button : b.data
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? (b.get_data(), c.dialog("close"))
									: ShowActionError(a.error, "admin")
						},
						error : function(a, b, c) {
							ShowAjaxError(a, b, c)
						}
					}))
		});
		a(b.data.Type, b.data.Style);
		0 < this.data.ButtonData.length
				&& (this.data.ButtonData.length > this.curr_photo ? this
						.select_photo(this.curr_photo) : this.select_photo(0));
		c.find(".plugin_set_tab li").mousedown(function() {
					if (b.check_input(!0)) {
						var a = c.find(".plugin_set_tab li").index($(this));
						b.select_photo(a)
					} else
						return !1
				});
		c.find(".plugin_set_tab").sortable({
			stop : function(a, e) {
				if (b.check_input(!0)
						&& (b.curr_photo = c.find(".plugin_set_tab li")
								.index(e.item), b.curr_photo != e.item
								.attr("order"))) {
					var f = [];
					c.find(".plugin_set_tab li").each(function() {
								f
										.push(b.data.ButtonData[$(this)
												.attr("order")])
							});
					b.data.ButtonData = f;
					b.curr_photo = c.find(".plugin_set_tab li").index(e.item);
					b.update_edit_dialog()
				}
			}
		});
		c.find(".button_add").click(function() {
			b.check_input(!0)
					&& b.data.ButtonData.length < b.max_photo
					&& (b.data.ButtonData.push({
								Icon : 0,
								Title : "",
								LinkType : 0,
								LinkParam : ""
							}), b.curr_photo = b.data.ButtonData.length - 1, b
							.update_edit_dialog())
		});
		c.find(".button_del").click(function() {
			b.check_input(!0)
					&& (b.data.ButtonData.length > b.curr_photo
							? 1 >= b.data.ButtonData.length
									? alert("\u65e0\u6cd5\u5220\u9664\u94fe\u63a5,\u8bf7\u4fdd\u7559\u81f3\u5c11\u4e00\u5f20\u94fe\u63a5")
									: (b.data.ButtonData
											.splice(b.curr_photo, 1), b.curr_photo >= b.data.ButtonData.length
											&& (b.curr_photo = b.data.ButtonData.length
													- 1), b
											.update_edit_dialog())
							: alert("\u8bf7\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u94fe\u63a5"))
		});
		c.find("#button_cancel").click(function() {
					c.dialog("close")
				});
		c.find("#button_preview").click(function() {
					b.check_input(!1) && b.preview()
				});
		c.find("input[name=title_show_set]").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("input[name=border_show_set]").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("#type_set").change(function() {
					a(c.find("#type_set").val(), 0);
					b.check_input(!0) && b.canvas_preview()
				});
		c.find("#style_set").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find(".button_title_input").blur(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		c.find(".button_icon_input").change(function() {
					b.check_input(!0) && b.canvas_preview()
				});
		b.check_input(!0) && b.canvas_preview()
	},
	select_photo : function(a) {
		this.curr_photo = a;
		var b = $("#button_edit_dialog");
		b.find(".plugin_set_tab li").removeClass("checked");
		b.find(".plugin_set_tab li").eq(a).addClass("checked");
		b.find(".plugin_set_tab_content .content_data_set").hide();
		b.find(".plugin_set_tab_content .content_data_set").eq(a).show()
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#button_edit_dialog"), d = null, e = null, f = "";
		c.find(".plugin_set_content_img-show").focus();
		var h = c.find("input[name=title_show_set]:checked").val();
		1 == h ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var h = c.find("input[name=title_show_set]:checked").val(), g = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == h ? 3 : 2 * Number(h) + Number(g);
		this.data.Type = Number(c.find("#type_set").val());
		this.data.Style = Number(c.find("#style_set").val());
		h = c.find("input[name=title_set]");
		g = $.trim(h.val());
		g.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = h, f = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (h.val(g), this.data.Title = g);
		(null == d || a)
				&& c.find(".plugin_set_tab_content .content_data_set").each(
						function() {
							var a = Number($(this).attr("index")), c = $(this), g = $(this)
									.find(".button_title_input"), h = $.trim(g
									.val());
							h.length > Constant.INPUT_PLUGIN_BUTTON_TITLE_MAX
									? (d = g, e = a, f = "\u6587\u5b57\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
											+ Constant.INPUT_PLUGIN_BUTTON_TITLE_MAX
											+ "\u5b57")
									: (g.val(h), b.data.ButtonData[a].Title = h);
							g = $(this).find(".button_icon_input").val();
							b.data.ButtonData[a].Icon = g;
							g = Number($(this).find("#link_type")
									.find("option:selected").val());
							c = b.check_input_link_type(c, g);
							c.result
									? (b.data.ButtonData[a].LinkType = g, b.data.ButtonData[a].LinkParam = c.link_param)
									: (d = c.error_field, e = a, f = c.error_str)
						});
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(f);
		null != e && this.select_photo(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#button_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditPluginButton", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									button : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});
var PluginCoupon = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_COUPON;
	this.data = null;
	this.no_check = !1
};
$.extend(PluginCoupon.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_coupon()
	},
	show_data : function() {
		iStorePlugin.prototype.show_data.apply(this)
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetPluginStoreCoupon", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success
									? (a.data = b.coupon, a.show_data())
									: ShowActionError(b.error, "admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_coupon : function() {
		var a = this;
		$("#coupon_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u5546\u57ce\u4f18\u60e0\u5238",
					close : function() {
						a.get_data()
					}
				});
		$("#coupon_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#coupon_edit_dialog");
		b.empty();
		$("#coupon_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditPluginStoreCoupon", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									coupon : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (a.get_data(), b.dialog("close"))
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#coupon_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#coupon_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditPluginStoreCoupon", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									coupon : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});

var PluginNew = function(a) {
	iStorePlugin.apply(this, [a]);
	this.plugin_type = Constant.PLUGIN_TYPE_NEW;
	this.data = this.editor = null;
	this.no_check = !1
};
$.extend(PluginNew.prototype, iStorePlugin.prototype, {
	on_setting : function() {
		if (null != this.opts.on_setting)
			this.opts.on_setting(this);
		else
			this.edit_free()
	},
	get_data : function() {
		if (0 <= this.plugin_id) {
			var a = this;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("GetStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_id : this.plugin_id
								}),
						success : function(b) {
							CloseLoadingDialog();
							!0 == b.success
									? (a.data = b.free, a.show_data())
									: ShowActionError(b.error, "admin")
						},
						error : function(a, c, d) {
							ShowAjaxError(a, c, d)
						}
					})
		}
	},
	edit_free : function() {
		var a = this;
		$("#free_edit_dialog").dialog({
					autoOpen : !1,
					resizable : !1,
					modal : !0,
					width : 915,
					title : "\u7f16\u8f91\u81ea\u7531\u53d1\u6325",
					close : function() {
						KindEditor.remove("#dialog_free_content");
						a.editor = null;
						a.get_data()
					}
				});
		$("#free_edit_dialog").dialog("open");
		this.update_edit_dialog()
	},
	update_edit_dialog : function() {
		var a = this, b = $("#free_edit_dialog");
		b.empty();
		$("#free_edit_dialog_tmpl").tmpl(this).appendTo(b);
		b.find("#free_content").attr("id", "dialog_free_content");
		this.editor = KindEditor.create("#dialog_free_content", {
			filterMode : !1,
			wellFormatMode : !1,
			allowFileManager : !0,
			fileManagerJson : getActionPath("KindFileManager", "AdminOperation"),
			minWidth : 508,
			width : "508px",
			height : "324px",
			resizeType : 0,
			items : "source | fullscreen | undo redo | cut copy paste plainpaste wordpaste | image multiimage flash media insertfile table hr anchor link unlink | justifyleft justifycenter justifyright justifyfull selectall | formatblock fontname fontsize | forecolor hilitecolor bold italic underline strikethrough lineheight removeformat"
					.split(" "),
			afterBlur : function() {
				a.canvas_preview()
			}
		});
		b.find("input[name=title_set]").focus();
		a.check_input(!0) && a.canvas_preview();
		b.find("input[name=title_set]").blur(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("#button_save").click(function() {
			a.check_input(!1) && (OpenLoadingDialog(), $.ajax({
						url : getActionPath("EditStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_info : a.data
								}),
						success : function(c) {
							CloseLoadingDialog();
							!0 == c.success
									? (a.get_data(), b.dialog("close"))
									: ShowActionError(c.error, "admin")
						},
						error : function(a, b, e) {
							ShowAjaxError(a, b, e)
						}
					}))
		});
		b.find("#button_cancel").click(function() {
					b.dialog("close")
				});
		b.find("#button_preview").click(function() {
					a.check_input(!1) && a.preview()
				});
		b.find("input[name=title_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				});
		b.find("input[name=border_show_set]").change(function() {
					a.check_input(!0) && a.canvas_preview()
				})
	},
	check_input : function(a) {
		if (this.no_check)
			return !1;
		var b = this, c = $("#free_edit_dialog"), d = null, e = "";
		c.find(".plugin_set_content_img-show").focus();
		var f = c.find("input[name=title_show_set]:checked").val();
		1 == f ? (c.find("input[name=title_set]").attr("disabled", !1), c
				.find("input[name=border_show_set][value=1]").attr("checked",
						!0), c.find("input[name=border_show_set]").attr(
				"disabled", !0)) : (c.find("input[name=title_set]").attr(
				"disabled", !0), c.find("input[name=border_show_set]").attr(
				"disabled", !1));
		var f = c.find("input[name=title_show_set]:checked").val(), h = c
				.find("input[name=border_show_set]:checked").val();
		this.data.ShowTitle = 1 == f ? 3 : 2 * Number(f) + Number(h);
		this.data.Style = 0;
		c = c.find("input[name=title_set]");
		f = $.trim(c.val());
		f.length > Constant.INPUT_PLUGIN_TITLE_MAX
				? (d = c, e = "\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
						+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57")
				: (c.val(f), this.data.Title = f);
		if (null == d || a)
			c = null != this.editor ? this.editor.html() : "", c.length > Constant.INPUT_PLUGIN_FREE_CONTENT_MAX
					? (d = $(".plugin_set_content"), e = "\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7"
							+ Constant.INPUT_PLUGIN_FREE_CONTENT_MAX + "\u5b57")
					: this.data.Content = c;
		if (null == d || a)
			return !0;
		this.no_check = !0;
		alert(e);
		setTimeout(function() {
					d.focus();
					b.no_check = !1
				}, 100);
		return !1
	},
	get_preview_position : function(a, b) {
		inner_size = {
			w : this.frame.width(),
			h : this.frame.height()
		};
		var c = inner_size.w / inner_size.h, d = {};
		c > a / b
				? (d.w = a, d.h = a / c, d.x = 0, d.y = (b - d.h) / 2)
				: (d.w = a * c, d.h = b, d.x = (a - d.w) / 2, d.y = 0);
		return d
	},
	canvas_preview : function() {
		var a = $("#free_edit_dialog").find(".plugin_set_content_img-show"), b = this
				.get_preview_position(a.width(), a.height());
		a.empty();
		var c = $("<div></div>");
		c.width(b.w);
		c.height(b.h);
		c.css("margin-left", b.x + "px");
		c.css("margin-top", b.y + "px");
		c.appendTo(a);
		this.preview(c, b.w, b.h)
	},
	change_title : function(a) {
		var b = this;
		a = $.trim(a);
		if (a.length > Constant.INPUT_PLUGIN_TITLE_MAX)
			alert("\u6807\u9898\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"
					+ Constant.INPUT_PLUGIN_TITLE_MAX + "\u5b57");
		else {
			var c = $.extend({}, this.data);
			c.Title = a;
			OpenLoadingDialog();
			$.ajax({
						url : getActionPath("EditStoreFree", "Store"),
						dataType : "json",
						contentType : "application/json",
						type : "POST",
						data : stringify({
									free_info : c
								}),
						success : function(a) {
							CloseLoadingDialog();
							!0 == a.success
									? b.get_data()
									: (b.get_data(), ShowActionError(a.error,
											"admin"))
						},
						error : function(a, c, f) {
							ShowAjaxError(a, c, f);
							b.get_data()
						}
					})
		}
	}
});

var iStorePluginDef = [{ //add by wui
			plugin_type : Constant.PLUGIN_TYPE_ADVERTISING,
			plugin_class : PluginAdvertising
		}, {
			plugin_type : Constant.PLUGIN_TYPE_IMAGE,
			plugin_class : PluginImage
		}, {
			plugin_type : Constant.PLUGIN_TYPE_SHOWCASE1,
			plugin_class : PluginShowcase1
		}, {
			plugin_type : Constant.PLUGIN_TYPE_SHOWCASE2,
			plugin_class : PluginShowcase2
		}, {
			plugin_type : Constant.PLUGIN_TYPE_SHOWCASE3,
			plugin_class : PluginShowcase3
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NAV_ALL,
			plugin_class : PluginNavAll
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NAV_V,
			plugin_class : PluginNavV
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NAV_H,
			plugin_class : PluginNavH
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NEWS_TEXT,
			plugin_class : PluginNewsText
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NEWS_GRAPHIC,
			plugin_class : PluginNewsGraphic
		}, {
			plugin_type : Constant.PLUGIN_TYPE_FREE,
			plugin_class : PluginFree
		}, {
			plugin_type : Constant.PLUGIN_TYPE_MESSAGE,
			plugin_class : PluginMessage
		}, {
			plugin_type : Constant.PLUGIN_TYPE_CAROUSEL,
			plugin_class : PluginCarousel
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NAV_TAG,
			plugin_class : PluginNavTag
		}, {
			plugin_type : Constant.PLUGIN_TYPE_HEADER,
			plugin_class : PluginHeader
		}, {
			plugin_type : Constant.PLUGIN_TYPE_BUTTON,
			plugin_class : PluginButton
		}, {
			plugin_type : Constant.PLUGIN_TYPE_COUPON,
			plugin_class : PluginCoupon
		}, {
			plugin_type : Constant.PLUGIN_TYPE_NEW,
			plugin_class : PluginNew
		}];
var iStoreContainers = function(a) {
	this.opts = $.extend({}, {
				selector : "body",
				auto_scroll : !1,
				scroll_container : null,
				zoom : 1,
				move_margin : 0,
				size_margin : -10,
				frame_config : Constant.ISTORE_FRAME_CONFIG_PC_STYLE0,
				on_sized : null,
				on_scroll : null,
				on_updata_layout_start : null,
				on_updata_layout_end : null
			}, a);//add by wui设置展示容器区域
	this.frame = $(this.opts.selector); //add by wuistore容器处理器
	this.plugins = [];
	this.grid_width = csharp_get_max_grid_width(this.opts.frame_config);
	this.grid_height = 1;
	this.grid_back = null;
//	alert(this.grid_width+":"+this.grid_width)
	this.virtual_containers = $('<div id="virtual_containers"></div>')
			.addClass("virtual_containers").appendTo(this.frame).hide();
	this.frame.disableSelection();
	this.set_size(1)
};
iStoreContainers.prototype = { //容器处理器处理
	set_size : function(a) {
		this.grid_height = a;
		a = this.grid_to_pos(0, 0, this.grid_width, this.grid_height);
		this.frame.width(a.width);
		this.frame.height(a.height);
		if (null != this.opts.on_sized)
			this.opts.on_sized(this.frame.width(), this.frame.height())
	},
	add_plugin : function(a) {//1
		a.is_new = !1;
		a.get_body().appendTo(this.frame);
		this.plugins.push(a);
		this.plugin_move_all(this.plugins);
		a.show_normal();
		a.show();
		a.on_show(!1);
		this.update_scorll()
	},
	show_virtual_containers : function(a, b, c, d, e) {
		a = this.grid_to_pos(a, b, c, d);
		this.virtual_containers.css("left", a.x1 + 1 + "px");
		this.virtual_containers.css("top", a.y1 + 1 + "px");
		e
				? (this.virtual_containers.addClass("virtual_containers_ok"), this.virtual_containers
						.removeClass("virtual_containers_ng"))
				: (this.virtual_containers.removeClass("virtual_containers_ok"), this.virtual_containers
						.addClass("virtual_containers_ng"));
		this.virtual_containers.width(a.width - 6);
		this.virtual_containers.height(a.height - 6);
		this.virtual_containers.show()
	},
	hide_virtual_containers : function() {
		this.virtual_containers.hide()
	},
	grid_virtual_containers : function() {
		var a = this.virtual_containers.position(), b = this.pos_to_grid(
				a.left, a.top, !1), a = this.pos_to_grid(a.left
						+ this.virtual_containers.width()
						+ this.opts.size_margin, a.top
						+ this.virtual_containers.height()
						+ this.opts.size_margin, !1);
		return {
			x : b.x,
			y : b.y,
			cx : a.x - b.x + 1,
			cy : a.y - b.y + 1
		}
	},
	on_move_start : function(a, b, c) { //add by wuimove a为插件对象 b为拖动拖拽对象
		this.grid_back = null;
		
		a.add_pos = {
			left : 0,
			top : 0
		};
		a.get_body().hide();
		if (a.is_new) {
			a.grid_cx = a.opts.grid_cx_init;
			a.grid_cy = a.opts.grid_cy_init;
			var d = this.frame.offset(), e = c.helper.offset();
			a.add_pos.left = e.left - d.left;
			a.add_pos.top = e.top - d.top
		}
		a.drag_helper = a.get_body().clone(!1).appendTo(this.frame);
		a.drag_helper.show();
		a.drag_helper.css({
					opacity : 0.4
				});
		a.mouse_pos = {
			left : b.pageX - c.offset.left,
			top : b.pageY - c.offset.top
		};
		a.mouse_scroll_pos = {
			left : 0,
			top : 0
		};
		this.opts.auto_scroll
				&& null != this.opts.scroll_container
				&& (a.mouse_scroll_pos.left = this.opts.scroll_container
						.scrollLeft(), a.mouse_scroll_pos.top = this.opts.scroll_container
						.scrollTop());
		a.is_moving = !0;
		c.helper.hide();
		b = this.get_plugin_offset(a, c);
		b = this.pos_to_grid(b.left, b.top, !1);
		this.show_virtual_containers(b.x, b.y, a.grid_cx, a.grid_cy, !1)
	},
	on_move_stop : function(a, b, c) {
		c.helper.remove();
		a.drag_helper.remove();
		this.hide_virtual_containers();
		this.grid_back = null;
		var d = this;
		b = this.get_plugin_offset(a, c);
		b = this.pos_to_grid(b.left, b.top, !1);
		b = this.check_containable(a, b.x, b.y, a.grid_cx, a.grid_cy);
		a.is_moving = !1;
		a.frame.css({
					opacity : 1
				});
		a.get_body().show();
		if (b.result) {
			this.on_updata_layout_start();
			for (c = 0; c < b.pos.length; c++) {
				var e = b.pos[c].id;
				0 <= e
						&& (this.plugins[e].grid_x != b.pos[c].grid_x || this.plugins[e].grid_y != b.pos[c].grid_y)
						&& (this.plugins[e].grid_x = b.pos[c].grid_x, this.plugins[e].grid_y = b.pos[c].grid_y, this.plugins[e]
								.on_moved(b.pos[c].grid_x, b.pos[c].grid_y))
			}
			c = this.grid_to_pos(b.grid_x, b.grid_y, a.grid_cx, a.grid_cy);
			a.move(c.x1, c.y1, c.width, c.height);
			a.grid_x = b.grid_x;
			a.grid_y = b.grid_y;
			if (a.is_new)
				a.is_new = !1, a.get_body().appendTo(this.frame), this.plugins
						.push(a), a.on_dropdown(!0, b.grid_x, b.grid_y), a
						.get_body().bind("on_trash", function(b) {
									d.hide_virtual_containers();
									a.on_remove();
									return !1
								}), a.show_normal();
			else
				a.on_show(!1);
			this.on_updata_layout_end()
		} else
			a.is_new
					? (a.remove(), a.on_dropdown(!1, b.grid_x, b.grid_y))
					: (this.plugin_move_all(this.plugins), a.on_show(!1));
		this.update_scorll()
	},
	on_move_drag : function(a, b, c) {
		b = this.get_plugin_offset(a, c);
		c = this.pos_to_grid(b.left, b.top, !1);
		if (null == this.grid_back || this.grid_back.x != c.x
				|| this.grid_back.y != c.y || this.grid_back.cx != c.cx
				|| this.grid_back.cy != c.cy) {
			var d = this.check_containable(a, c.x, c.y, a.grid_cx, a.grid_cy);
			this.show_virtual_containers(d.grid_x, d.grid_y, a.grid_cx,
					a.grid_cy, d.result);
			a.on_sizing(a.grid_cx, a.grid_cy);
			this.grid_back = c
		}
		this.opts.auto_scroll
				&& null != this.opts.scroll_container
				&& (a = this.opts.scroll_container, a.scrollLeft(), b = b.top
						- a.scrollTop() / this.opts.zoom, b > a.height()
						/ this.opts.zoom ? (b = a.scrollTop(), (b + a.height())
						/ this.opts.zoom < this.frame.height() + 100
						&& a.scrollTop(b + 20)) : 0 > b
						&& a.scrollTop(a.scrollTop() - 20))
	},
	on_size_start : function(a, b, c) {
		this.grid_back = null;
		a.is_moving = !0;
		c.helper.hide();
		a.mouse_size = $.extend({}, c.size);
		this.show_virtual_containers(a.grid_x, a.grid_y, a.grid_cx, a.grid_cy,
				!0);
		a.frame.css({
					opacity : 0.4
				})
	},
	on_size_stop : function(a, b, c) {
		this.grid_back = null;
		b = this.grid_to_pos(a.grid_x, a.grid_y, a.grid_cx, a.grid_cy);
		c = this.pos_to_grid(b.x1 + a.mouse_size.width
						+ (c.size.width - a.mouse_size.width) / this.opts.zoom,
				b.y1 + a.mouse_size.height
						+ (c.size.height - a.mouse_size.height)
						/ this.opts.zoom, !0);
		c = a.get_right_size(a.grid_x, a.grid_y, c.x - a.grid_x + 1, c.y
						- a.grid_y + 1);
		this.hide_virtual_containers();
		b = this.check_containable(a, a.grid_x, a.grid_y, c.cx, c.cy);
		a.frame.css({
					opacity : 1
				});
		a.is_moving = !1;
		if (b.result) {
			this.on_updata_layout_start();
			for (var d = 0; d < b.pos.length; d++) {
				var e = b.pos[d].id;
				0 <= e
						&& (this.plugins[e].grid_x != b.pos[d].grid_x || this.plugins[e].grid_y != b.pos[d].grid_y)
						&& (this.plugins[e].grid_x = b.pos[d].grid_x, this.plugins[e].grid_y = b.pos[d].grid_y, this.plugins[e]
								.on_moved(b.pos[d].grid_x, b.pos[d].grid_y))
			}
			b = this.grid_to_pos(a.grid_x, a.grid_y, c.cx, c.cy);
			a.move(b.x1, b.y1, b.width, b.height);
			if (a.grid_cx != c.cx || a.grid_cy != c.cy)
				a.grid_cx = c.cx, a.grid_cy = c.cy, a.on_sized(c.cx, c.cy);
			this.on_updata_layout_end()
		} else
			this.plugin_move_all(this.plugins);
		a.on_show(!1);
		this.update_scorll()
	},
	on_size_resize : function(a, b, c) {
		b = this.grid_to_pos(a.grid_x, a.grid_y, a.grid_cx, a.grid_cy);
		c = this.pos_to_grid(b.x1 + a.mouse_size.width
						+ (c.size.width - a.mouse_size.width) / this.opts.zoom,
				b.y1 + a.mouse_size.height
						+ (c.size.height - a.mouse_size.height)
						/ this.opts.zoom, !0);
		if (null == this.grid_back || this.grid_back.x != c.x
				|| this.grid_back.y != c.y || this.grid_back.cx != c.cx
				|| this.grid_back.cy != c.cy)
			b = a.get_right_size(a.grid_x, a.grid_y, c.x - a.grid_x + 1, c.y
							- a.grid_y + 1), this.grid_to_pos(a.grid_x,
					a.grid_y, b.cx, b.cy), a.on_sizing(b.grid_cx, b.grid_cy), a = this
					.check_containable(a, a.grid_x, a.grid_y, b.cx, b.cy), this
					.show_virtual_containers(a.grid_x, a.grid_y, b.cx, b.cy,
							a.result), this.grid_back = c
	},
	remove_plugin : function(a) {
		for (var b = 0; b < this.plugins.length; b++)
			this.plugins[b].grid_x == a.grid_x
					&& this.plugins[b].grid_y == a.grid_y
					&& this.plugins.splice(b, 1);
		a.remove();
		a = this.create_moving_pos(a);
		a = this.tidy_pos(a);
		this.move_all(a, !1);
		this.on_updata_layout_start();
		for (b = 0; b < a.length; b++) {
			var c = a[b].id;
			0 <= c
					&& (this.plugins[c].grid_x != a[b].grid_x || this.plugins[c].grid_y != a[b].grid_y)
					&& (this.plugins[c].grid_x = a[b].grid_x, this.plugins[c].grid_y = a[b].grid_y, this.plugins[c]
							.on_moved(a[b].grid_x, a[b].grid_y))
		}
		this.on_updata_layout_end();
		this.update_scorll()
	},
	update_scorll : function() {
		if (this.opts.auto_scroll && null != this.opts.scroll_container) {
			var a = this.opts.scroll_container, b = a.scrollTop(), c = a
					.height(), d = this.frame.height() * this.opts.zoom;
			d <= c || 0 > b ? a.scrollTop(0) : b + c > d + 100
					&& a.scrollTop(d - c);
			if (null != this.opts.on_scroll)
				this.opts.on_scroll(this.opts.scroll_container.scrollLeft(),
						this.opts.scroll_container.scrollTop(), this.frame
								.width()
								* this.opts.zoom, this.frame.height()
								* this.opts.zoom)
		}
	},
	get_plugin_offset : function(a, b) {
		var c = $.extend({}, b.position);
		this.opts.auto_scroll
				&& null != this.opts.scroll_container
				&& (c.left += this.opts.scroll_container.scrollLeft(), c.top += this.opts.scroll_container
						.scrollTop());
		c.left = (c.left + a.add_pos.left) / this.opts.zoom;
		c.top = (c.top + a.add_pos.top) / this.opts.zoom;
		a.drag_helper.css("left", c.left - a.mouse_scroll_pos.left
						/ this.opts.zoom + "px");
		a.drag_helper.css("top", c.top - a.mouse_scroll_pos.top
						/ this.opts.zoom + "px");
		null != a.mouse_pos
				&& (c.left += a.mouse_pos.left / this.opts.zoom, c.top += a.mouse_pos.top
						/ this.opts.zoom);
		null != a.mouse_scroll_pos
				&& (c.left -= a.mouse_scroll_pos.left / this.opts.zoom, c.top -= a.mouse_scroll_pos.top
						/ this.opts.zoom);
		return c
	},
	pos_to_grid : function(a, b, c) {
		a = csharp_pos_to_grid(this.opts.frame_config, Math.round(a), Math
						.round(b), c);
		a.x = parseInt(a.x);
		a.y = parseInt(a.y);
		return a
	},
	grid_to_pos : function(a, b, c, d) {
		return csharp_grid_to_pos(this.opts.frame_config, a, b, c, d)
	},
	check_containable : function(a, b, c, d, e) {
		var f = {}, h = this.create_moving_pos(a);
		f.grid_x = b;
		f.grid_y = c;
		a = [];
		for (var g = null, k = 0; k < h.length; k++)
			h[k].is_moving ? g = h[k] : a.push(h[k]);
		a = this.tidy_pos(a);
		g.grid_x = b;
		g.grid_y = c;
		g.grid_cx = d;
		g.grid_cy = e;
		a.push(g);
		if (this.judge_containable(a, b, c, d, e)) {
			for (b = 0; b < a.length; b++)
				!a[b].is_moving && a[b].grid_y >= c && (a[b].grid_y += e);
			f.pos = this.tidy_pos(a);
			for (k = 0; k < f.pos.length; k++)
				f.pos[k].is_moving
						&& (f.grid_x = f.pos[k].grid_x, f.grid_y = f.pos[k].grid_y, f.grid_cx = f.pos[k].grid_cx, f.grid_cy = f.pos[k].grid_cy);
			f.result = !0
		} else
			f.pos = a, f.result = !1;
		this.move_all(f.pos, f.result);
		return f
	},
	tidy_pos : function(a) {
		for (var b = [], c = 0; c < a.length; c++)
			b.push($.extend({}, a[c]));
		b.sort(function(a, b) {
					if (a.grid_y > b.grid_y)
						return 1;
					if (a.grid_y < b.grid_y)
						return -1;
					if (a.grid_x > b.grid_x)
						return 1;
					if (a.grid_x < b.grid_x)
						return -1
				});
		for (c = 0; c < b.length; c++) {
			if (0 == c)
				a = 0;
			else {
				a = b[c].grid_y;
				for (var d = b[c].grid_y; 0 <= d; d--) {
					for (var e = !0, f = c - 1; 0 <= f; f--)
						if (!(d >= b[f].grid_y + b[f].grid_cy || d
								+ b[c].grid_cy <= b[f].grid_y)) {
							if (b[c].grid_x >= b[f].grid_x
									&& b[c].grid_x < b[f].grid_x + b[f].grid_cx) {
								e = !1;
								break
							}
							if (b[c].grid_x + b[c].grid_cx > b[f].grid_x
									&& b[c].grid_x + b[c].grid_cx <= b[f].grid_x
											+ b[f].grid_cx) {
								e = !1;
								break
							}
							if (b[c].grid_x <= b[f].grid_x
									&& b[c].grid_x + b[c].grid_cx >= b[f].grid_x
											+ b[f].grid_cx) {
								e = !1;
								break
							}
						}
					if (e)
						a = d;
					else
						break
				}
			}
			b[c].grid_y = a
		}
		return b
	},
	create_moving_pos : function(a) {
		for (var b = [], c = 0; c < this.plugins.length; c++)
			b[c] = {}, b[c].id = c, b[c].grid_x = this.plugins[c].grid_x, b[c].grid_y = this.plugins[c].grid_y, b[c].grid_cx = this.plugins[c].grid_cx, b[c].grid_cy = this.plugins[c].grid_cy, b[c].is_new = !1, b[c].is_moving = this.plugins[c].is_moving;
		a.is_new && b.push({
					id : -1,
					grid_x : a.grid_x,
					grid_y : a.grid_y,
					grid_cx : a.grid_cx,
					grid_cy : a.grid_cy,
					is_new : !0,
					is_moving : !0
				});
		return b
	},
	create_containable_info : function(a, b) {
		for (var c = [], d = this.get_max_height(a, b), e = 0; e < d; e++) {
			c[e] = [];
			for (var f = 0; f < this.grid_width; f++)
				c[e][f] = -1
		}
		for (e = 0; e < a.length; e++)
			for (f = a[e].grid_y; f < a[e].grid_y + a[e].grid_cy; f++)
				for (d = a[e].grid_x; d < a[e].grid_x + a[e].grid_cx; d++)
					a[e].is_moving || (c[f][d] = e);
		return c
	},
	judge_containable : function(a, b, c, d, e) {
		if (b + d > this.grid_width || c > this.grid_height)
			return !1;
		e = !0;
		grids = this.create_containable_info(a, !1);
		if (c < grids.length)
			for (var f = b; f < b + d; f++)
				if (0 <= f && f < this.grid_width) {
					var h = grids[c][f];
					if (0 <= h && a[h].grid_y < c) {
						e = !1;
						break
					}
				} else {
					e = !1;
					break
				}
		else
			e = c == grids.length ? !0 : !1;
		return e
	},
	plugin_move_all : function(a) {
		for (var b = 0; b < a.length; b++) {
			var c = this.grid_to_pos(a[b].grid_x, a[b].grid_y, a[b].grid_cx,
					a[b].grid_cy);
			this.plugins[b].move(c.x1, c.y1, c.width, c.height)
		}
		this.set_size(this.get_max_height(a, !1))
	},
	move_all : function(a, b) {
		for (var c = 0; c < a.length; c++) {
			var d = a[c].id;
			if (0 <= d) {
				var e = this.grid_to_pos(a[c].grid_x, a[c].grid_y,
						a[c].grid_cx, a[c].grid_cy);
				this.plugins[d].move(e.x1, e.y1, e.width, e.height)
			}
		}
		this.set_size(this.get_max_height(a, b))
	},
	get_max_height : function(a, b) {
		for (var c = 1, d = 0; d < a.length; d++)
			(!a[d].is_moving || b) && a[d].grid_y + a[d].grid_cy > c
					&& (c = a[d].grid_y + a[d].grid_cy);
		return c
	},
	clear : function() {
		for (var a = 0; a < this.plugins.length; a++)
			this.plugins[a].remove();
		this.plugins = [];
		this.plugin_move_all(this.plugins)
	},
	on_updata_layout_start : function() {
		if (null != this.opts.on_updata_layout_start)
			this.opts.on_updata_layout_start()
	},
	on_updata_layout_end : function() {
		if (null != this.opts.on_updata_layout_end)
			this.opts.on_updata_layout_end()
	}
};
var plugin_icon_advertising = getContentPath("Content/Admin/images/icon_01.png"), 
	plugin_icon_image = getContentPath("Content/Admin/images/icon_02.png"), 
	plugin_icon_showcase1 = getContentPath("Content/Admin/images/icon_05.png"), 
	plugin_icon_showcase2 = getContentPath("Content/Admin/images/icon_06.png"), 
	plugin_icon_showcase3 = getContentPath("Content/Admin/images/icon_07.png"), 
	plugin_icon_nav_all = getContentPath("Content/Admin/images/icon_08.png"), 
	plugin_icon_nav_v = getContentPath("Content/Admin/images/icon_09.png"), 
	plugin_icon_nav_h = getContentPath("Content/Admin/images/icon_09.png"), 
	plugin_icon_news_text = getContentPath("Content/Admin/images/icon_03.png"), 
	plugin_icon_news_graphic = getContentPath("Content/Admin/images/icon_04.png"), 
	plugin_icon_free = getContentPath("Content/Admin/images/icon_10.png"), 
	plugin_icon_message = getContentPath("Content/Admin/images/icon_11.png"), 
	plugin_icon_coupon = getContentPath("Content/Admin/images/icon_16.png"), 
	plugin_icon_carousel = getContentPath("Content/Admin/images/icon_12.png"), 
	plugin_icon_nav_tag = getContentPath("Content/Admin/images/icon_13.png"), 
	plugin_icon_new = getContentPath("Content/Admin/images/icon_16.png"),
	
	istore_option = {
	selector : "#store_containers",
	page_id : 0,
	move_margin : 0,
	size_margin : -10,
	frame_config : Constant.ISTORE_FRAME_CONFIG_PC_STYLE0,
	on_sized : function(a, b) {
		$(".contentmainbox").height(b)
	}
}, plugin_option = [{
	plugin_type : Constant.PLUGIN_TYPE_ADVERTISING,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u5e7f\u544a\u8f6e\u64ad" src="'
			+ plugin_icon_advertising + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_advertising
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type0",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_get_parts_size : parts_size_advertising,
	on_show : show_advertising,
	on_sized : size_advertising
}, {
	plugin_type : Constant.PLUGIN_TYPE_IMAGE,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u56fe\u7247\u5c55\u793a" src="'
			+ plugin_icon_image + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_image
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type1",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_get_parts_size : parts_size_image,
	on_show : show_image,
	on_sized : size_image
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE1,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u5355\u6807\u7b7e\u6a71\u7a97" src="'
			+ plugin_icon_showcase1 + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_showcase1
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type2",
	grid_cx_init : 1,
	grid_cy_init : 6,
	on_get_right_size : right_size_showcase_type0,
	on_show : show_showcase_type0,
	on_sized : size_showcase_type0
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE2,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u591a\u6807\u7b7e\u6a71\u7a97" src="'
			+ plugin_icon_showcase2 + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_showcase2
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type3",
	grid_cx_init : 1,
	grid_cy_init : 6,
	on_get_right_size : right_size_showcase_type1,
	on_show : show_showcase_type1,
	on_sized : size_showcase_type1
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE3,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u4fa7\u680f\u6a71\u7a97" src="'
			+ plugin_icon_showcase3 + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_showcase3
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type4",
	grid_cx_init : 1,
	grid_cy_init : 3,
	on_get_right_size : right_size_showcase_type2,
	on_show : show_showcase_type2,
	on_sized : size_showcase_type2
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_ALL,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u5168\u5206\u7c7b\u5bfc\u822a" src="'
			+ plugin_icon_nav_all + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_nav_all
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type5",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : show_nav_all,
	on_sized : size_nav_all
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_V,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u7eb5\u5411\u5206\u7c7b\u5bfc\u822a" src="'
			+ plugin_icon_nav_v + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_nav_v
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type6",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_show : show_nav_v,
	on_sized : size_nav_v
}, {
	plugin_type : Constant.PLUGIN_TYPE_NEWS_TEXT,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u6587\u5b57\u65b0\u95fb" src="'
			+ plugin_icon_news_text + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_news_text
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type8",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_show : show_text_news,
	on_sized : size_text_news
}, {
	plugin_type : Constant.PLUGIN_TYPE_NEWS_GRAPHIC,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u56fe\u6587\u65b0\u95fb" src="'
			+ plugin_icon_news_graphic + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_news_graphic
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type9",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_show : show_graphic_news,
	on_sized : size_graphic_news
}, {
	plugin_type : Constant.PLUGIN_TYPE_FREE, //add by wui
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u81ea\u7531\u7f16\u8f91" src="'
			+ plugin_icon_free + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_free + ')"></div>', //add by wui
	tools_bar : ".toolbar-box #plugin_type10", //add by wuifree
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_show : show_free, //addby wui specpanel设置展示规格面板
	on_sized : size_free //resetsizeinfo
	
}, {
	plugin_type : Constant.PLUGIN_TYPE_MESSAGE,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u5ba2\u6237\u7559\u8a00" src="'
			+ plugin_icon_message + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_message
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type11",
	grid_cx_init : 1,
	grid_cy_init : 5,
	on_show : show_message,
	on_sized : size_message
}, {
	plugin_type : Constant.PLUGIN_TYPE_CAROUSEL,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u56fe\u7247\u6eda\u64ad" src="'
			+ plugin_icon_carousel + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_carousel
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type12",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_get_parts_size : parts_size_carousel,
	on_show : show_carousel,
	on_sized : size_carousel
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_TAG,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u6807\u7b7e\u5bfc\u822a" src="'
			+ plugin_icon_nav_tag + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_nav_tag
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type13",
	grid_cx_init : 1,
	grid_cy_init : 4,
	on_show : show_nav_tag,
	on_sized : size_nav_tag
}, {
	plugin_type : Constant.PLUGIN_TYPE_COUPON,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u4f18\u60e0\u5238\u67e5\u8be2" src="'
			+ plugin_icon_coupon + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_coupon
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type16",
	grid_cx_init : 1,
	grid_cy_init : 5,
	on_show : show_coupon,
	on_sized : size_coupon
}, {
	plugin_type : Constant.PLUGIN_TYPE_NEW,
	plugin_device : Constant.STORE_DEVICE_PC,
	content : '<div><img title="\u4f18\u60e0\u5238\u67e5\u8be2" src="'
			+ plugin_icon_new + '" /> </div>',
	icon : '<div style="background-image:url(' + plugin_icon_new
			+ ')"></div>',
	tools_bar : ".toolbar-box #plugin_type20",
	grid_cx_init : 1,
	grid_cy_init : 5,
	on_show : show_new,
	on_sized : size_new
}];
function show_title(a) {
	try {
		if (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE2)
			a.show_mode != PluginConstant.SHOW_MODE_STATIC
					&& $("#showcase_type1_border_tmpl").tmpl(a)
							.appendTo(a.body);
		else if (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE1
						&& (a.data.SearchKeyDisplay = null != a.data.SearchKey
								? a.data.SearchKey.split("\t")
								: []), $("#plugin_border_tmpl").tmpl(a)
						.appendTo(a.body)), a.show_mode == PluginConstant.SHOW_MODE_EDIT
				&& permissions[permisson_map.PageContent]
				&& null != a.change_title) {
			var b = a.body.find(".plugin_title_pic");
			b.find(".plugin_title").css("cursor", "text");
			b.find(".plugin_title").click(function() {
				var c = b.find(".plugin_title_input");
				c.val($(this).text());
				c.width($(this).width());
				c.height($(this).height() - 6);
				$(this).hide();
				c.show();
				c.focus();
				c.blur(function() {
							var e = $.trim(b.find(".plugin_title").text()), f = $
									.trim($(this).val());
							e != f && a.change_title(f);
							c.hide();
							c.val(e);
							b.find(".plugin_title").show()
						});
				c.keyup(function(a) {
					13 == a.keyCode
							? c.blur()
							: 27 == a.keyCode
									&& (c.val(b.find(".plugin_title").text()), c
											.blur())
				})
			})
		}
	} catch (c) {
	}
}
function get_plugin_inner_size(a) {
	return csharp_get_plugin_size(a.frame_config, a.body.width(), a.body
					.height(), a.plugin_type, a.data.ShowTitle)
}
function set_plugin_boder_size(a) {
	var b = get_plugin_inner_size(a);
	if (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE2)
		a.body.find(".plugin_title_border").width(b.border_width), a.body
				.find(".plugin_title_border").height(b.border_height);
	else
		switch (a.data.ShowTitle) {
			case 0 :
				a.body.find(".plugin_untitle_noborder").width(b.border_width);
				a.body.find(".plugin_untitle_noborder").height(b.border_height);
				break;
			case 1 :
				a.body.find(".plugin_untitle_border").width(b.border_width);
				a.body.find(".plugin_untitle_border").height(b.border_height);
				break;
			default :
				a.body.find(".plugin_title_border").width(b.border_width), a.body
						.find(".plugin_title_border").height(b.border_height)
		}
	a.body.find(".plugin_inner_content").width(b.width);
	a.body.find(".plugin_inner_content").height(b.height);
	return b
}
function show_free(a) {
	
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#store_free_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (b) {
	}
	size_free(a)
}
function size_free(a) {
	set_plugin_boder_size(a);
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_EDIT :
			var b = a.body.find(".plugin_inner_content").width(), c = a.body
					.find(".plugin_inner_content").height();
			a = a.body.find(".plugin_free_mask");
			a.width(b);
			a.height(c);
			a.css("top", "0px");
			a.css("left", "0px");
			a.show()
	}
}
function show_nav_all(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), show_title(a), a.data.Style) {
				case 0 :
					$("#store_nav_all_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#store_nav_all_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 2 :
					$("#store_nav_all_style2_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 3 :
					$("#store_nav_all_style3_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 4 :
					$("#store_nav_all_style4_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
		switch (a.data.Style) {
			case 1 :
			case 3 :
			case 4 :
				a.body.find(".plugin_title_border")
						.hasClass("Nav_TitleStyleBox")
						|| a.body.find(".plugin_title_border")
								.addClass("Nav_TitleStyleBox")
		}
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_STATIC :
			case PluginConstant.SHOW_MODE_DISPLAY :
				switch (a.data.Style) {
					case 1 :
						var b = 60;
						a.body.find(".nav_style1_content").css("cursor",
								"default");
						a.body.find(".nav_style1_content_li").hover(function() {
							a.body.find(".nav_style1_content_li")
									.removeClass("nav_style1_content_hover");
							$(this).addClass("nav_style1_content_hover");
							var c = a.body.find(".nav_style1_content_li")
									.index(this);
							a.body.find(".nav_style1_sub").hide();
							a.body.find(".nav_style1_sub").eq(c).show();
							a.body.find(".nav_style1_sub").eq(c).height() < b
									&& a.body.find(".nav_style1_sub").eq(c)
											.height(b);
							var e = $(this).offset().top
									- a.body.find(".nav_style1_main_content")
											.offset().top, e = e
									+ ($(this).height() + 10);
							a.body.find(".nav_style1_sub").eq(c).height() < e
									&& a.body
											.find(".nav_style1_sub")
											.eq(c)
											.css(
													"top",
													Math
															.round(e
																	- a.body
																			.find(".nav_style1_sub")
																			.eq(c)
																			.height())
															+ "px")
						}, function() {
						});
						a.body.find(".nav_style1_main_content").hover(
								function() {
								}, function() {
									a.body
											.find(".nav_style1_content_li")
											.removeClass("nav_style1_content_hover");
									a.body.find(".nav_style1_sub").hide()
								});
						break;
					case 3 :
						a.body.find(".nav_style3_SubClass2_select").hover(
								function() {
									var a = $(this).parents(".nav_style1_sub"), b = a
											.find(".nav_style3_SubClass2_select")
											.index(this);
									a.find(".icon_arrow_NavClass2").hide();
									a.find(".nav_style3_SubClass2_select")
											.removeClass("checked");
									a.find(".nav_style1_sub_class2").hide();
									$(this).addClass("checked");
									$(this).find(".icon_arrow_NavClass2")
											.show();
									a.find(".nav_style1_sub_class2").eq(b)
											.show()
								}, function() {
								});
						b = 60;
						a.body.find(".nav_style1_content").css("cursor",
								"default");
						a.body.find(".nav_style1_content_li").hover(function() {
							a.body.find(".nav_style1_content_li")
									.removeClass("nav_style1_content_hover1");
							$(this).addClass("nav_style1_content_hover1");
							var c = a.body.find(".nav_style1_content_li")
									.index(this);
							a.body.find(".nav_style1_sub").hide();
							a.body.find(".nav_style1_sub").eq(c).show();
							a.body.find(".nav_style1_sub").eq(c).height() < b
									&& a.body.find(".nav_style1_sub").eq(c)
											.height(b);
							var e = $(this).offset().top
									- a.body.find(".nav_style3_main_content")
											.offset().top, e = e
									+ ($(this).height() + 10);
							a.body.find(".nav_style1_sub").eq(c).height() < e
									&& a.body
											.find(".nav_style1_sub")
											.eq(c)
											.css(
													"top",
													Math
															.round(e
																	- a.body
																			.find(".nav_style1_sub")
																			.eq(c)
																			.height())
															+ "px")
						}, function() {
						});
						a.body.find(".nav_style3_main_content").hover(
								function() {
								}, function() {
									a.body
											.find(".nav_style1_content_li")
											.removeClass("nav_style1_content_hover1");
									a.body.find(".nav_style1_sub").hide()
								});
						break;
					case 4 :
						b = 60, a.body.find(".nav_style1_content").css(
								"cursor", "default"), a.body
								.find(".nav_style4_Class12").hover(function() {
									a.body
											.find(".nav_style4_Class12")
											.removeClass("nav_style1_content_hover");
									$(this)
											.addClass("nav_style1_content_hover");
									var c = a.body.find(".nav_style4_Class12")
											.index(this);
									a.body.find(".nav_style1_sub").hide();
									a.body.find(".nav_style1_sub").eq(c).show();
									a.body.find(".nav_style1_sub").eq(c)
											.height() < b
											&& a.body.find(".nav_style1_sub")
													.eq(c).height(b);
									var e = $(this).offset().top
											- a.body
													.find(".nav_style4_main_content")
													.offset().top, e = e
											+ ($(this).height() + 10);
									a.body.find(".nav_style1_sub").eq(c)
											.height() < e
											&& a.body
													.find(".nav_style1_sub")
													.eq(c)
													.css(
															"top",
															Math
																	.round(e
																			- a.body
																					.find(".nav_style1_sub")
																					.eq(c)
																					.height())
																	+ "px")
								}, function() {
								}), a.body.find(".nav_style4_main_content")
								.hover(function() {
										}, function() {
											a.body
													.find(".nav_style4_Class12")
													.removeClass("nav_style1_content_hover");
											a.body.find(".nav_style1_sub")
													.hide()
										})
				}
				a.show_mode != PluginConstant.SHOW_MODE_STATIC
						&& (a.body.find(".class1").css("cursor", "pointer"), a.body
								.find(".class1").click(function() {
									var a = $(this).attr("class1_id");
									goto_search_link(null, a, null, null, null,
											null)
								}), a.body.find(".class2").css("cursor",
								"pointer"), a.body.find(".class2").click(
								function() {
									var a = $(this).attr("class2_id");
									goto_search_link(null, null, a, null, null,
											null)
								}), a.body.find(".class3").css("cursor",
								"pointer"), a.body.find(".class3").click(
								function() {
									var a = $(this).attr("class3_id");
									goto_search_link(null, null, null, a, null,
											null)
								}))
		}
	} catch (c) {
	}
	size_nav_all(a)
}
function size_nav_all(a) {
	var b = set_plugin_boder_size(a), c = b.width, b = b.height;
	switch (a.data.Style) {
		case 0 :
			a.body.find(".nav_style0_main_content").width(c), a.body
					.find(".nav_style0_main_content").height(b), 600 >= c
					? a.body.find(".nav_style0_a").css("width", "100%")
					: a.body.find(".nav_style0_a").css("width", "49%")
	}
}
function show_nav_v(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), show_title(a), a.data.Style) {
				case 0 :
					$("#store_nav_v_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
		a.show_mode == PluginConstant.SHOW_MODE_DISPLAY
				&& (a.body.find(".nav_class2").click(function() {
							var a = $(this).attr("class2_id");
							goto_search_link(null, null, a, null, null, null)
						}), a.body.find(".nav_class3").click(function() {
							var a = $(this).attr("class3_id");
							goto_search_link(null, null, null, a, null, null)
						}))
	} catch (b) {
	}
	size_nav_v(a)
}
function size_nav_v(a) {
	set_plugin_boder_size(a)
}
function show_nav_tag(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#store_nav_tag_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content"))), 2 == a.data.Style
				? a.show_mode != PluginConstant.SHOW_MODE_DISPLAY
						&& a.show_mode != PluginConstant.SHOW_MODE_STATIC
						|| a.body.find("#nav_tag_seach").click(function() {
							var b = a.body.find("#nav_tag_select").val();
							if ("" == b)
								return alert("\u8bf7\u9009\u62e9\u6709\u6548\u7684\u67e5\u8be2\u6761\u4ef6"), !1;
							goto_search_link(null, null, null, null, null, b)
						})
				: a.show_mode == PluginConstant.SHOW_MODE_DISPLAY
						&& a.body.find(".tag_item").click(function() {
									var a = $(this).attr("item_id");
									goto_search_link(null, null, null, null,
											null, a)
								})
	} catch (b) {
	}
	size_nav_tag(a)
}
function size_nav_tag(a) {
	set_plugin_boder_size(a)
}
function show_text_news(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), show_title(a), a.data.Style) {
				case 0 :
					$("#text_news_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#text_news_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 2 :
					$("#text_news_style2_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
	} catch (b) {
	}
	news_click(a);
	size_text_news(a)
}
function size_text_news(a) {
	var b = set_plugin_boder_size(a).height;
	switch (a.data.Style) {
		case 2 :
			a.body.find(".news_title").each(function() {
				var a = $(this).parent(), b = a.width(), a = a
						.find(".text_news_style2_position").width();
				$(this).width(b - a)
			})
	}
	var c = a.body.find(".text_news_list li").height(), b = Math.floor(b / c);
	a.body.find(".plugin_news_main_content").height(c * b);
	!0 == a.data.Roll && a.body.find(".text_news_list").carouFredSel({
		items : b,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
				? "up"
				: "down"
	})
}
function show_graphic_news(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), show_title(a), a.data.Style) {
				case 0 :
					$("#graphic_news_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#graphic_news_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
	} catch (b) {
	}
	news_click(a);
	size_graphic_news(a)
}
function size_graphic_news(a) {
	var b = set_plugin_boder_size(a), c = b.width, b = b.height;
	if (0 == a.data.Style) {
		var d = a.body.find(".graphic_news_style0_img").width(), c = c - d - 5;
		a.body.find(".graphic_news_style0_news").width(c)
	} else
		d = a.body.find(".graphic_news_style1_img").width(), c = c - d - 5, a.body
				.find(".graphic_news_style1_news").width(c);
	if (!0 == a.data.Roll)
		switch (a.data.Style) {
			case 0 :
				c = a.body.find(".graphic_news_style0_list li").height();
				b = Math.round(b / c);
				a.body.find(".graphic_news_style0_list").carouFredSel({
					items : b,
					auto : Number(a.data.Interval),
					scroll : {
						items : 1,
						pauseOnHover : !0
					},
					direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
							? "up"
							: "down"
				});
				break;
			case 1 :
				c = a.body.find(".graphic_news_style1_list li").height(), b = Math
						.round(b / c), a.body.find(".graphic_news_style1_list")
						.carouFredSel({
							items : b,
							auto : Number(a.data.Interval),
							scroll : {
								items : 1,
								pauseOnHover : !0
							},
							direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
									? "up"
									: "down"
						})
		}
}
function news_click(a) {
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_DISPLAY :
			a.body.find(".news_title").click(function() {
				var b = $(this).attr("news_id"), c = $(this).attr("index_id"), b = a
						.get_news(b);
				if (null != b)
					switch (b.LinkType) {
						case Constant.LINK_TYPE_NONE :
							goto_news_link(c, plugin_save_level);
							break;
						case Constant.LINK_TYPE_URL :
							goto_url_link(b.LinkParam);
							break;
						case Constant.LINK_TYPE_SEARCH :
							goto_search_link(b.LinkParam, null, null, null,
									null, null);
							break;
						case Constant.LINK_TYPE_CLASS :
							try {
								var d = $.parseJSON(b.LinkParam);
								d.class1_id = null == d.class1_id
										|| "" == $.trim(d.class1_id)
										? null
										: d.class1_id;
								d.class2_id = null == d.class2_id
										|| "" == $.trim(d.class2_id)
										? null
										: d.class2_id;
								d.class3_id = null == d.class3_id
										|| "" == $.trim(d.class3_id)
										? null
										: d.class3_id;
								goto_search_link(null, d.class1_id,
										d.class2_id, d.class3_id, null, null)
							} catch (e) {
							}
							break;
						case Constant.LINK_TYPE_PAGE :
							goto_page_link(b.LinkParam, !0);
							break;
						case Constant.LINK_TYPE_SALES :
							goto_search_link(null, null, null, null,
									b.LinkParam, null);
							break;
						case Constant.LINK_TYPE_GOODS :
							goto_goods_link(b.LinkParam, !0);
							break;
						case Constant.LINK_TYPE_TAGITEM :
							goto_search_link(null, null, null, null, null,
									b.LinkParam)
					}
			})
	}
}
function show_advertising(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#advertising_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content"))), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				a.body.find(".adv_image").css("cursor", "pointer"), a.body
						.find(".adv_image").click(function() {
									var b = $(this).attr("index");
									image_click(a.data.Advertising[b])
								})
		}
	} catch (b) {
	}
	size_advertising(a)
}
function parts_size_advertising(a, b) {
	var c = get_plugin_inner_size(a), d = [];
	d.push({
				w : c.width,
				h : c.height
			});
	return d[b]
}
function size_advertising(a) {
	var b = set_plugin_boder_size(a), c = b.width, b = b.height;
	0 == a.data.Style ? (a.body.find(".banner_img li").width(c), a.body
			.find(".banner_img li").height(b), a.body.find(".banner_img img")
			.width(c), a.body.find(".banner_img img").height(b), a.body
			.find(".banner_img").carouFredSel({
				items : 1,
				auto : Number(a.data.Interval),
				scroll : {
					items : 1,
					pauseOnHover : !0
				},
				direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_LEFT
						? "left"
						: "right",
				pagination : {
					container : a.body.find(".banner_number"),
					anchorBuilder : function(a) {
						return '<a class="bg_j" href="javascript:void(0)">' + a
								+ "</a>"
					}
				}
			}))
			: (a.body.find(".slideshow").width(10 * c), a.body
					.find(".slideshow").height(b), a.body.find(".slideshow li")
					.width(c), a.body.find(".slideshow li").height(b), a.body
					.find(".slideshow img").width(c), a.body
					.find(".slideshow img").height(b), a.body
					.find(".next_arrow").css("top",
							Math.floor((b - 42) / 2) + "px"), a.body
					.find(".prev_arrow").css("top",
							Math.floor((b - 42) / 2) + "px"), a.body
					.find(".plugin_inner_content").mouseover(function() {
								a.body.find(".next_arrow_box").show();
								a.body.find(".prev_arrow_box").show()
							}).mouseout(function() {
								a.body.find(".next_arrow_box").hide();
								a.body.find(".prev_arrow_box").hide()
							}), a.body.find(".slides").carouFredSel({
				items : 1,
				auto : Number(a.data.Interval),
				scroll : {
					items : 1,
					pauseOnHover : !0
				},
				direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_LEFT
						? "left"
						: "right",
				prev : a.body.find(".next_arrow_box"),
				next : a.body.find(".prev_arrow_box")
			}), a.body.find(".next_arrow_box").hide(), a.body
					.find(".prev_arrow_box").hide())
}
function image_click(a) {
	if (null != a)
		switch (a.LinkType) {
			case Constant.LINK_TYPE_NEWS :
				goto_news_link(a.LinkParam, plugin_save_level);
				break;
			case Constant.LINK_TYPE_URL :
				goto_url_link(a.LinkParam);
				break;
			case Constant.LINK_TYPE_SEARCH :
				goto_search_link(a.LinkParam, null, null, null, null, null);
				break;
			case Constant.LINK_TYPE_CLASS :
				try {
					var b = $.parseJSON(a.LinkParam);
					b.class1_id = null == b.class1_id
							|| "" == $.trim(b.class1_id) ? null : b.class1_id;
					b.class2_id = null == b.class2_id
							|| "" == $.trim(b.class2_id) ? null : b.class2_id;
					b.class3_id = null == b.class3_id
							|| "" == $.trim(b.class3_id) ? null : b.class3_id;
					goto_search_link(null, b.class1_id, b.class2_id,
							b.class3_id, null, null)
				} catch (c) {
				}
				break;
			case Constant.LINK_TYPE_PAGE :
				goto_page_link(a.LinkParam, !0);
				break;
			case Constant.LINK_TYPE_SALES :
				goto_search_link(null, null, null, null, a.LinkParam, null);
				break;
			case Constant.LINK_TYPE_GOODS :
				goto_goods_link(a.LinkParam, !0);
				break;
			case Constant.LINK_TYPE_TAGITEM :
				goto_search_link(null, null, null, null, null, a.LinkParam)
		}
}
function show_image(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#image_type"
						+ a.data.Type + "_tmpl").tmpl(a).appendTo(a.body
						.find(".plugin_inner_content"))), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				for (var b = 0; b < a.data.Advertising.length; b++) {
					var c = a.body.find("#image" + b);
					c.attr("index", b);
					c.css("cursor", "pointer");
					c.click(function() {
								var b = $(this).attr("index");
								image_click(a.data.Advertising[b])
							})
				}
		}
	} catch (d) {
	}
	size_image(a)
}
function parts_size_image(a, b) {
	var c = size_image_calc(a);
	return b < c.length ? c[b] : {
		w : 0,
		h : 0
	}
}
function size_image_calc(a) {
	a = csharp_size_image_calc(a.frame_config, a.body.width(), a.body.height(),
			a.plugin_type, a.data.ShowTitle, a.data.Type, a.data.Style);
	for (var b = 0; b < a.length; b++)
		a[b].w = parseInt(a[b].w), a[b].h = parseInt(a[b].h);
	return a
}
function size_image(a) {
	set_plugin_boder_size(a);
//	if (a.show_mode != PluginConstant.SHOW_MODE_STATIC) {
		var b = size_image_calc(a);
		a.body.find(".li1").width(Math.floor(b[1].w));
		a.body.find(".li1").height(Math.floor(b[1].h));
		a.body.find(".li2").width(Math.floor(b[2].w));
		a.body.find(".li2").height(Math.floor(b[2].h));
		a.body.find(".li3").width(Math.floor(b[3].w));
		a.body.find(".li3").height(Math.floor(b[3].h));
		a.body.find(".li4").width(Math.floor(b[4].w));
		a.body.find(".li4").height(Math.floor(b[4].h));
		a.body.find(".li5").width(Math.floor(b[5].w));
		a.body.find(".li5").height(Math.floor(b[5].h));
		a.body.find(".li6").width(Math.floor(b[6].w));
		a.body.find(".li6").height(Math.floor(b[6].h));
		a.body.find(".li7").width(Math.floor(b[7].w));
		a.body.find(".li7").height(Math.floor(b[7].h));
		a.body.find(".li8").width(Math.floor(b[8].w));
		a.body.find(".li8").height(Math.floor(b[8].h));
		a.body.find(".li9").width(Math.floor(b[9].w));
		a.body.find(".li9").height(Math.floor(b[9].h))
//	}
}
function show_carousel(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#carousel_tmpl").tmpl(a)
						.appendTo(a.body.find(".plugin_inner_content")));
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				a.body.find(".adv_image").css("cursor", "pointer"), a.body
						.find(".adv_image, .adv_text").click(function() {
									var b = $(this).attr("index");
									image_click(a.data.Advertising[b])
								})
		}
		
		a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE ? a.body
				.find(".adv_text").hide() : a.body.find(".adv_text").show()
	} catch (b) {
	}
	size_carousel(a)
}
function parts_size_carousel(a, b) {
	var c = get_plugin_inner_size(a), d = [];
	d.push({
				w : c.width,
				h : c.height
			});
	for (var e = 0, f = 0, e = a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? parseInt(c.width / a.data.Setting.ShowNumber)
			: parseInt((c.width - 4 * a.data.Setting.ShowNumber)
					/ a.data.Setting.ShowNumber), f = a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE
			? c.height
			: c.height - 40, c = 0; c < a.data.Advertising.length; c++)
		d.push({
					w : e,
					h : f
				});
	return d[b]
}
function size_carousel(a) {
	var b = set_plugin_boder_size(a), c = b.height, d = 0, e = 0, d = a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? parseInt(b.width / a.data.Setting.ShowNumber)
			: parseInt((b.width - 4 * a.data.Setting.ShowNumber)
					/ a.data.Setting.ShowNumber), e = a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE
			? b.height
			: b.height - 40;
	a.body.find(".plugin_carousel_box li").width(d);
	a.body.find(".plugin_carousel_box li").height(c);
	a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? (a.body.find(".plugin_carousel_box li").css("margin-left", "0px"), a.body
					.find(".plugin_carousel_box li").css("margin-right", "0px"))
			: (a.body.find(".plugin_carousel_box li").css("margin-left", "2px"), a.body
					.find(".plugin_carousel_box li").css("margin-right", "2px"));
	a.body.find(".plugin_carousel_box li img").width(d);
	a.body.find(".plugin_carousel_box li img").height(e);
	a.body.show();
	a.body.find(".plugin_carousel_box").carouFredSel({
		items : Number(a.data.Setting.ShowNumber),
		auto : Number(a.data.Setting.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Setting.Direction == Constant.PLUGIN_CAROUSEL_DIR_LEFT
				? "left"
				: "right"
	})
}
function showcase_goods_process(a, b, c, d) {
	var e = {};
	e.Style = a.data.Style;
	e.show_mode = a.show_mode;
	e.GoodsStyle = a.data.GoodsStyle;
	null == c && a.show_mode == PluginConstant.SHOW_MODE_STATIC
			? (e.label = {}, e.label.Goods = [], b.find(".goods_list").each(
					function() {
						e.label.Goods.push({
									RuleId : $(this).attr("RuleId"),
									RuleType : $(this).attr("RuleType"),
									RuleStartTime : $(this)
											.attr("RuleStartTime").replace(
													RegExp("[\\\\]", "g"), ""),
									RuleEndTime : $(this).attr("RuleEndTime")
											.replace(RegExp("[\\\\]", "g"), ""),
									Price : $(this).attr("Price"),
									DiscountPrice : $(this)
											.attr("DiscountPrice")
								})
					}))
			: e.label = c;
	e.label.index = d;
	if (a.show_mode != PluginConstant.SHOW_MODE_STATIC
			&& (b.empty(), $("#showcase_goods_tmpl").tmpl(e).appendTo(b), a.show_mode == PluginConstant.SHOW_MODE_EDIT
					&& (null == e.label.Goods || 0 >= e.label.Goods.length)))
		switch (a.data.Style) {
			case 0 :
				b.addClass("empty_goods1");
				break;
			case 1 :
				b.addClass("empty_goods2");
				break;
			case 2 :
				b.addClass("empty_goods3")
		}
	b.find(".goods_list").each(function(a) {
		a = get_goods_sales(e.label.Goods[a]);
		null != a.rule_icon
				&& a.rule_icon.appendTo($(this).find("#sales_icon"));
		null != a.rule_price
				&& $(this).find("#sales_price").text((a.rule_price / 100)
						.toFixed(2))
	});
	switch (a.data.Style) {
		case 0 :
			showcase_fix_image(b.find(".showcase_goods_style0_img").width(), b
							.find(".showcase_goods_style0_img").height(), b
							.find(".showcase_goods_style0_img img"));
			break;
		case 1 :
			showcase_fix_image(b.find(".showcase_goods_style1").width(), b
							.find(".showcase_goods_style1").height(), b
							.find(".showcase_goods_style1 img"))
	}
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_DISPLAY :
			b.find(".goods_list").css("cursor", "pointer"), b
					.find(".goods_list").click(function() {
								var a = $(this).attr("goods_id");
								goto_goods_link(a, !0)
							});
		case PluginConstant.SHOW_MODE_PREVIEW :
		case PluginConstant.SHOW_MODE_STATIC :
			switch (a.data.Style) {
				case 1 :
					b.find(".showcase_goods_style1").hover(function() {
								$(this).find(".popup_product_name").fadeIn(200)
							}, function() {
								$(this).find(".popup_product_name")
										.fadeOut(200)
							})
			}
			break;
		case PluginConstant.SHOW_MODE_EDIT :
			permissions[permisson_map.PageContent]
					&& (b.find(".showcase_goods_handle").each(function() {
						var a = $(this).parent(), b = a.width(), a = a.height();
						$(this).width(Math.round(b / 2));
						$(this).height(Math.round(a / 2));
						$(this).css("top", Math.round(a / 4) + "px");
						$(this).css("left", Math.round(b / 4) + "px")
					}), b.sortable({
								cancel : ".sortable_cancel",
								handle : ".showcase_goods_handle",
								stop : function(c, d) {
									var e = b.find(".goods_list").index(d.item)
											+ 1;
									a.move_showcase_goods(d.item
													.attr("label_id"), d.item
													.attr("goods_id"), e)
								}
							}))
	}
}
function showcase_fix_image(a, b, c) {
	var d, e, f, h;
	b > a
			? (e = 0, h = b, d = Math.round((b - a) / 2), f = b)
			: (d = 0, f = a, e = Math.round((a - b) / 2), h = a);
	c.css({
				width : f + "px",
				height : h + "px",
				marginLeft : "-" + d + "px",
				marginTop : "-" + e + "px"
			})
}
function showcase_fix_goods_list(a, b, c) {
	var d, e;
	switch (a.data.ShowTitle) {
		case 0 :
			c = 6;
			break;
		case 1 :
			c = 0;
			break;
		default :
			c = 12
	}
	d = Math.floor(b / 168);
	1 > d && (d = 1);
	b = Math.floor((b - 166 * d) / (2 * d));
	0 > b && (b = 0);
	d = b;
	e = 20 - c;
	0 > e && (e = 0);
	a.body.find(".goods_list").css("padding-left", b + "px");
	a.body.find(".goods_list").css("padding-right", d + "px");
	a.body.find(".goods_list").css("padding-top", c + "px");
	a.body.find(".goods_list").css("padding-bottom", e + "px")
}
function show_showcase_type0(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				? (a.body.empty(), show_title(a), $("#showcase_type0_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")), showcase_goods_process(
						a, a.body.find(".showcase_type0_goods"),
						a.data.Labels[0], 0))
				: showcase_goods_process(a, a.body
								.find(".showcase_type0_goods"), null, 0), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
			case PluginConstant.SHOW_MODE_PREVIEW :
				a.body.find(".search_key").click(function() {
							var a = $(this).find("a").text();
							goto_search_link(a, null, null, null, null, null)
						});
				break;
			case PluginConstant.SHOW_MODE_EDIT :
				permissions[permisson_map.PageContent]
						&& (a.body.find(".plugin_title_searchkey li").css(
								"cursor", "text"), a.body
								.find(".plugin_title_searchkey a").css(
										"cursor", "text"), a.body
								.find(".search_key").find("a").click(
										function() {
											var b = $(this).parents("li"), d = b
													.find("input");
											d.val($(this).text());
											d.width(b.width());
											d.height(b.height() - 4);
											$(this).hide();
											d.show();
											d.focus();
											d.blur(function() {
												var e = $.trim(b.find("a")
														.text()), f = $.trim(d
														.val()), h = b
														.attr("index");
												"" == f
														? a.del_search_key(h)
														: e != f
																&& a
																		.edit_search_key(
																				h,
																				f);
												d.hide();
												d.val(e);
												b.find("a").show()
											});
											d.keyup(function(a) {
												13 == a.keyCode
														? d.blur()
														: 27 == a.keyCode
																&& (d
																		.val(b
																				.find("a")
																				.text()), d
																		.blur())
											})
										}), a.body.find(".add_key").click(
								function() {
									var b = $(this).find("input");
									b.show();
									b.focus();
									b.blur(function() {
												var d = $.trim($(this).val());
												"" != d && a.add_search_key(d);
												b.val("");
												b.hide()
											});
									b.keyup(function(a) {
										13 == a.keyCode
												? b.blur()
												: 27 == a.keyCode
														&& (b.val(""), b.blur())
									})
								}), a.body.find(".plugin_title_searchkey")
								.sortable({
									cancel : ".ui-state-disabled",
									stop : function(b, d) {
										var e = d.item.attr("index"), f = a.body
												.find(".plugin_title_searchkey")
												.find(".search_key")
												.index(d.item);
										a.move_search_key(e, f)
									}
								}))
		}
	} catch (b) {
	}
	size_showcase_type0(a)
}
function size_showcase_type0(a) {
	var b = set_plugin_boder_size(a), c = b.width;
	showcase_fix_goods_list(a, c, b.height);
	b = a.body.find(".showcase_type0_goods li").width();
	c = Math.floor(c / b);
	!0 == a.data.Roll && a.body.find(".showcase_type0_goods").carouFredSel({
		items : c,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_RIGHT
				? "right"
				: "left"
	})
}
function right_size_showcase_type0(a, b, c, d, e) {
	b = 5;
	c = 1;
	switch (a.data.ShowTitle) {
		case 0 :
			c = 0;
			break;
		case 1 :
			c = 0;
			break;
		default :
			c = 1
	}
	switch (a.data.Style) {
		case 0 :
			b = 5;
			break;
		case 1 :
			b = 5;
			break;
		default :
			b = 2
	}
	a = {
		cx : d,
		cy : e
	};
	a.cy = e < b + c ? b + c : b + c + Math.floor((e - (b + c) + (b - 1)) / b)
			* b;
	return a
}
function show_showcase_type1(a) {
	function b(b) {
		var c = a.body.find(".showcase_type1_title").find(".label_list"), d = a.body
				.find(".showcase_type1_goods"), g = d.eq(b);
		if (a.show_mode == PluginConstant.SHOW_MODE_STATIC) {
			var k = c.eq(b).attr("processed");
			if (null == k || "true" != k)
				showcase_goods_process(a, g, null, b), c.eq(b).attr(
						"processed", "true")
		}
		c.index(this);
		c.removeClass("checked");
		c.eq(b).addClass("checked");
		d.hide();
		g.show()
	}
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC) {
			a.body.empty();
			show_title(a);
			$("#showcase_type1_tmpl").tmpl(a).appendTo(a.body
					.find(".plugin_inner_content"));
			for (var c = 0; c < a.data.Labels.length; c++)
				showcase_goods_process(a, a.body.find(".showcase_type1_goods")
								.eq(c), a.data.Labels[c], c);
			null != a.data.Labels
					&& 0 < a.data.Labels.length
					&& (a.curr_label < a.data.Labels.length
							? b(a.curr_label)
							: (a.curr_label = 0, b(0)))
		} else
			a.curr_label = 0, b(0);
		a.body.find(".showcase_type1_title").find(".label_list").hover(
				function() {
					var c = a.body.find(".showcase_type1_title")
							.find(".label_list").index(this);
					b(c);
					a.curr_label = c
				}, function() {
				});
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_EDIT :
				permissions[permisson_map.PageContent]
						&& (a.body.find(".label_list a").css("cursor", "text"), a.body
								.find(".label_list").find("a").click(
										function() {
											var b = $(this).parents("li"), c = b
													.find("input");
											c.val($(this).text());
											c.width(b.width());
											c.height(b.height() - 4);
											$(this).hide();
											c.show();
											c.focus();
											c.blur(function() {
												var d = $.trim(b.find("a")
														.text()), g = $.trim(c
														.val()), k = b
														.attr("label_id");
												"" == g
														? a.delete_label(k)
														: d != g
																&& a
																		.change_label_name(
																				k,
																				g);
												c.hide();
												c.val(d);
												b.find("a").show()
											});
											c.keyup(function(a) {
												13 == a.keyCode
														? c.blur()
														: 27 == a.keyCode
																&& (c
																		.val(b
																				.find("a")
																				.text()), c
																		.blur())
											})
										}), a.body.find(".add_label").click(
								function() {
									var b = $(this).find("input");
									b.show();
									b.focus();
									b.blur(function() {
												var c = $.trim($(this).val());
												"" != c && a.add_label(c);
												b.val("");
												b.hide()
											});
									b.keyup(function(a) {
										13 == a.keyCode
												? b.blur()
												: 27 == a.keyCode
														&& (b.val(""), b.blur())
									})
								}), a.body.find(".showcase_type1_title")
								.sortable({
									cancel : ".sortable_cancel",
									stop : function(b, c) {
										var d = a.body
												.find(".showcase_type1_title")
												.find("li").index(c.item)
												+ 1;
										a
												.move_label(
														c.item.attr("label_id"),
														d)
									}
								}))
		}
	} catch (d) {
	}
	size_showcase_type1(a)
}
function size_showcase_type1(a) {
	var b = set_plugin_boder_size(a);
	showcase_fix_goods_list(a, b.width, b.height)
}
function right_size_showcase_type1(a, b, c, d, e) {
	b = 5;
	switch (a.data.Style) {
		case 0 :
			b = 5;
			break;
		case 1 :
			b = 5;
			break;
		default :
			b = 2
	}
	a = {
		cx : d,
		cy : e
	};
	a.cy = e < b + 1 ? b + 1 : b + 1 + Math.floor((e - (b + 1) + (b - 1)) / b)
			* b;
	return a
}
function show_showcase_type2(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				? (a.body.empty(), show_title(a), $("#showcase_type2_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")), showcase_goods_process(
						a, a.body.find(".showcase_type2_goods"),
						a.data.Labels[0], 0))
				: showcase_goods_process(a, a.body
								.find(".showcase_type2_goods"), null, 0)
	} catch (b) {
	}
	size_showcase_type2(a)
}
function size_showcase_type2(a) {
	var b = set_plugin_boder_size(a), c = b.width, b = b.height;
	a.body.find(".showcase_type2_goods li").width(c);
	a.body.find(".showcase_type2_goods .a_text").width(c - 5 - 90);
	c = a.body.find(".showcase_type2_goods li").height();
	c = Math.floor(b / c);
	!0 == a.data.Roll && a.body.find(".showcase_type2_goods").carouFredSel({
		items : c,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
				? "up"
				: "down"
	})
}
function right_size_showcase_type2(a, b, c, d, e) {
	return right_size_showcase_type0(a, b, c, d, e)
}
function show_message(a) {
	function b(a, b, c) {
		if (!CheckInput.IsEmpty(a.Contacts)
				&& a.Contacts.length > Constant.INPUT_REALNAME_MAX)
			return alert("\u59d3\u540d\u4e0d\u80fd\u5927\u4e8e"
					+ Constant.INPUT_REALNAME_MAX + "\u4e2a\u5b57"), !1;
		if ("" == a.Phone && "" == a.Qq)
			return alert("\u8bf7\u81f3\u5c11\u7559\u4e0b\u4e00\u79cd\u8054\u7cfb\u65b9\u5f0f(\u624b\u673a\u53f7\u7801\u6216QQ\u53f7\u7801)"), !1;
		if ("" != a.Phone && !CheckInput.IsMobilePhone(a.Phone))
			return alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e"), !1;
		if ("" != a.Qq && !CheckInput.IsQQ(a.Qq))
			return alert("QQ\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e"), !1;
		if (!CheckInput.IsEmpty(a.Constant)
				&& a.Content.length > Constant.INPUT_SYS_MESAGE_CONTENT_MAX)
			return alert("\u7559\u8a00\u5185\u5bb9\u4e0d\u80fd\u5927\u4e8e"
					+ Constant.INPUT_SYS_MESAGE_CONTENT_MAX + "\u4e2a\u5b57"), !1;
		b && OpenLoadingDialog();
		$.ajax({
					url : getActionPath("MessageCreate", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								message : a
							}),
					success : function(a) {
						b && CloseLoadingDialog();
						!0 == a.success ? null != c && c() : ShowActionError(
								a.error, "buyer")
					},
					error : function(a, b, c) {
						ShowAjaxError(a, b, c)
					}
				})
	}
	try {
		a.show_mode == PluginConstant.SHOW_MODE_STATIC ? a.body
				.find("#message_add").click(function() {
					var c = {};
					c.Contacts = $.trim(a.body.find("#contacts").val());
					c.Phone = $.trim(a.body.find("#phone").val());
					c.Qq = $.trim(a.body.find("#qq").val());
					c.Content = $.trim(a.body.find("#content").val());
					b(c, !0, function() {
						alert("\u60a8\u5df2\u7ecf\u7559\u8a00\u6210\u529f,\u611f\u8c22\u60a8\u7684\u652f\u6301!");
						a.body.find("#contacts").val("");
						a.body.find("#phone").val("");
						a.body.find("#qq").val("");
						a.body.find("#content").val("")
					})
				})
				: (a.body.empty(), show_title(a), $("#plugin_message_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")));
	} catch (c) {
	}
	size_message(a)
}
function size_message(a) {
	var b = set_plugin_boder_size(a).width;
	a.body.find(".plugin_message_Input").width(b - 67)
}
function show_coupon(a) {
	function b(b, c, f, h) {
		if (CheckInput.IsEmpty(c))
			return alert("\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"), !1;
		if (CheckInput.IsEmpty(b))
			return alert("\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u8f93\u5165\u4f18\u60e0\u5238\u53f7\u7801"), !1;
		if (b.length > Constant.INPUT_ZCLOUD_COUPON_MAX)
			return alert("\u4f18\u60e0\u5238\u53f7\u7801\u4e0d\u80fd\u5927\u4e8e"
					+ Constant.INPUT_ZCLOUD_COUPON_MAX
					+ "\u4e2a\u5b57\u7b26\uff01"), !1;
		f && OpenLoadingDialog();
		$.ajax({
					url : getActionPath("iKuCouponSearch", "AccountOperation"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								password : b,
								checkcode : c
							}),
					success : function(b) {
						f && CloseLoadingDialog();
						!0 == b.success ? null != h && h(b) : ShowActionError(
								b.error, "buyer");
						a.body.find("#coupon_number").val("");
						a.body.find("#coupon_CheckCode").val("");
						change_checkcode(a.body.find("#CodeImg"))
					},
					error : function(a, b, c) {
						ShowAjaxError(a, b, c)
					}
				})
	}
	try {
		a.show_mode == PluginConstant.SHOW_MODE_STATIC ? (a.body
				.find("#coupon_search").click(function() {
					var c = $.trim(a.body.find("#coupon_number").val()), e = $
							.trim(a.body.find("#coupon_CheckCode").val());
					b(c, e, !0, function(a) {
						"PrepaidCard" == a.type
								&& alert("\u60a8\u7684\u8d2d\u7269\u5361\u53ef\u7528\u4f59\u989d\u4e3a : [ "
										+ (a.iKuCoupon / 100).toFixed(2)
										+ " ] \u5143");
						"DiscountCard" == a.type
								&& alert("\u60a8\u7684\u6298\u6263\u5361\u53ef\u4eab\u53d7\u6298\u6263\u4e3a : [ "
										+ (a.iKuCoupon / 1E3).toFixed(3)
										+ " ] \u6298")
					})
				}), a.body.find("#CodeImg").click(function() {
					change_checkcode($(this))
				}))
				: (a.body.empty(), show_title(a), $("#plugin_coupon_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (c) {
	}
	size_coupon(a)
}
function size_coupon(a) {
	var b = set_plugin_boder_size(a).width;
	250 <= b
			? (a.body.find(".small_show").hide(), a.body.find(".big_show")
					.show(), a.body.find(".plugin_coupon_Input").width(b - 87), a.body
					.find("#coupon_CheckCode").width(b - 180))
			: (a.body.find(".big_show").hide(), a.body.find(".small_show")
					.show(), a.body.find(".plugin_coupon_Input").width(b - 2), a.body
					.find("#coupon_CheckCode").width(b - 95))
};

function show_new(a) {
	
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), show_title(a), $("#store_free_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (b) {
	}
	size_new(a)
}
function size_new(a) {
	set_plugin_boder_size(a);
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_EDIT :
			var b = a.body.find(".plugin_inner_content").width(), c = a.body
					.find(".plugin_inner_content").height();
			a = a.body.find(".plugin_free_mask");
			a.width(b);
			a.height(c);
			a.css("top", "0px");
			a.css("left", "0px");
			a.show()
	}
}

var mobile_plugin_icon_advertising = getContentPath("Content/Admin/images/icon_01.png"), mobile_plugin_icon_image = getContentPath("Content/Admin/images/icon_02.png"), mobile_plugin_icon_showcase1 = getContentPath("Content/Admin/images/icon_05.png"), mobile_plugin_icon_showcase2 = getContentPath("Content/Admin/images/icon_06.png"), mobile_plugin_icon_showcase3 = getContentPath("Content/Admin/images/icon_07.png"), mobile_plugin_icon_nav_all = getContentPath("Content/Admin/images/icon_08.png"), mobile_plugin_icon_nav_v = getContentPath("Content/Admin/images/icon_09.png"), mobile_plugin_icon_nav_h = getContentPath("Content/Admin/images/icon_09.png"), mobile_plugin_icon_news_text = getContentPath("Content/Admin/images/icon_03.png"), mobile_plugin_icon_news_graphic = getContentPath("Content/Admin/images/icon_04.png"), mobile_plugin_icon_free = getContentPath("Content/Admin/images/icon_10.png"), mobile_plugin_icon_message = getContentPath("Content/Admin/images/icon_11.png"), mobile_plugin_icon_carousel = getContentPath("Content/Admin/images/icon_12.png"), mobile_plugin_icon_nav_tag = getContentPath("Content/Admin/images/icon_13.png"), mobile_plugin_icon_header = getContentPath("Content/Admin/images/icon_14.png"), mobile_plugin_icon_button = getContentPath("Content/Admin/images/icon_15.png"), istore_mobile_option = {
	selector : "#mobile_store_containers",
	zoom : 0.75,
	auto_scroll : !0,
	scroll_container : $(".ShowBox_Content"),
	page_id : 0,
	move_margin : 0,
	size_margin : -10,
	frame_config : Constant.ISTORE_FRAME_CONFIG_MOBILE_STYLE0,
	on_sized : function(a, b) {
		$(".contentmainbox").height(b)
	}
}, mobile_plugin_option = [{
	plugin_type : Constant.PLUGIN_TYPE_ADVERTISING,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u5e7f\u544a\u8f6e\u64ad" src="'
			+ mobile_plugin_icon_advertising + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_advertising
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type0",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_get_parts_size : mobile_parts_mobile_size_advertising,
	on_show : mobile_show_advertising,
	on_sized : mobile_size_advertising
}, {
	plugin_type : Constant.PLUGIN_TYPE_IMAGE,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u56fe\u7247\u5c55\u793a" src="'
			+ mobile_plugin_icon_image + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_image
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type1",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_get_parts_size : mobile_parts_mobile_size_image,
	on_show : mobile_show_image,
	on_sized : mobile_size_image
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE1,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u5355\u6807\u7b7e\u6a71\u7a97" src="'
			+ mobile_plugin_icon_showcase1 + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_showcase1
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type2",
	grid_cx_init : 1,
	grid_cy_init : 12,
	on_get_right_size : right_mobile_size_showcase_type0,
	on_show : mobile_show_showcase_type0,
	on_sized : mobile_size_showcase_type0
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE2,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u591a\u6807\u7b7e\u6a71\u7a97" src="'
			+ mobile_plugin_icon_showcase2 + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_showcase2
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type3",
	grid_cx_init : 1,
	grid_cy_init : 12,
	on_get_right_size : right_mobile_size_showcase_type1,
	on_show : mobile_show_showcase_type1,
	on_sized : mobile_size_showcase_type1
}, {
	plugin_type : Constant.PLUGIN_TYPE_SHOWCASE3,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u4fa7\u680f\u6a71\u7a97" src="'
			+ mobile_plugin_icon_showcase3 + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_showcase3
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type4",
	grid_cx_init : 1,
	grid_cy_init : 6,
	on_get_right_size : right_mobile_size_showcase_type2,
	on_show : mobile_show_showcase_type2,
	on_sized : mobile_size_showcase_type2
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_ALL,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u5168\u5206\u7c7b\u5bfc\u822a" src="'
			+ mobile_plugin_icon_nav_all + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_nav_all
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type5",
	grid_cx_init : 1,
	grid_cy_init : 16,
	on_show : mobile_show_nav_all,
	on_sized : mobile_size_nav_all
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_V,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u7eb5\u5411\u5206\u7c7b\u5bfc\u822a" src="'
			+ mobile_plugin_icon_nav_v + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_nav_v
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type6",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : mobile_show_nav_v,
	on_sized : mobile_size_nav_v
}, {
	plugin_type : Constant.PLUGIN_TYPE_NEWS_TEXT,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u6587\u5b57\u65b0\u95fb" src="'
			+ mobile_plugin_icon_news_text + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_news_text
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type8",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : mobile_show_text_news,
	on_sized : mobile_size_text_news
}, {
	plugin_type : Constant.PLUGIN_TYPE_NEWS_GRAPHIC,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u56fe\u6587\u65b0\u95fb" src="'
			+ mobile_plugin_icon_news_graphic + '" /> </div>',
	icon : '<div style="background-image:url('
			+ mobile_plugin_icon_news_graphic + ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type9",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : mobile_show_graphic_news,
	on_sized : mobile_size_graphic_news
}, {
	plugin_type : Constant.PLUGIN_TYPE_FREE,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u81ea\u7531\u7f16\u8f91" src="'
			+ mobile_plugin_icon_free + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_free
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type10",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : mobile_show_free,
	on_sized : mobile_size_free
}, {
	plugin_type : Constant.PLUGIN_TYPE_MESSAGE,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u5ba2\u6237\u7559\u8a00" src="'
			+ mobile_plugin_icon_message + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_message
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type11",
	grid_cx_init : 1,
	grid_cy_init : 11,
	on_show : mobile_show_message,
	on_sized : mobile_size_message
}, {
	plugin_type : Constant.PLUGIN_TYPE_CAROUSEL,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u56fe\u7247\u6eda\u64ad" src="'
			+ mobile_plugin_icon_carousel + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_carousel
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type12",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_get_parts_size : parts_mobile_size_carousel,
	on_show : mobile_show_carousel,
	on_sized : mobile_size_carousel
}, {
	plugin_type : Constant.PLUGIN_TYPE_NAV_TAG,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u6807\u7b7e\u5bfc\u822a" src="'
			+ mobile_plugin_icon_nav_tag + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_nav_tag
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type13",
	grid_cx_init : 1,
	grid_cy_init : 8,
	on_show : mobile_show_nav_tag,
	on_sized : mobile_size_nav_tag
}, {
	plugin_type : Constant.PLUGIN_TYPE_HEADER,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u5546\u57ce\u5934\u90e8" src="'
			+ mobile_plugin_icon_header + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_header
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type14",
	grid_cx_init : 1,
	grid_cy_init : 2,
	grid_cx_max : 1,
	grid_cy_max : 2,
	on_get_parts_size : parts_mobile_size_header,
	on_show : mobile_show_header,
	on_sized : mobile_size_header
}, {
	plugin_type : Constant.PLUGIN_TYPE_BUTTON,
	plugin_device : Constant.STORE_DEVICE_MOBILE,
	content : '<div><img title="\u6309\u94ae\u5bfc\u822a" src="'
			+ mobile_plugin_icon_button + '" /> </div>',
	icon : '<div style="background-image:url(' + mobile_plugin_icon_button
			+ ')"></div>',
	tools_bar : ".Tools_EditBox #plugin_type15",
	grid_cx_init : 1,
	grid_cy_init : 6,
	on_show : mobile_show_button,
	on_sized : mobile_size_button
}];
function mobile_show_title(a) {
	try {
		if (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE2)
			a.show_mode != PluginConstant.SHOW_MODE_STATIC
					&& $("#showcase_type1_border_tmpl").tmpl(a)
							.appendTo(a.body);
		else if (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE1
						&& (a.data.SearchKeyDisplay = null != a.data.SearchKey
								? a.data.SearchKey.split("\t")
								: []), $("#plugin_border_tmpl").tmpl(a)
						.appendTo(a.body)), a.show_mode == PluginConstant.SHOW_MODE_EDIT
				&& permissions[permisson_map.PageContent]
				&& null != a.change_title) {
			var b = a.body.find(".plugin_title_pic");
			b.find(".plugin_title").css("cursor", "text");
			b.find(".plugin_title").click(function() {
				var c = b.find(".plugin_title_input");
				c.val($(this).text());
				c.width($(this).width());
				c.height($(this).height() - 6);
				$(this).hide();
				c.show();
				c.focus();
				c.blur(function() {
							var e = $.trim(b.find(".plugin_title").text()), f = $
									.trim($(this).val());
							e != f && a.change_title(f);
							c.hide();
							c.val(e);
							b.find(".plugin_title").show()
						});
				c.keyup(function(a) {
					13 == a.keyCode
							? c.blur()
							: 27 == a.keyCode
									&& (c.val(b.find(".plugin_title").text()), c
											.blur())
				})
			})
		}
	} catch (c) {
	}
}
function mobile_get_plugin_inner_size(a) {
	return csharp_get_plugin_size(a.frame_config, a.body.width(), a.body
					.height(), a.plugin_type, a.data.ShowTitle)
}
function mobile_set_plugin_boder_size(a) {
	var b = mobile_get_plugin_inner_size(a);
	if (a.plugin_type == Constant.PLUGIN_TYPE_SHOWCASE2)
		a.body.find(".plugin_title_border").width(b.border_width), a.body
				.find(".plugin_title_border").height(b.border_height);
	else
		switch (a.data.ShowTitle) {
			case 0 :
				a.body.find(".plugin_untitle_noborder").width(b.border_width);
				a.body.find(".plugin_untitle_noborder").height(b.border_height);
				break;
			case 1 :
				a.body.find(".plugin_untitle_border").width(b.border_width);
				a.body.find(".plugin_untitle_border").height(b.border_height);
				break;
			default :
				a.body.find(".plugin_title_border").width(b.border_width), a.body
						.find(".plugin_title_border").height(b.border_height)
		}
	a.body.find(".plugin_inner_content").width(b.width);
	a.body.find(".plugin_inner_content").height(b.height);
	return b
}
function mobile_show_free(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#store_free_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (b) {
	}
	mobile_size_free(a)
}
function mobile_size_free(a) {
	mobile_set_plugin_boder_size(a);
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_EDIT :
			var b = a.body.find(".plugin_inner_content").width(), c = a.body
					.find(".plugin_inner_content").height();
			a = a.body.find(".plugin_free_mask");
			a.width(b);
			a.height(c);
			a.css("top", "0px");
			a.css("left", "0px");
			a.show()
	}
}
function mobile_show_nav_all(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), mobile_show_title(a), a.data.Style) {
				case 0 :
					$("#store_nav_all_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#store_nav_all_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 2 :
					$("#store_nav_all_style2_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 3 :
					$("#store_nav_all_style3_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 4 :
					$("#store_nav_all_style4_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
		switch (a.data.Style) {
			case 1 :
			case 3 :
			case 4 :
				a.body.find(".plugin_title_border")
						.hasClass("Nav_TitleStyleBox")
						|| a.body.find(".plugin_title_border")
								.addClass("Nav_TitleStyleBox")
		}
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_STATIC :
			case PluginConstant.SHOW_MODE_DISPLAY :
				switch (a.data.Style) {
					case 1 :
						var b = 60;
						a.body.find(".nav_style1_content").css("cursor",
								"default");
						a.body.find(".nav_style1_content_li").hover(function() {
							a.body.find(".nav_style1_content_li")
									.removeClass("nav_style1_content_hover");
							$(this).addClass("nav_style1_content_hover");
							var c = a.body.find(".nav_style1_content_li")
									.index(this);
							a.body.find(".nav_style1_sub").hide();
							a.body.find(".nav_style1_sub").eq(c).show();
							a.body.find(".nav_style1_sub").eq(c).height() < b
									&& a.body.find(".nav_style1_sub").eq(c)
											.height(b);
							var e = $(this).offset().top
									- a.body.find(".nav_style1_main_content")
											.offset().top, e = e
									+ ($(this).height() + 10);
							a.body.find(".nav_style1_sub").eq(c).height() < e
									&& a.body
											.find(".nav_style1_sub")
											.eq(c)
											.css(
													"top",
													Math
															.round(e
																	- a.body
																			.find(".nav_style1_sub")
																			.eq(c)
																			.height())
															+ "px")
						}, function() {
						});
						a.body.find(".nav_style1_main_content").hover(
								function() {
								}, function() {
									a.body
											.find(".nav_style1_content_li")
											.removeClass("nav_style1_content_hover");
									a.body.find(".nav_style1_sub").hide()
								});
						break;
					case 3 :
						a.body.find(".nav_style3_SubClass2_select").hover(
								function() {
									var a = $(this).parents(".nav_style1_sub"), b = a
											.find(".nav_style3_SubClass2_select")
											.index(this);
									a.find(".icon_arrow_NavClass2").hide();
									a.find(".nav_style3_SubClass2_select")
											.removeClass("checked");
									a.find(".nav_style1_sub_class2").hide();
									$(this).addClass("checked");
									$(this).find(".icon_arrow_NavClass2")
											.show();
									a.find(".nav_style1_sub_class2").eq(b)
											.show()
								}, function() {
								});
						b = 60;
						a.body.find(".nav_style1_content").css("cursor",
								"default");
						a.body.find(".nav_style1_content_li").hover(function() {
							a.body.find(".nav_style1_content_li")
									.removeClass("nav_style1_content_hover1");
							$(this).addClass("nav_style1_content_hover1");
							var c = a.body.find(".nav_style1_content_li")
									.index(this);
							a.body.find(".nav_style1_sub").hide();
							a.body.find(".nav_style1_sub").eq(c).show();
							a.body.find(".nav_style1_sub").eq(c).height() < b
									&& a.body.find(".nav_style1_sub").eq(c)
											.height(b);
							var e = $(this).offset().top
									- a.body.find(".nav_style3_main_content")
											.offset().top, e = e
									+ ($(this).height() + 10);
							a.body.find(".nav_style1_sub").eq(c).height() < e
									&& a.body
											.find(".nav_style1_sub")
											.eq(c)
											.css(
													"top",
													Math
															.round(e
																	- a.body
																			.find(".nav_style1_sub")
																			.eq(c)
																			.height())
															+ "px")
						}, function() {
						});
						a.body.find(".nav_style3_main_content").hover(
								function() {
								}, function() {
									a.body
											.find(".nav_style1_content_li")
											.removeClass("nav_style1_content_hover1");
									a.body.find(".nav_style1_sub").hide()
								});
						break;
					case 4 :
						b = 60, a.body.find(".nav_style1_content").css(
								"cursor", "default"), a.body
								.find(".nav_style4_Class12").hover(function() {
									a.body
											.find(".nav_style4_Class12")
											.removeClass("nav_style1_content_hover");
									$(this)
											.addClass("nav_style1_content_hover");
									var c = a.body.find(".nav_style4_Class12")
											.index(this);
									a.body.find(".nav_style1_sub").hide();
									a.body.find(".nav_style1_sub").eq(c).show();
									a.body.find(".nav_style1_sub").eq(c)
											.height() < b
											&& a.body.find(".nav_style1_sub")
													.eq(c).height(b);
									var e = $(this).offset().top
											- a.body
													.find(".nav_style4_main_content")
													.offset().top, e = e
											+ ($(this).height() + 10);
									a.body.find(".nav_style1_sub").eq(c)
											.height() < e
											&& a.body
													.find(".nav_style1_sub")
													.eq(c)
													.css(
															"top",
															Math
																	.round(e
																			- a.body
																					.find(".nav_style1_sub")
																					.eq(c)
																					.height())
																	+ "px")
								}, function() {
								}), a.body.find(".nav_style4_main_content")
								.hover(function() {
										}, function() {
											a.body
													.find(".nav_style4_Class12")
													.removeClass("nav_style1_content_hover");
											a.body.find(".nav_style1_sub")
													.hide()
										})
				}
				a.show_mode != PluginConstant.SHOW_MODE_STATIC
						&& (a.body.find(".class1").css("cursor", "pointer"), a.body
								.find(".class1").click(function() {
									var a = $(this).attr("class1_id");
									goto_search_link(null, a, null, null, null,
											null)
								}), a.body.find(".class2").css("cursor",
								"pointer"), a.body.find(".class2").click(
								function() {
									var a = $(this).attr("class2_id");
									goto_search_link(null, null, a, null, null,
											null)
								}), a.body.find(".class3").css("cursor",
								"pointer"), a.body.find(".class3").click(
								function() {
									var a = $(this).attr("class3_id");
									goto_search_link(null, null, null, a, null,
											null)
								}))
		}
	} catch (c) {
	}
	mobile_size_nav_all(a)
}
function mobile_size_nav_all(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.width, b = b.height;
	switch (a.data.Style) {
		case 0 :
			a.body.find(".nav_style0_main_content").width(c), a.body
					.find(".nav_style0_main_content").height(b), 600 >= c
					? a.body.find(".nav_style0_a").css("width", "100%")
					: a.body.find(".nav_style0_a").css("width", "49%")
	}
}
function mobile_show_nav_v(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), mobile_show_title(a), a.data.Style) {
				case 0 :
					$("#store_nav_v_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
		a.show_mode == PluginConstant.SHOW_MODE_DISPLAY
				&& (a.body.find(".nav_class2").click(function() {
							var a = $(this).attr("class2_id");
							goto_search_link(null, null, a, null, null, null)
						}), a.body.find(".nav_class3").click(function() {
							var a = $(this).attr("class3_id");
							goto_search_link(null, null, null, a, null, null)
						}))
	} catch (b) {
	}
	mobile_size_nav_v(a)
}
function mobile_size_nav_v(a) {
	mobile_set_plugin_boder_size(a)
}
function mobile_show_nav_tag(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#store_nav_tag_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content"))), 2 == a.data.Style
				? a.show_mode != PluginConstant.SHOW_MODE_DISPLAY
						&& a.show_mode != PluginConstant.SHOW_MODE_STATIC
						|| a.body.find("#nav_tag_seach").click(function() {
							var b = a.body.find("#nav_tag_select").val();
							if ("" == b)
								return alert("\u8bf7\u9009\u62e9\u6709\u6548\u7684\u67e5\u8be2\u6761\u4ef6"), !1;
							goto_search_link(null, null, null, null, null, b)
						})
				: a.show_mode == PluginConstant.SHOW_MODE_DISPLAY
						&& a.body.find(".tag_item").click(function() {
									var a = $(this).attr("item_id");
									goto_search_link(null, null, null, null,
											null, a)
								})
	} catch (b) {
	}
	mobile_size_nav_tag(a)
}
function mobile_size_nav_tag(a) {
	mobile_set_plugin_boder_size(a)
}
function mobile_show_text_news(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), mobile_show_title(a), a.data.Style) {
				case 0 :
					$("#text_news_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#text_news_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 2 :
					$("#text_news_style2_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
	} catch (b) {
	}
	news_click(a);
	mobile_size_text_news(a)
}
function mobile_size_text_news(a) {
	var b = mobile_set_plugin_boder_size(a).height;
	switch (a.data.Style) {
		case 2 :
			a.body.find(".news_title").each(function() {
				var a = $(this).parent(), b = a.width(), a = a
						.find(".text_news_style2_position").width();
				$(this).width(b - a)
			})
	}
	var c = a.body.find(".text_news_list li").height(), b = Math.floor(b / c);
	a.body.find(".plugin_news_main_content").height(c * b);
	!0 == a.data.Roll && a.body.find(".text_news_list").carouFredSel({
		items : b,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
				? "up"
				: "down"
	})
}
function mobile_show_graphic_news(a) {
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC)
			switch (a.body.empty(), mobile_show_title(a), a.data.Style) {
				case 0 :
					$("#graphic_news_style0_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"));
					break;
				case 1 :
					$("#graphic_news_style1_tmpl").tmpl(a).appendTo(a.body
							.find(".plugin_inner_content"))
			}
	} catch (b) {
	}
	news_click(a);
	mobile_size_graphic_news(a)
}
function mobile_size_graphic_news(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.width, b = b.height;
	if (0 == a.data.Style) {
		var d = a.body.find(".graphic_news_style0_img").width(), c = c - d - 20;
		a.body.find(".graphic_news_style0_news").width(c)
	} else
		d = a.body.find(".graphic_news_style1_img").width(), c = c - d - 20, a.body
				.find(".graphic_news_style1_news").width(c);
	if (!0 == a.data.Roll)
		switch (a.data.Style) {
			case 0 :
				c = a.body.find(".graphic_news_style0_list li").height();
				b = Math.round(b / c);
				a.body.find(".graphic_news_style0_list").carouFredSel({
					items : b,
					auto : Number(a.data.Interval),
					scroll : {
						items : 1,
						pauseOnHover : !0
					},
					direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
							? "up"
							: "down"
				});
				break;
			case 1 :
				c = a.body.find(".graphic_news_style1_list li").height(), b = Math
						.round(b / c), a.body.find(".graphic_news_style1_list")
						.carouFredSel({
							items : b,
							auto : Number(a.data.Interval),
							scroll : {
								items : 1,
								pauseOnHover : !0
							},
							direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
									? "up"
									: "down"
						})
		}
}
function news_click(a) {
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_DISPLAY :
			a.body.find(".news_title").click(function() {
				var b = $(this).attr("news_id"), c = $(this).attr("index_id"), b = a
						.get_news(b);
				if (null != b)
					switch (b.LinkType) {
						case Constant.LINK_TYPE_NONE :
							goto_news_link(c, plugin_save_level);
							break;
						case Constant.LINK_TYPE_URL :
							goto_url_link(b.LinkParam);
							break;
						case Constant.LINK_TYPE_SEARCH :
							goto_search_link(b.LinkParam, null, null, null,
									null, null);
							break;
						case Constant.LINK_TYPE_CLASS :
							try {
								var d = $.parseJSON(b.LinkParam);
								d.class1_id = null == d.class1_id
										|| "" == $.trim(d.class1_id)
										? null
										: d.class1_id;
								d.class2_id = null == d.class2_id
										|| "" == $.trim(d.class2_id)
										? null
										: d.class2_id;
								d.class3_id = null == d.class3_id
										|| "" == $.trim(d.class3_id)
										? null
										: d.class3_id;
								goto_search_link(null, d.class1_id,
										d.class2_id, d.class3_id, null, null)
							} catch (e) {
							}
							break;
						case Constant.LINK_TYPE_PAGE :
							goto_page_link(b.LinkParam, !0);
							break;
						case Constant.LINK_TYPE_SALES :
							goto_search_link(null, null, null, null,
									b.LinkParam, null);
							break;
						case Constant.LINK_TYPE_GOODS :
							goto_goods_link(b.LinkParam, !0);
							break;
						case Constant.LINK_TYPE_TAGITEM :
							goto_search_link(null, null, null, null, null,
									b.LinkParam)
					}
			})
	}
}
function mobile_show_advertising(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#advertising_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content"))), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				a.body.find(".adv_image").css("cursor", "pointer"), a.body
						.find(".adv_image").click(function() {
									var b = $(this).attr("index");
									mobile_image_click(a.data.Advertising[b])
								})
		}
	} catch (b) {
	}
	mobile_size_advertising(a)
}
function mobile_parts_mobile_size_advertising(a, b) {
	var c = mobile_get_plugin_inner_size(a), d = [];
	d.push({
				w : c.width,
				h : c.height
			});
	return d[b]
}
function mobile_size_advertising(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.width, b = b.height;
	a.body.find(".banner_img li").width(c);
	a.body.find(".banner_img li").height(b);
	a.body.find(".banner_img img").width(c);
	a.body.find(".banner_img img").height(b);
	a.body.find(".banner_number").width(29
			* a.body.find(".banner_img img").length);
	a.body.find(".banner_img").carouFredSel({
		items : 1,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_LEFT
				? "left"
				: "right",
		pagination : {
			container : a.body.find(".banner_number"),
			anchorBuilder : function(a) {
				return '<li class="bg_j" > </li>'
			}
		}
	})
}
function mobile_image_click(a) {
	if (null != a)
		switch (a.LinkType) {
			case Constant.LINK_TYPE_NEWS :
				goto_news_link(a.LinkParam, plugin_save_level);
				break;
			case Constant.LINK_TYPE_URL :
				goto_url_link(a.LinkParam);
				break;
			case Constant.LINK_TYPE_SEARCH :
				goto_search_link(a.LinkParam, null, null, null, null, null);
				break;
			case Constant.LINK_TYPE_CLASS :
				try {
					var b = $.parseJSON(a.LinkParam);
					b.class1_id = null == b.class1_id
							|| "" == $.trim(b.class1_id) ? null : b.class1_id;
					b.class2_id = null == b.class2_id
							|| "" == $.trim(b.class2_id) ? null : b.class2_id;
					b.class3_id = null == b.class3_id
							|| "" == $.trim(b.class3_id) ? null : b.class3_id;
					goto_search_link(null, b.class1_id, b.class2_id,
							b.class3_id, null, null)
				} catch (c) {
				}
				break;
			case Constant.LINK_TYPE_PAGE :
				goto_page_link(a.LinkParam, !0);
				break;
			case Constant.LINK_TYPE_SALES :
				goto_search_link(null, null, null, null, a.LinkParam, null);
				break;
			case Constant.LINK_TYPE_GOODS :
				goto_goods_link(a.LinkParam, !0);
				break;
			case Constant.LINK_TYPE_TAGITEM :
				goto_search_link(null, null, null, null, null, a.LinkParam)
		}
}
function mobile_show_image(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#image_type"
						+ a.data.Type + "_tmpl").tmpl(a).appendTo(a.body
						.find(".plugin_inner_content"))), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				for (var b = 0; b < a.data.Advertising.length; b++) {
					var c = a.body.find("#image" + b);
					c.attr("index", b);
					c.css("cursor", "pointer");
					c.click(function() {
								var b = $(this).attr("index");
								mobile_image_click(a.data.Advertising[b])
							})
				}
		}
	} catch (d) {
	}
	mobile_size_image(a)
}
function mobile_parts_mobile_size_image(a, b) {
	var c = mobile_size_image_calc(a);
	return b < c.length ? c[b] : {
		w : 0,
		h : 0
	}
}
function mobile_size_image_calc(a) {
	a = csharp_size_image_calc(a.frame_config, a.body.width(), a.body.height(),
			a.plugin_type, a.data.ShowTitle, a.data.Type, a.data.Style);
	for (var b = 0; b < a.length; b++)
		a[b].w = parseInt(a[b].w), a[b].h = parseInt(a[b].h);
	return a
}
function mobile_size_image(a) {
	mobile_set_plugin_boder_size(a);
	if (a.show_mode != PluginConstant.SHOW_MODE_STATIC) {
		var b = mobile_size_image_calc(a);
		a.body.find(".li1").width(Math.floor(b[1].w));
		a.body.find(".li1").height(Math.floor(b[1].h));
		a.body.find(".li2").width(Math.floor(b[2].w));
		a.body.find(".li2").height(Math.floor(b[2].h));
		a.body.find(".li3").width(Math.floor(b[3].w));
		a.body.find(".li3").height(Math.floor(b[3].h));
		a.body.find(".li4").width(Math.floor(b[4].w));
		a.body.find(".li4").height(Math.floor(b[4].h));
		a.body.find(".li5").width(Math.floor(b[5].w));
		a.body.find(".li5").height(Math.floor(b[5].h));
		a.body.find(".li6").width(Math.floor(b[6].w));
		a.body.find(".li6").height(Math.floor(b[6].h));
		a.body.find(".li7").width(Math.floor(b[7].w));
		a.body.find(".li7").height(Math.floor(b[7].h));
		a.body.find(".li8").width(Math.floor(b[8].w));
		a.body.find(".li8").height(Math.floor(b[8].h));
		a.body.find(".li9").width(Math.floor(b[9].w));
		a.body.find(".li9").height(Math.floor(b[9].h))
	}
}
function mobile_show_carousel(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#carousel_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")));
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
				a.body.find(".adv_image").css("cursor", "pointer"), a.body
						.find(".adv_image, .adv_text").click(function() {
									var b = $(this).attr("index");
									mobile_image_click(a.data.Advertising[b])
								})
		}
		a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE ? a.body
				.find(".adv_text").hide() : a.body.find(".adv_text").show()
	} catch (b) {
	}
	mobile_size_carousel(a)
}
function parts_mobile_size_carousel(a, b) {
	var c = mobile_get_plugin_inner_size(a), d = [];
	d.push({
				w : c.width,
				h : c.height
			});
	for (var e = 0, f = 0, e = a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? parseInt(c.width / a.data.Setting.ShowNumber)
			: parseInt((c.width - 4 * a.data.Setting.ShowNumber)
					/ a.data.Setting.ShowNumber), f = a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE
			? c.height
			: c.height - 30, c = 0; c < a.data.Advertising.length; c++)
		d.push({
					w : e,
					h : f
				});
	return d[b]
}
function mobile_size_carousel(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.height, d = 0, e = 0, d = a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? parseInt(b.width / a.data.Setting.ShowNumber)
			: parseInt((b.width - 4 * a.data.Setting.ShowNumber)
					/ a.data.Setting.ShowNumber), e = a.data.Setting.ShowText == Constant.PLUGIN_CAROUSEL_TEXT_NONE
			? b.height
			: b.height - 40;
	a.body.find(".plugin_carousel_box li").width(d);
	a.body.find(".plugin_carousel_box li").height(c);
	a.data.Setting.Gap == Constant.PLUGIN_CAROUSEL_GAP_NONE
			? (a.body.find(".plugin_carousel_box li").css("margin-left", "0px"), a.body
					.find(".plugin_carousel_box li").css("margin-right", "0px"))
			: (a.body.find(".plugin_carousel_box li").css("margin-left", "2px"), a.body
					.find(".plugin_carousel_box li").css("margin-right", "2px"));
	a.body.find(".plugin_carousel_box li img").width(d);
	a.body.find(".plugin_carousel_box li img").height(e);
	a.body.show();
	a.body.find(".plugin_carousel_box").carouFredSel({
		items : Number(a.data.Setting.ShowNumber),
		auto : Number(a.data.Setting.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Setting.Direction == Constant.PLUGIN_CAROUSEL_DIR_LEFT
				? "left"
				: "right"
	})
}
function showcase_mobile_goods_process(a, b, c, d) {
	var e = {};
	e.Style = a.data.Style;
	e.show_mode = a.show_mode;
	e.GoodsStyle = a.data.GoodsStyle;
	null == c && a.show_mode == PluginConstant.SHOW_MODE_STATIC
			? (e.label = {}, e.label.Goods = [], b.find(".goods_list").each(
					function() {
						e.label.Goods.push({
									RuleId : $(this).attr("RuleId"),
									RuleType : $(this).attr("RuleType"),
									RuleStartTime : $(this)
											.attr("RuleStartTime").replace(
													RegExp("[\\\\]", "g"), ""),
									RuleEndTime : $(this).attr("RuleEndTime")
											.replace(RegExp("[\\\\]", "g"), ""),
									Price : $(this).attr("Price"),
									DiscountPrice : $(this)
											.attr("DiscountPrice")
								})
					}))
			: e.label = c;
	e.label.index = d;
	if (a.show_mode != PluginConstant.SHOW_MODE_STATIC
			&& (b.empty(), $("#showcase_goods_tmpl").tmpl(e).appendTo(b), a.show_mode == PluginConstant.SHOW_MODE_EDIT
					&& (null == e.label.Goods || 0 >= e.label.Goods.length)))
		switch (a.data.Style) {
			case 0 :
				b.addClass("mobile_empty_goods1");
				break;
			case 1 :
				b.addClass("mobile_empty_goods2");
				break;
			case 2 :
				b.addClass("mobile_empty_goods3")
		}
	b.find(".goods_list").each(function(a) {
		a = get_goods_sales(e.label.Goods[a]);
		null != a.rule_icon_txt
				&& ($(this).find(".sales_icon_txt").text(a.rule_icon_txt), $(this)
						.find(".sales_icon_txt").show());
		null != a.rule_price
				&& $(this).find("#sales_price").text((a.rule_price / 100)
						.toFixed(2))
	});
	switch (a.data.Style) {
		case 0 :
			mobile_showcase_fix_image(b.find(".showcase_goods_style0_img")
							.width(), b.find(".showcase_goods_style0_img")
							.height(), b.find(".showcase_goods_style0_img img"));
			break;
		case 1 :
			mobile_showcase_fix_image(b.find(".showcase_goods_style1").width(),
					b.find(".showcase_goods_style1").height(), b
							.find(".showcase_goods_style1 img"))
	}
	switch (a.show_mode) {
		case PluginConstant.SHOW_MODE_DISPLAY :
			b.find(".goods_list").css("cursor", "pointer"), b
					.find(".goods_list").click(function() {
								var a = $(this).attr("goods_id");
								goto_goods_link(a, !0)
							});
		case PluginConstant.SHOW_MODE_PREVIEW :
		case PluginConstant.SHOW_MODE_STATIC :
			break;
		case PluginConstant.SHOW_MODE_EDIT :
			permissions[permisson_map.PageContent]
					&& (b.find(".showcase_goods_handle").each(function() {
						var a = $(this).parent(), b = a.width(), a = a.height();
						$(this).width(Math.round(b / 2));
						$(this).height(Math.round(a / 2));
						$(this).css("top", Math.round(a / 4) + "px");
						$(this).css("left", Math.round(b / 4) + "px")
					}), b.sortable({
								cancel : ".sortable_cancel",
								handle : ".showcase_goods_handle",
								stop : function(c, d) {
									var e = b.find(".goods_list").index(d.item)
											+ 1;
									a.move_showcase_goods(d.item
													.attr("label_id"), d.item
													.attr("goods_id"), e)
								}
							}))
	}
}
function mobile_showcase_fix_image(a, b, c) {
	var d, e, f, h;
	b > a
			? (e = 0, h = b, d = Math.round((b - a) / 2), f = b)
			: (d = 0, f = a, e = Math.round((a - b) / 2), h = a);
	c.css({
				width : f + "px",
				height : h + "px",
				marginLeft : "-" + d + "px",
				marginTop : "-" + e + "px"
			})
}
function mobile_showcase_fix_goods_list(a, b, c) {
	var d, e;
	switch (a.data.ShowTitle) {
		case 0 :
			c = 2;
			break;
		case 1 :
			c = 0;
			break;
		default :
			c = 6
	}
	d = Math.floor(b / 302);
	1 > d && (d = 1);
	b = Math.floor((b - 300 * d) / (2 * d));
	0 > b && (b = 0);
	d = b;
	e = 20 - c;
	0 > e && (e = 0);
	a.body.find(".goods_list").css("padding-left", b + "px");
	a.body.find(".goods_list").css("padding-right", d + "px");
	a.body.find(".goods_list").css("padding-top", c + "px");
	a.body.find(".goods_list").css("padding-bottom", e + "px")
}
function mobile_show_showcase_type0(a) {
	try {
		switch (a.show_mode != PluginConstant.SHOW_MODE_STATIC
				? (a.body.empty(), mobile_show_title(a), $("#showcase_type0_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")), showcase_mobile_goods_process(
						a, a.body.find(".showcase_type0_goods"),
						a.data.Labels[0], 0))
				: showcase_mobile_goods_process(a, a.body
								.find(".showcase_type0_goods"), null, 0), a.show_mode) {
			case PluginConstant.SHOW_MODE_DISPLAY :
			case PluginConstant.SHOW_MODE_PREVIEW :
				a.body.find(".search_key").click(function() {
							var a = $(this).find("a").text();
							goto_search_link(a, null, null, null, null, null)
						});
				break;
			case PluginConstant.SHOW_MODE_EDIT :
				permissions[permisson_map.PageContent]
						&& (a.body.find(".plugin_title_searchkey li").css(
								"cursor", "text"), a.body
								.find(".plugin_title_searchkey a").css(
										"cursor", "text"), a.body
								.find(".search_key").find("a").click(
										function() {
											var b = $(this).parents("li"), d = b
													.find("input");
											d.val($(this).text());
											d.width(b.width());
											d.height(b.height() - 4);
											$(this).hide();
											d.show();
											d.focus();
											d.blur(function() {
												var e = $.trim(b.find("a")
														.text()), f = $.trim(d
														.val()), h = b
														.attr("index");
												"" == f
														? a.del_search_key(h)
														: e != f
																&& a
																		.edit_search_key(
																				h,
																				f);
												d.hide();
												d.val(e);
												b.find("a").show()
											});
											d.keyup(function(a) {
												13 == a.keyCode
														? d.blur()
														: 27 == a.keyCode
																&& (d
																		.val(b
																				.find("a")
																				.text()), d
																		.blur())
											})
										}), a.body.find(".add_key").click(
								function() {
									var b = $(this).find("input");
									b.show();
									b.focus();
									b.blur(function() {
												var d = $.trim($(this).val());
												"" != d && a.add_search_key(d);
												b.val("");
												b.hide()
											});
									b.keyup(function(a) {
										13 == a.keyCode
												? b.blur()
												: 27 == a.keyCode
														&& (b.val(""), b.blur())
									})
								}), a.body.find(".plugin_title_searchkey")
								.sortable({
									cancel : ".ui-state-disabled",
									stop : function(b, d) {
										var e = d.item.attr("index"), f = a.body
												.find(".plugin_title_searchkey")
												.find(".search_key")
												.index(d.item);
										a.move_search_key(e, f)
									}
								}))
		}
	} catch (b) {
	}
	mobile_size_showcase_type0(a)
}
function mobile_size_showcase_type0(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.width;
	mobile_showcase_fix_goods_list(a, c, b.height);
	b = a.body.find(".showcase_type0_goods li").width();
	c = Math.floor(c / b);
	!0 == a.data.Roll && a.body.find(".showcase_type0_goods").carouFredSel({
		items : c,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_RIGHT
				? "right"
				: "left"
	})
}
function right_mobile_size_showcase_type0(a, b, c, d, e) {
	b = 5;
	c = 1;
	switch (a.data.ShowTitle) {
		case 0 :
			c = 0;
			break;
		case 1 :
			c = 0;
			break;
		default :
			c = 2
	}
	switch (a.data.Style) {
		case 0 :
			b = 10;
			break;
		case 1 :
			b = 10;
			break;
		default :
			b = 10
	}
	a = {
		cx : d,
		cy : e
	};
	a.cy = e < b + c ? b + c : b + c + Math.floor((e - (b + c) + (b - 1)) / b)
			* b;
	return a
}
function mobile_show_showcase_type1(a) {
	function b(b) {
		var c = a.body.find(".showcase_type1_title").find(".label_list"), d = a.body
				.find(".showcase_type1_goods"), g = d.eq(b);
		if (a.show_mode == PluginConstant.SHOW_MODE_STATIC) {
			var k = c.eq(b).attr("processed");
			if (null == k || "true" != k)
				showcase_mobile_goods_process(a, g, null, b), c.eq(b).attr(
						"processed", "true")
		}
		c.index(this);
		c.removeClass("checked");
		c.eq(b).addClass("checked");
		d.hide();
		g.show()
	}
	try {
		if (a.show_mode != PluginConstant.SHOW_MODE_STATIC) {
			a.body.empty();
			mobile_show_title(a);
			$("#showcase_type1_tmpl").tmpl(a).appendTo(a.body
					.find(".plugin_inner_content"));
			for (var c = 0; c < a.data.Labels.length; c++)
				showcase_mobile_goods_process(a, a.body
								.find(".showcase_type1_goods").eq(c),
						a.data.Labels[c], c);
			null != a.data.Labels
					&& 0 < a.data.Labels.length
					&& (a.curr_label < a.data.Labels.length
							? b(a.curr_label)
							: (a.curr_label = 0, b(0)))
		} else
			a.curr_label = 0, b(0);
		a.body.find(".showcase_type1_title").find(".label_list").hover(
				function() {
					var c = a.body.find(".showcase_type1_title")
							.find(".label_list").index(this);
					b(c);
					a.curr_label = c
				}, function() {
				});
		switch (a.show_mode) {
			case PluginConstant.SHOW_MODE_EDIT :
				permissions[permisson_map.PageContent]
						&& (a.body.find(".label_list a").css("cursor", "text"), a.body
								.find(".label_list").find("a").click(
										function() {
											var b = $(this).parents("li"), c = b
													.find("input");
											c.val($(this).text());
											c.width(b.width());
											c.height(b.height() - 4);
											$(this).hide();
											c.show();
											c.focus();
											c.blur(function() {
												var d = $.trim(b.find("a")
														.text()), g = $.trim(c
														.val()), k = b
														.attr("label_id");
												"" == g
														? a.delete_label(k)
														: d != g
																&& a
																		.change_label_name(
																				k,
																				g);
												c.hide();
												c.val(d);
												b.find("a").show()
											});
											c.keyup(function(a) {
												13 == a.keyCode
														? c.blur()
														: 27 == a.keyCode
																&& (c
																		.val(b
																				.find("a")
																				.text()), c
																		.blur())
											})
										}), a.body.find(".add_label").click(
								function() {
									var b = $(this).find("input");
									b.show();
									b.focus();
									b.blur(function() {
												var c = $.trim($(this).val());
												"" != c && a.add_label(c);
												b.val("");
												b.hide()
											});
									b.keyup(function(a) {
										13 == a.keyCode
												? b.blur()
												: 27 == a.keyCode
														&& (b.val(""), b.blur())
									})
								}), a.body.find(".showcase_type1_title")
								.sortable({
									cancel : ".sortable_cancel",
									stop : function(b, c) {
										var d = a.body
												.find(".showcase_type1_title")
												.find("li").index(c.item)
												+ 1;
										a
												.move_label(
														c.item.attr("label_id"),
														d)
									}
								}))
		}
	} catch (d) {
	}
	mobile_size_showcase_type1(a)
}
function mobile_size_showcase_type1(a) {
	var b = mobile_set_plugin_boder_size(a);
	mobile_showcase_fix_goods_list(a, b.width, b.height)
}
function right_mobile_size_showcase_type1(a, b, c, d, e) {
	b = 10;
	switch (a.data.Style) {
		case 0 :
			b = 10;
			break;
		case 1 :
			b = 10;
			break;
		default :
			b = 4
	}
	a = {
		cx : d,
		cy : e
	};
	a.cy = e < b + 2 ? b + 2 : b + 2 + Math.floor((e - (b + 2) + (b - 1)) / b)
			* b;
	return a
}
function mobile_show_showcase_type2(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				? (a.body.empty(), mobile_show_title(a), $("#showcase_type2_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")), showcase_mobile_goods_process(
						a, a.body.find(".showcase_type2_goods"),
						a.data.Labels[0], 0))
				: showcase_mobile_goods_process(a, a.body
								.find(".showcase_type2_goods"), null, 0)
	} catch (b) {
	}
	mobile_size_showcase_type2(a)
}
function mobile_size_showcase_type2(a) {
	var b = mobile_set_plugin_boder_size(a), c = b.width, b = b.height;
	a.body.find(".showcase_type2_goods li").width(c);
	a.body.find(".showcase_type2_goods .a_text").width(c - 30 - 150);
	c = a.body.find(".showcase_type2_goods li").height();
	c = Math.floor(b / c);
	!0 == a.data.Roll && a.body.find(".showcase_type2_goods").carouFredSel({
		items : c,
		auto : Number(a.data.Interval),
		scroll : {
			items : 1,
			pauseOnHover : !0
		},
		direction : a.data.Direction == Constant.PLUGIN_CAROUSEL_DIR_UP
				? "up"
				: "down"
	})
}
function right_mobile_size_showcase_type2(a, b, c, d, e) {
	b = 5;
	c = 1;
	switch (a.data.ShowTitle) {
		case 0 :
			c = 0;
			break;
		case 1 :
			c = 0;
			break;
		default :
			c = 2
	}
	switch (a.data.Style) {
		case 0 :
			b = 4;
			break;
		case 1 :
			b = 4;
			break;
		default :
			b = 4
	}
	a = {
		cx : d,
		cy : e
	};
	a.cy = e < b + c ? b + c : b + c + Math.floor((e - (b + c) + (b - 1)) / b)
			* b;
	return a
}
function mobile_show_message(a) {
	function b(a, b, c) {
		if (!CheckInput.IsEmpty(a.Contacts)
				&& a.Contacts.length > Constant.INPUT_REALNAME_MAX)
			return alert("\u59d3\u540d\u4e0d\u80fd\u5927\u4e8e"
					+ Constant.INPUT_REALNAME_MAX + "\u4e2a\u5b57"), !1;
		if ("" == a.Phone && "" == a.Qq)
			return alert("\u8bf7\u81f3\u5c11\u7559\u4e0b\u4e00\u79cd\u8054\u7cfb\u65b9\u5f0f(\u624b\u673a\u53f7\u7801\u6216QQ\u53f7\u7801)"), !1;
		if ("" != a.Phone && !CheckInput.IsMobilePhone(a.Phone))
			return alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e"), !1;
		if ("" != a.Qq && !CheckInput.IsQQ(a.Qq))
			return alert("QQ\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e"), !1;
		if (!CheckInput.IsEmpty(a.Constant)
				&& a.Content.length > Constant.INPUT_SYS_MESAGE_CONTENT_MAX)
			return alert("\u7559\u8a00\u5185\u5bb9\u4e0d\u80fd\u5927\u4e8e"
					+ Constant.INPUT_SYS_MESAGE_CONTENT_MAX + "\u4e2a\u5b57"), !1;
		b && OpenLoadingDialog();
		$.ajax({
					url : getActionPath("MessageCreate", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								message : a
							}),
					success : function(a) {
						b && CloseLoadingDialog();
						!0 == a.success ? null != c && c() : ShowActionError(
								a.error, "seller")
					},
					error : function(a, b, c) {
						ShowAjaxError(a, b, c)
					}
				})
	}
	try {
		a.show_mode == PluginConstant.SHOW_MODE_STATIC ? a.body
				.find("#message_add").click(function() {
					var c = {};
					c.Contacts = $.trim(a.body.find("#contacts").val());
					c.Phone = $.trim(a.body.find("#phone").val());
					c.Qq = $.trim(a.body.find("#qq").val());
					c.Content = $.trim(a.body.find("#content").val());
					b(c, !0, function() {
						alert("\u60a8\u5df2\u7ecf\u7559\u8a00\u6210\u529f,\u611f\u8c22\u60a8\u7684\u652f\u6301!");
						a.body.find("#contacts").val("");
						a.body.find("#phone").val("");
						a.body.find("#qq").val("");
						a.body.find("#content").val("")
					})
				})
				: (a.body.empty(), mobile_show_title(a), $("#plugin_message_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (c) {
	}
	mobile_size_message(a)
}
function mobile_size_message(a) {
	var b = mobile_set_plugin_boder_size(a).width;
	a.body.find(".plugin_message_Input").width(b - 132)
}
function mobile_show_header(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#plugin_header_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (b) {
	}
	a.show_mode == PluginConstant.SHOW_MODE_STATIC
			&& (a.body.find(".search_button").click(function() {
				var b = a.body.find("input[name=search_text]").val();
				null != b && "" != b
						&& goto_search_link(b, null, null, null, null, null)
			}), a.body.find("input[name=search_text]").keyup(function(b) {
				13 == b.keyCode
						&& (b = a.body.find("input[name=search_text]").val(), null != b
								&& "" != b
								&& goto_search_link(b, null, null, null, null,
										null))
			}));
	mobile_size_header(a)
}
function mobile_size_header(a) {
	mobile_set_plugin_boder_size(a)
}
function parts_mobile_size_header(a, b) {
	var c = mobile_get_plugin_inner_size(a), d = [];
	d.push({
				w : c.width,
				h : c.height
			});
	return d[b]
}
function mobile_button_fix_list(a, b, c) {
	var d;
	d = Math.floor(b / (c + 2));
	1 > d && (d = 1);
	b = Math.floor((b - c * d) / (2 * d));
	0 > b && (b = 0);
	c = b;
	a.body.find(".plugin_button").css("margin-left", b + "px");
	a.body.find(".plugin_button").css("margin-right", c + "px")
}
function mobile_show_button(a) {
	try {
		a.show_mode != PluginConstant.SHOW_MODE_STATIC
				&& (a.body.empty(), mobile_show_title(a), $("#plugin_button_tmpl")
						.tmpl(a).appendTo(a.body.find(".plugin_inner_content")))
	} catch (b) {
	}
	mobile_size_button(a)
}
function mobile_size_button(a) {
	var b = mobile_set_plugin_boder_size(a).width;
	mobile_button_fix_list(a, b, a.body.find(".plugin_button").outerWidth())
};
var iStoreLayout = function(a, b, c, d) {
	this.istore_option = a;
	this.plugin_option = b;
	this.can_layout = c;
	this.can_setting = d;
	var e = this;
	this.update_plugins = [];
	a.on_updata_layout_start = function() {
		e.on_updata_layout_start()
	};
	a.on_updata_layout_end = function() {
		e.on_updata_layout_end()
	};
	this.store_containers = new iStoreContainers(a);
	for (a = 0; a < iStorePluginDef.length; a++)
		this.add_plugin_button(iStorePluginDef[a].plugin_type)
};
iStoreLayout.prototype = { //插件移动，同时联动触发布局一起移动。插件触发布局，布局触发容器
	show_store_layout : function() {
		if (null != this.layout_data)
			for (var a = 0; a < this.layout_data.length; a++) //数组
				this.add_plugin_layout(this.layout_data[a])
	},
	get_store_layout : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreLayout", "Store"), //add by wui
					dataType : "json",
					contentType: "application/json",
					type : "POST",
					data : stringify({
								page_id : this.istore_option.page_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success ? (a.layout_data = b.store_layout, a //返回layout实例数据
								.show_store_layout()) : ShowActionError(
								b.error, "admin") //add by wuilayout_data渲染实际数据信息
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	add_plugin_button : function(a) { //add by wui plugin 设置插件按钮处理逻辑
		var b = this, c = this.add_plugin(a);
		c.opts.on_dropdown = function(c, d, h, g) { // 推动结束后联动处理
			b.on_dropdown(c, d, h, g);
			b.add_plugin_button(a)
		};
		for (var d = 0; d < this.plugin_option.length; d++)
			if (this.plugin_option[d].plugin_type == a) {
				
				c.appendTo($(this.plugin_option[d].tools_bar)); //add by wuitools,设置插件与插件工具箱一一对应处理
				break
			}
		c.show_icon(); //设置插件展示
		c.show()//设置展示
	},
	add_plugin_layout : function(a) { //设置插件布局处理逻辑
		var b = this.add_plugin(a.PluginType);
		if(b == null)
			return ;
		b.plugin_id = a.PluginId; //位置信息,可供应一个库表
		b.layout_id = a.StoreLayoutId;
		b.grid_x = a.GridX;
		b.grid_y = a.GridY;
		b.grid_cx = a.GridCx;
		b.grid_cy = a.GridCy;
		b.data = a.data; //存放基础信息
		this.store_containers.add_plugin(b)
	},
	add_plugin : function(a) {
		for (var b = this, c = 0; c < iStorePluginDef.length; c++)
			if (iStorePluginDef[c].plugin_type == a) {
				for (var d = null, e = 0; e < this.plugin_option.length; e++)
					if (this.plugin_option[e].plugin_type == a) {//plugin_option控制规格基本信息，包括界面展现风格方式
						d = $.extend(!0, {}, this.plugin_option[e]);
						break
					}
				null == d && (d = {
					plugin_type : a,
					content : "<div> \u672a\u8bbe\u7f6e\u5185\u5bb9 </div>",
					icon : "<div> <img /> </div>",
					tools_bar : $("body"),//处理工具类,工具拖拽产生,直接界面展示
					on_show : null,
					on_sized : null
				});
				a = $.extend(!0, {}, d, {
							plugin_type : a,
							show_mode : PluginConstant.SHOW_MODE_EDIT,
							frame_config : this.istore_option.frame_config,
							page_id : this.istore_option.page_id,
							containers : this.store_containers, //设置插件所归属容器信息
							can_layout : this.can_layout,//是否允许布局
							can_setting : this.can_setting,//是否允许设置
							on_remove : function(a) {
								b.on_remove(a)
							},
							on_moved : function(a, c, e) {
								b.on_moved(a);
								if (null != d.on_sized)
									d.on_sized(a, a.grid_cx, a.grid_cy)
							},
							on_sized : function(a, c, e) {
								b.on_sized(a);
								if (null != d.on_sized)
									d.on_sized(a, c, e)
							},
							on_show : function(a) {
								if (null != d.on_show)
									d.on_show(a) //add by wuishow
							}
						});
				return new iStorePluginDef[c].plugin_class(a)
			}
		return null
	},
	change_plugin : function(a) {
		for (var b = this, c = [], d = 0; d < a.length; d++) {
			var e = {};
			e.GridX = a[d].grid_x;
			e.GridY = a[d].grid_y;
			e.GridCx = a[d].grid_cx;
			e.GridCy = a[d].grid_cy;
			e.PluginType = a[d].plugin_type;
			e.PageId = this.istore_option.page_id;
			e.StoreLayoutId = a[d].layout_id;
			c.push(e)
		}
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("UpdateStoreLayout", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								page_id : this.istore_option.page_id,
								store_layout : c
							}),
					success : function(a) {
						CloseLoadingDialog();
						!0 != a.success
								&& (b.clear(), b.get_store_layout(), ShowActionError(
										a.error, "admin"))
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d);
						b.clear();
						b.get_store_layout()
					}
				})
	},
	on_dropdown : function(a, b, c, d) { //添加插入处理逻辑
		var e = this;
		b
				&& (b = {}, b.GridX = a.grid_x, b.GridY = a.grid_y, b.GridCx = a.grid_cx, b.GridCy = a.grid_cy, b.PluginType = a.plugin_type, b.PageId = this.istore_option.page_id, OpenLoadingDialog(), $
						.ajax({
							url : getActionPath("AddStoreLayout", "Store"),
							dataType : "json",
							contentType : "application/json",
							type : "POST",
							data : stringify({
										page_id : this.istore_option.page_id,
										store_layout : b
									}),
							success : function(b) {
								CloseLoadingDialog();
								!0 == b.success
										? (a.plugin_id = b.store_layout.PluginId, a.layout_id = b.store_layout.StoreLayoutId, a
												.on_show(!0))
										: (e.clear(), e.get_store_layout(), ShowActionError(
												b.error, "admin"))
							},
							error : function(a, b, c) {
								ShowAjaxError(a, b, c);
								e.clear();
								e.get_store_layout()
							}
						}))
	},
	on_remove : function(a) {
		var b = this;
		ShowConfirmDialog(
				"\u786e\u5b9e\u8981\u5220\u9664\u8fd9\u4e2a\u63d2\u4ef6\u5417?<br>\u70b9\u51fb\u786e\u5b9a\u5c06\u5220\u9664\u8be5\u63d2\u4ef6\u4ee5\u53ca\u5176\u4e2d\u7684\u6240\u6709\u5185\u5bb9!",
				function() {
					OpenLoadingDialog();
					$.ajax({
								url : getActionPath("DeleteStoreLayout",
										"Store"),
								dataType : "json",
								contentType : "application/json",
								type : "POST",
								data : stringify({
											page_id : b.istore_option.page_id,
											store_layout_id : a.layout_id
										}),
								success : function(c) {
									CloseLoadingDialog();
									!0 == c.success
											? b.store_containers
													.remove_plugin(a)
											: (b.clear(), b.get_store_layout(), ShowActionError(
													c.error, "admin"))
								},
								error : function(a, d, e) {
									ShowAjaxError(a, d, e);
									b.clear();
									b.get_store_layout()
								}
							})
				})
	},
	on_moved : function(a, b, c) {
		this.update_plugins.push(a)
	},
	on_sized : function(a, b, c) {
		this.update_plugins.push(a)
	},
	clear : function() {
		this.store_containers.clear();
		this.layout_data = null
	},
	on_updata_layout_start : function() {
		this.update_plugins = []
	},
	on_updata_layout_end : function() {//联动触发展示处理
		0 < this.update_plugins.length
				&& (this.change_plugin(this.update_plugins), this.update_plugins = [])
	}
};
var iStoreDisplay = function(a, b, c, d, e) {
	this.is_static = a;
	this.layout_data = b;
	this.istore_option = c;
	this.plugin_option = d;
	this.plugins = [];
	this.grid_width = csharp_get_max_grid_width(this.istore_option.frame_config);
	this.frame = $(e)
};
iStoreDisplay.prototype = {
	show_store_display : function() {
		if (null != this.layout_data)
			for (var a = 0; a < this.layout_data.length; a++)
				this.add_plugin_layout(this.layout_data[a])
	},
	get_store_display : function() {
		var a = this;
		OpenLoadingDialog();
		$.ajax({
					url : getActionPath("GetStoreLayout", "Store"),
					dataType : "json",
					contentType : "application/json",
					type : "POST",
					data : stringify({
								page_id : this.istore_option.page_id
							}),
					success : function(b) {
						CloseLoadingDialog();
						!0 == b.success ? (a.layout_data = b.store_layout, a
								.show_store_display()) : ShowActionError(
								b.error, "admin")
					},
					error : function(a, c, d) {
						ShowAjaxError(a, c, d)
					}
				})
	},
	add_plugin_layout : function(a) {
		var b = this.add_plugin(a.PluginType); //add by wuiplugin返回容器，处理StorePlugin插件
		if(null == b)
			return ;
		b.plugin_id = a.PluginId;
		b.layout_id = a.StoreLayoutId;
		b.grid_x = a.GridX;
		b.grid_y = a.GridY;
		b.grid_cx = a.GridCx;
		b.grid_cy = a.GridCy;
		b.data = a.data;
		b.is_new = !1; 
		this.is_static
				? (b.frame.remove(), b.frame = this.frame
						.find(".plugin_containers[layout_id=" + a.StoreLayoutId
								+ "]"), b.body = b.frame.find(".plugin_body"))
				: b.frame.appendTo(this.frame);
		b.plugin_type == Constant.PLUGIN_TYPE_NAV_ALL
				&& b.get_body().css("z-index", 10);
		this.plugins.push(b);  //生产模式时需要处理，模式
		this.move_all(this.plugins, !1);
		
		b.show_normal(); //去除拖拽
		b.show(); // iframe显示
		b.show_data() //调用插件显示数据
	},
	add_plugin : function(a) {
		for (var b = this, c = 0; c < iStorePluginDef.length; c++)
			if (iStorePluginDef[c].plugin_type == a) {
				for (var d = null, e = 0; e < this.plugin_option.length; e++)
					if (this.plugin_option[e].plugin_type == a) {
						d = $.extend(!0, {}, this.plugin_option[e]);
						break
					}
				null == d && (d = {
					plugin_type : a,
					content : "<div></div>",
					icon : "<div></div>",
					tools_bar : $("<div></div>"),
					on_show : null,
					on_sized : null
				});
				//预览模式  //发布模式
				a = $.extend(!0, {}, d, {
							plugin_type : a,
							show_mode : b.is_static
									? PluginConstant.SHOW_MODE_STATIC
									: PluginConstant.SHOW_MODE_DISPLAY,
							frame_config : this.istore_option.frame_config,
							icon : "<div></div>",
							tools_bar : $("<div></div>"),
							tools_show_resize : !1,
							page_id : this.istore_option.page_id,
							containers : this.store_containers,
							on_remove : function(a) {
								b.on_remove(a)
							}
						});
				return new iStorePluginDef[c].plugin_class(a)
			}
		return null
	},
	on_remove : function(a) {
	},
	on_moved : function(a, b, c) {
	},
	on_sized : function(a, b, c) {
	},
	set_size : function(a) {
		a = this.grid_to_pos(0, 0, this.grid_width, a);
		this.frame.width(a.width);
		this.frame.height(a.height)
	},
	move_all : function(a) {
		for (var b = 0; b < this.plugins.length; b++) {
			var c = this.grid_to_pos(a[b].grid_x, a[b].grid_y, a[b].grid_cx,
					a[b].grid_cy); //add by wuigrid 计算位置信息
			this.plugins[b].move(c.x1, c.y1, c.width, c.height)
		}
		this.set_size(this.get_max_height(a))
	},
	get_max_height : function(a) {
		for (var b = 1, c = 0; c < a.length; c++)
			a[c].grid_y + a[c].grid_cy > b && (b = a[c].grid_y + a[c].grid_cy);
		return b
	},
	grid_to_pos : function(a, b, c, d) {
		return csharp_grid_to_pos(this.istore_option.frame_config, a, b, c, d)
	}
};

var iStoreStatic = function(a, b, c) {
	this.istore_option = a;
	this.plugin_option = b;
	this.plugins = [];
	this.frame = $(c)
	this.grid_width = csharp_get_max_grid_width(0);
};
//生产预览模式处理逻辑
iStoreStatic.prototype = {
	show_store_display : function() {
		var a = this;
		this.frame.append($(".plugin_containers"));
		this.frame.find(".plugin_containers").each(function() { //静态模式场景，后台一次将布局全部输出
			var b = Number($(this).attr("plugin_type")), c = Number($(this)
					.attr("layout_id")), d = Number($(this).attr("x")), e = Number($(this)
					.attr("y")), f = Number($(this).attr("cx")), h = Number($(this)
					.attr("cy")), g = {};
			g.ShowTitle = Number($(this).attr("plugin_data_show_title"));
			g.Style = Number($(this).attr("plugin_data_style"));
			g.Type = Number($(this).attr("plugin_data_type"));
			switch (b) {
				case Constant.PLUGIN_TYPE_ADVERTISING :
					var k = $(this).find(".plugin_advertising_content");
					g.Interval = k.attr("Interval");
					g.Direction = k.attr("Direction");
					break;
				case Constant.PLUGIN_TYPE_CAROUSEL :
					k = $(this).find(".plugin_carousel_content");
					g.Setting = {};
					g.Setting.ShowNumber = k.attr("ShowNumber");
					g.Setting.Interval = k.attr("Interval");
					g.Setting.Direction = k.attr("Direction");
					g.Setting.Gap = k.attr("Gap");
					g.Setting.ShowText = k.attr("ShowText");
					break;
				case Constant.PLUGIN_TYPE_NEWS_TEXT :
				case Constant.PLUGIN_TYPE_NEWS_GRAPHIC :
					k = $(this).find(".plugin_news_main_content");
					g.Roll = "True" == k.attr("Roll")
							|| "true" == k.attr("Roll");
					g.Interval = k.attr("Interval");
					g.Direction = k.attr("Direction");
					break;
				case Constant.PLUGIN_TYPE_SHOWCASE1 :
				case Constant.PLUGIN_TYPE_SHOWCASE2 :
				case Constant.PLUGIN_TYPE_SHOWCASE3 :
					k = $(this).find(".showcase_main_content"), g.GoodsStyle = k
							.attr("goods_style"), g.Roll = "True" == k
							.attr("Roll")
							|| "true" == k.attr("Roll"), g.Interval = k
							.attr("Interval"), g.Direction = k
							.attr("Direction")
			}
			a.add_plugin_layout(c, b, d, e, f, h, g)
		})
	},
	add_plugin_layout : function(a, b, c, d, e, f, h) {
		var g = this.add_plugin(b);
		g.plugin_id = -1;
		g.layout_id = a; //实例数据信息
		g.grid_x = c;
		g.grid_y = d;
		g.grid_cx = e;
		g.grid_cy = f;
		g.data = h;
		g.is_new = !1;
		g.frame.remove();
		g.frame = this.frame.find(".plugin_containers[layout_id=" + a + "]");
		g.body = g.frame.find(".plugin_body");
		g.plugin_type == Constant.PLUGIN_TYPE_NAV_ALL
				&& g.get_body().css("z-index", 10);
		this.plugins.push(g);
		this.move_all(this.plugins, !1);
		g.show_normal();
		g.show();
		setTimeout(function() {
					g.show_data()
				}, 0)
		
	},
	add_plugin : function(a) {
		for (var b = this, c = null, d = 0; d < this.plugin_option.length; d++)
			if (this.plugin_option[d].plugin_type == a) {
				c = $.extend(!0, {}, this.plugin_option[d]);
				break
			}
		null == c && (c = {
			plugin_type : a,
			content : "<div></div>",
			icon : "<div></div>",
			tools_bar : $("<div></div>"),
			on_show : null,
			on_sized : null
		});
		a = $.extend(!0, {}, c, {
					plugin_type : a,
					show_mode : PluginConstant.SHOW_MODE_STATIC,
					frame_config : this.istore_option.frame_config,
					icon : "<div></div>",
					content : $("<div></div>"),
					tools_bar : $("<div></div>"),
					tools_show_resize : !1,
					page_id : this.istore_option.page_id,
					containers : this.store_containers,
					on_remove : function(a) {
						b.on_remove(a)
					}
				}); 
		return new iStorePlugin(a)
	},
	on_remove : function(a) {
	},
	on_moved : function(a, b, c) {
	},
	on_sized : function(a, b, c) {
	},
	set_size : function(a) {
		a = this.grid_to_pos(0, 0, this.grid_width, a);
		this.frame.width(a.width);
		this.frame.height(a.height)
	},
	move_all : function(a) {
		for (var b = 0; b < this.plugins.length; b++) {
			var c = this.grid_to_pos(a[b].grid_x, a[b].grid_y, a[b].grid_cx,
					a[b].grid_cy); //add by wuigrid 计算位置信息
			this.plugins[b].move(c.x1, c.y1, c.width, c.height)
		}
		this.set_size(this.get_max_height(a))
	},
	get_max_height : function(a) {
		for (var b = 1, c = 0; c < a.length; c++)
			a[c].grid_y + a[c].grid_cy > b && (b = a[c].grid_y + a[c].grid_cy);
		return b
	},
	grid_to_pos : function(a, b, c, d) {
		return csharp_grid_to_pos(this.istore_option.frame_config, a, b, c, d)
	}
};